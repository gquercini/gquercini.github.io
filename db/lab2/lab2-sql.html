<!--
SOFTWARE: MANAGE TWO ROLES: ORGANIZER AND PARTICIPANT (with different login and passwords)
AUTHENTICATION ALSO !

https://github.com/jkordas/client-server-authentication-demo/blob/master/src/database.py

-->

<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Introduction to Databases &ndash; Lab Assignment 2</title>
  <link rel="stylesheet" type="text/css" href="../../styles/exercises.css">

  <link rel="stylesheet" href="../../styles/prism.css">
  <script src="../../scripts/prism.js"></script>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

  <script>hljs.initHighlightingOnLoad();</script>
  <script> function
      showHideSolution(elem, elemLink, show, hide) {
      state =
        document.getElementById(elem).style.display; if (state == "none") {
          document.getElementById(elem).style.display = 'block';
          document.getElementById(elemLink).innerHTML = hide
        } else {
        document.getElementById(elem).style.display = 'none';
        document.getElementById(elemLink).innerHTML = show
      }

    } </script>
</head>

<body>

  <h1>Introduction to Databases</h1>

  <img src="./figs/cs-logo.png" alt="cs-logo" class="logo">

  <h1>Lab Assignment 2 <br><br> Interacting with a MySQL Server</h1>

  <h2>Introduction</h2>

  <p>
  <b>MySQL</b> is one of the most used relational database management systems to date.
  Your goal in this lab assignment will be to learn how to interact with a MySQL server.
  In particular, you will learn how to:
  <ul>
    <li> Create a user in MySQL and assign privileges to the user.
    <li> Create a database and connect to it.
    <li> Create tables in a database.
    <li> Import data into a database.
    <li> Query data with SQL.
  </ul>

  <h3>Installing and Configuring MySQL</h3>

  <p>MySQL comes with different editions and versions.
  The installation depends on the operating system on which your computer runs.</p>

  <p><b>Instructions for Windows users </b>
    [<a href="#" onclick="showHideSolution('installation-windows', 'installation-windows-link', 'Click here', 'Hide');return false;"><span id="installation-windows-link">Click here</span></a>].

    <div id="installation-windows" style="display:none;" class="reltables">
        First check if you have the <i>Visual C++ Redistributable for Visual Studio 2015</i> package installed
        in your computer.
        In case this package is <b>not</b> installed on your computer, click on
        <a href="https://www.microsoft.com/en-US/download/details.aspx?id=48145" target="_blank">this link</a>,
        click on <i>Download</i> and select the file <i>vc_redist.x64.exe</i>, if you have a 64bit operating system,
        or <i>vc_redist.x86.exe</i>, if you have a 32 bit operating system.
        Download the selected file, run it and follow the instructions to install the package.

        <p>
          Now you're ready to install the MySQL Community Server, that you can find
          by clicking on <a href="https://dev.mysql.com/downloads/mysql/" target="_blank">this link</a>.
          Select the MySQL Installer for Windows (MSI) by clicking on the button <i>Go to Download Page</i>.
          You will land on a page that gives you two possible files to download.
          If you have a 32 bit operating system, download the first one (whose size is 18.5M); otherwise,
          download the second one (whose size is 393.4M).
        </p>

        <p>
          When the download is complete, double click on the downloaded file.
          Select the custom installation and install the following components:
          <ul>
            <li> <b>MySQL server 8.0.</b> Click on the + sign at the right of the label
              <i>MySQL servers</i> and at the right of the children labels until
              you reach the leaf. The leaf contains a file. Move that file
              over to the right panel (<i>products/features to be
              installed</i>) by using the arrow between the two panels.
            <li> <b>MySQL Workbench.</b>
              <li> <b>MySQL shell.</b>
          </ul>
          <p>Once the installation is over, you need to keep following the instructions
  to configure the MySQL server.
  <ul>
    <li> In the window titled <i>High Availability</i>, select <b>Standalone MySQL Server</b>.
    <li> In the window titled <i>Type and Networking</i>, do not change anything.
    <li> In the window titled <i>Authentication method</i>, select <b>Legacy authentication</b>.
    <li> In the window titled <i>Accounts and roles</i>, type in the password for the user <i>root</i>.
      The user <i>root</i> is the administrator of the MySQL server, please <b>do not forget your password</b>.
    <li> In the window titled <i>Windows Service</i>, do not change anything.
    <li> In the window titled <i>Apply Configuration</i>, click on the button <i>Execute</i>.
    <li> In the subsequent windows, just click on <i>Next</i>, until you reach the end of the configuration.
    <li> MySQL Server is now installed and will be executed on your machine.
  </ul>
  </p>
    </div>
  </p>

  <p><b>Instructions for MacOS users </b>
    [<a href="#" onclick="showHideSolution('installation-macos', 'installation-macos-link', 'Click here', 'Hide');return false;"><span id="installation-macos-link">Click here</span></a>].

    <div id="installation-macos" style="display:none;" class="reltables">
        <p>
          You can find the MySQL Community Server by clicking
          on <a href="https://dev.mysql.com/downloads/mysql/" target="_blank">this link</a>.
          <ul class="warning">
            <li class="warning"> If you use a version of MacOS <b>earlier than Mojave (10.14)</b>, you must
              download and install <b>MySQL server version 5.7.27</b> (Click on the link <i>Looking for previous GA versions?</i>).
            </ul>
          Select the DMG archive and download it.
        </p>

        <p>
          When the download is complete, double click on the downloaded file.
          and follow the instructions.
        </p>
          <p>Once the installation is over, you need to keep following the instructions
  to configure the MySQL server.
  <ul>
    <li> In the window titled <i>High Availability</i>, select <b>Standalone MySQL Server</b>.
    <li> In the window titled <i>Type and Networking</i>, do not change anything.
    <li> In the window titled <i>Authentication method</i>, select <b>Legacy authentication</b>.
    <li> In the window titled <i>Accounts and roles</i>, type in the password for the user <i>root</i>.
      The user <i>root</i> is the administrator of the MySQL server, please <b>do not forget your password</b>.
    <li> Click on <i>Next</i> without changing anything till you reach the conclusion of the installation.
    <li> MySQL Server is now installed and will be executed on your machine.
  </ul>
  </p>
  <p>
    Now you need to install the <b>MySQL Workbench</b> that you can find by clicking on
    <a href="https://dev.mysql.com/downloads/workbench/">this link</a>.
    <ul class="warning">
        <li class="warning"> If you use a version of MacOS <b>earlier than Mojave (10.14)</b>, you must
          download and install <b>MySQL Workbench 6.3.10</b> (Click on the link <i>Looking for previous GA versions?</i>).
    </ul>
    Download the DMG archive, execute it and follow the instructions.
  </p>
  </div>
  </p>

  <p><b>Instructions for Linux users </b>
    [<a href="#" onclick="showHideSolution('installation-linux', 'installation-linux-link', 'Click here', 'Hide');return false;"><span id="installation-linux-link">Click here</span></a>].

    <div id="installation-linux" style="display:none;" class="reltables">
      <p>In order to install the MySQL server, please read the guide that you can find at
      <a href="https://dev.mysql.com/doc/refman/8.0/en/linux-installation.html" target="_blank">this link</a>.</p>

      <p>In order to install the MySQL Workbench,
        click on <a href="https://dev.mysql.com/downloads/workbench/" target="_blank">this link</a>.</p>
    </div>
  </p>

  <h3>Create a User</h3>

  <p>
    When you installed MySQL, you also created a user called <i>root</i>, that is the administrator of the
    database. Among her privileges, the administrator can create new users and assign them a certain set of
    privileges, or permissions, on the server.
  </p>
  <p>
    Execute the MySQL Workbench.
    A window should open where a label with a text <i>Local instance 3306</i> should appear.
    <ul class="raise">
      <li class="raise"> If you do not see that label, ask help from your lab supervisor.
    </ul>
    Click twice on the label; type in the password of the user <i>root</i> and click <i>OK</i>.
  </p>
  <p>
    In order to create a user:
    <ul>
      <li> Click on the label <i>Users and Privileges</i> on the left-side menu.
      <li> Click on the button <i>Add Account</i>.
      <li> In the <i>Login</i> tab, type in the <i>login name</i> and the <i>password</i>.
      <ul class="warning">
        <li class="warning"> The field <i>Limit to Host Matching</i> lists all the computers from where
          the user can connect to the MySQL server instance. The <b>wildcard</b> % means "any computer".
        </ul>
      <li> Do not select any administrative roles for the new user.
          <ul class="warning">
              <li class="warning"> In information systems, the <b>principle of the least privilege</b> is applied.
                A user is given <b>only</b> the privileges that are <b>strictly necessary</b>. Here, we want our new user
                to be able to create a database and use it, which does not require any administrative privilege on the
                server.
              </ul>
      <li> In the tab <i>Schema Privileges</i>, select <i>Add Entry</i>.
        <ul>
          <li> Select <i>All Schema (%)</i> and click on <i>OK</i>.
            <ul class="warning">
                <li class="warning"> This means that we do not constrain the new user to only work on a specific database.
            </ul>
          <li> In the <b>Object Rights</b> panel, select SELECT, INSERT, UPDATE, DELETE.
            <ul class="warning">
                <li class="warning"> This allows the new user to execute CRUD operations on the tables of a database.
            </ul>
          <li> In the <b>DDL Rights</b> panel, select CREATE, ALTER, REFERENCES, INDEX, DROP.
            <ul class="warning">
                <li class="warning"> This allows the new user to apply selected DDL (Data Definition Language)
                  SQL commands that are used to define the database schema.
                  In other words, the user can create tables (CREATE), modify their definition (ALTER),
                  define foreign key constraints (REFERENCES), create indexes (INDEX) and delete tables (DROP).
            </ul>
        </ul>
        <li> Click on the button <b>Apply</b> to finalize the creation of the user.
    </ul>

    Now, connect to the MySQL Server with the credentials of the new user.
    <ul>
      <li> Select <b>Database</b> &rarr; <b>Connect to Database</b>.
      <li> In the field <b>Stored Connection</b> select <b>Local instance 3306</b>.
      <li> In the field <b>Username</b>, specify the new user.
      <li> Click on the button <b>OK</b> and type in the password of the new user when prompted to.
      </ul>
      A window opens that you will use to type SQL queries to create databases and tables and insert and
      query data in the next exercises.
      <ul class="warning">
        <li class="warning"> In order to execute a query, simply write it and then click on the lightning
          bolt symbol (&#9889;).
      </ul>

  </p>


  <h2>Social Network Platform</h2>

  <p>
  We intend to create in MySQL a database for the social network platform for which we
  designed the logical model in the first lab assignment.
  In order to see the definition of the tables in the database, click on
  <a href="../lab1/lab1-modeling.html#social-network-pd-item" target="_blank">this link</a> and
  click on <b>See solution</b>.
  </p>

<h3> Questions </h3>

<ol type="a">
  <li> Create a database named <i>sn_platform</i>
  [<a href="#" onclick="showHideSolution('social-network-create-db', 'social-network-create-db-link', 'See solution', 'Hide solution');return false;"><span id="social-network-create-db-link">See solution</span></a>].

  <div id="social-network-create-db" style="display:none;" class="reltables">
<pre>
<code>CREATE DATABASE sn_platform</code>
</pre>
</div>
<ul class="warning">
  <li class="warning"> After executing the query, you should see the new database in the
    section SCHEMAS on the left side panel. If this is not the case, click on the refresh button right next
    to the word SCHEMAS.
    <li class="warning"> Do not forget to execute the query USE sn_platform in order to connect to the newly
      created database.
</ul>

<li> Create all tables in the new database. For each table, specify the primary and foreign
  keys [<a href="#" onclick="showHideSolution('social-network-create-table', 'social-network-create-table-link', 'See solution', 'Hide solution');return false;"><span id="social-network-create-table-link">See solution</span></a>].
<div id="social-network-create-table" style="display:none;" class="reltables">
<pre>
<code>CREATE TABLE UserAccount(nickname VARCHAR(100) PRIMARY KEY,
             first_name VARCHAR(100), last_name VARCHAR(100),
             city VARCHAR(100), country VARCHAR(100))

CREATE TABLE Post(post_id INT PRIMARY KEY,
        content TEXT, date DATE, time TIME,
        latitude FLOAT, longitude FLOAT, nickname VARCHAR(100),
        FOREIGN KEY(nickname) REFERENCES UserAccount(nickname))

CREATE TABLE EmailAddress(email_address VARCHAR(100) PRIMARY KEY,
        nickname VARCHAR(100),
        FOREIGN KEY(nickname) REFERENCES UserAccount(nickname))

CREATE TABLE Relationship(nickname_src VARCHAR(100), nickname_dst VARCHAR(100),
        type VARCHAR(50), date DATE,
        PRIMARY KEY(nickname_src, nickname_dst),
        FOREIGN KEY(nickname_src) REFERENCES UserAccount(nickname),
        FOREIGN KEY(nickname_dst) REFERENCES UserAccount(nickname))

CREATE TABLE Tag(post_id INT, nickname VARCHAR(100),
        PRIMARY KEY(post_id, nickname),
        FOREIGN KEY(post_id) REFERENCES Post(post_id),
        FOREIGN KEY(nickname) REFERENCES UserAccount(nickname))
</code>
</pre>
</div>

    <ul class="warning">
        <li class="warning"> For each column, you will have to specify its type. For a list of types
          allowed in MySQL, click on <a href="http://www.mysqltutorial.org/mysql-data-types.aspx" target="_blank">this link</a>.
      </ul>
  <li> Download the dataset at the <a href="./data/social-network/sn-data-set.zip">following URL</a> and unzip it.
  <li> Import the dataset into the database <TT>sn_platform</TT> [<a href="#" onclick="showHideSolution('import-db-instructions', 'import-db-instructions-link', 'Tell me how', 'Hide');return false;"><span id="import-db-instructions-link">Tell me how</span></a>].
    <div id="import-db-instructions" style="display:none;" class="reltables">
      The downloaded dataset is a collection of CSV files.
      There are as many files as the tables in the database.
      Each file is named after the corresponding table.
      For each file you have to run a query that will perform a <b>bulk import</b> of the data from the file into the
      corresponding table. For instance, for the table <TT>UserAccount</TT>, you'll run the following query:
<pre><code>LOAD DATA LOCAL INFILE 'fullpath/user-account.csv'
INTO TABLE UserAccount
CHARACTER SET 'utf8'
FIELDS TERMINATED BY ';'
IGNORE 1 ROWS</code></pre>
At the place of <i>fullpath</i>, you have to replace the full path of directories where the file <i>user-account.csv</i> is.
    </div>
  <li> Download the SQL dump of the database at the <a href="./data/social-network/dump_sn_platform.sql">following URL</a>.
  <li> Import the database into MySQL [<a href="#" onclick="showHideSolution('import-db-instructions', 'import-db-instructions-link', 'Tell me how', 'Hide');return false;"><span id="import-db-instructions-link">Tell me how</span></a>].
    <div id="import-db-instructions" style="display:none;" class="reltables">
      <ul>
        <li> On the left side menu of MySQL Workbench, click on <i>Data Import/Restore</i>.
        <li> Select <i>Import from Self-Contained File</i> and choose the file that you've just
          downloaded.
        <li> Click on <i>Start Import</i>.
        <li> If you refresh the schemas on the left side menu, you should see the new database.
      </ul>

    </div>
    <li> Write the following queries in SQL:
          <ol class="queryitem">
            <li class="queryitem"> For each user, get the number of followers by country. Rank the countries by the number of
              followers in descending order [<a href="#" onclick="showHideSolution('social-network-q1', 'social-network-q1-link', 'See solution', 'Hide solution');return false;"><span id="social-network-q1-link">See solution</span></a>].
              <div id="social-network-q1" style="display:none;" class="reltables">
                <pre>
<code>SELECT nickname_dst, country, count(*) as nbFollowers
FROM UserAccount, Relationship
WHERE nickname = nickname_src AND type='follower'
GROUP BY nickname_dst, country
ORDER BY nickname_dst, country, nbFollowers DESC</code></pre>
              </div>
          <ul class="warning">
            <li class="warning"> <a href="#" onclick="showHideSolution('q1-expected-result', 'q1-expected-result-link', 'Show the expected result', 'Hide the expected result');return false;"><span id="q1-expected-result-link">Show the expected result</span></a>.
        </ul>

<div id="q1-expected-result" align="center" style="display:none;">
  
      <table class="tg">
        <tr>
          <th class="tg-0lax">nick_ANIS</th>
          <th class="tg-0lax">Germany</th>
          <th class="tg-0lax">1</th>
        </tr>
        <tr>
          <td class="tg-0lax">nick_ANIS</td>
          <td class="tg-0lax">Portugal</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_BIANCHI</td>
          <td class="tg-0lax">France</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_BIANCHI</td>
          <td class="tg-0lax">Germany</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_BIANCHI</td>
          <td class="tg-0lax">UK</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_BLANCO</td>
          <td class="tg-0lax">Italy</td>
          <td class="tg-0lax">2</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_BLANCO</td>
          <td class="tg-0lax">UK</td>
          <td class="tg-0lax">2</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_CAMERON</td>
          <td class="tg-0lax">France</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_CAMERON</td>
          <td class="tg-0lax">Portugal</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_CAMERON</td>
          <td class="tg-0lax">Spain</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_CAMERON</td>
          <td class="tg-0lax">UK</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_CHOISNE</td>
          <td class="tg-0lax">France</td>
          <td class="tg-0lax">2</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_COEFFARD</td>
          <td class="tg-0lax">Germany</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_COEFFARD</td>
          <td class="tg-0lax">UK</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_COEFFARD</td>
          <td class="tg-0lax">USA</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_COUILLAUD</td>
          <td class="tg-0lax">France</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_FERRON</td>
          <td class="tg-0lax">UK</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_GUEFFIER</td>
          <td class="tg-0lax">France</td>
          <td class="tg-0lax">2</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_GUEFFIER</td>
          <td class="tg-0lax">Germany</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_HUGHES</td>
          <td class="tg-0lax">France</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_HUGHES</td>
          <td class="tg-0lax">Germany</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_RELION</td>
          <td class="tg-0lax">Germany</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_RELION</td>
          <td class="tg-0lax">Italy</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_RELION</td>
          <td class="tg-0lax">Portugal</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_RELION</td>
          <td class="tg-0lax">Spain</td>
          <td class="tg-0lax">2</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_RELION</td>
          <td class="tg-0lax">UK</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_RELION</td>
          <td class="tg-0lax">USA</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_REVERDY</td>
          <td class="tg-0lax">Italy</td>
          <td class="tg-0lax">2</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_REVERDY</td>
          <td class="tg-0lax">Spain</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_REVERDY</td>
          <td class="tg-0lax">UK</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_REVERDY</td>
          <td class="tg-0lax">USA</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_ROSSI</td>
          <td class="tg-0lax">Germany</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_ROSSI</td>
          <td class="tg-0lax">Portugal</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_ROSSI</td>
          <td class="tg-0lax">USA</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_ROUSSIERE</td>
          <td class="tg-0lax">France</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_ROUSSIERE</td>
          <td class="tg-0lax">Germany</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_SCHEIDER</td>
          <td class="tg-0lax">France</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_SCHEIDER</td>
          <td class="tg-0lax">Germany</td>
          <td class="tg-0lax">2</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_SCHEIDER</td>
          <td class="tg-0lax">Italy</td>
          <td class="tg-0lax">2</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_SCHMIDT</td>
          <td class="tg-0lax">France</td>
          <td class="tg-0lax">2</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_SCHMIDT</td>
          <td class="tg-0lax">Germany</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_SCHMIDT</td>
          <td class="tg-0lax">Italy</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_SCHMIDT</td>
          <td class="tg-0lax">Portugal</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_SCHMIDT</td>
          <td class="tg-0lax">Spain</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_SCHMIDT</td>
          <td class="tg-0lax">UK</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_SCHMIDT</td>
          <td class="tg-0lax">USA</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_SMITH</td>
          <td class="tg-0lax">Spain</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_SMITH</td>
          <td class="tg-0lax">UK</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_WEBER</td>
          <td class="tg-0lax">Italy</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_WEBER</td>
          <td class="tg-0lax">Spain</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_WEBER</td>
          <td class="tg-0lax">UK</td>
          <td class="tg-0lax">1</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_WEBER</td>
          <td class="tg-0lax">USA</td>
          <td class="tg-0lax">1</td>
        </tr>
      </table>  
</div>
          </ul>
            <li class="queryitem"> Get the first and family name of the users tagged by the user with nickname 'nick_CAMERON'
              [<a href="#" onclick="showHideSolution('social-network-q2', 'social-network-q2-link', 'See solution', 'Hide solution');return false;"><span id="social-network-q2-link">See solution</span></a>].
              <div id="social-network-q2" style="display:none;" class="reltables">
                <pre>
<code>SELECT first_name, last_name
FROM UserAccount
WHERE nickname in
  (
    SELECT distinct u.nickname
    FROM Post p, Tag t, UserAccount u
    WHERE p.post_id=t.post_id AND p.nickname='nick_CAMERON'
          AND t.nickname=u.nickname
  )</code></pre></div>

  <ul class="warning">
      <li class="warning"> <a href="#" onclick="showHideSolution('q2-expected-result', 'q2-expected-result-link', 'Show the expected result', 'Hide the expected result');return false;"><span id="q2-expected-result-link">Show the expected result</span></a>.
  </ul>
  <div id="q2-expected-result" align="center" style="display:none;">
  <table class="tg">
      <tr>
        <th class="tg-0lax">Matteo</th>
        <th class="tg-0lax">BIANCHI</th>
      </tr>
      <tr>
        <td class="tg-0lax">Florian</td>
        <td class="tg-0lax">COEFFARD</td>
      </tr>
    </table>
  </div>


            <li class="queryitem"> Get the nickname, first and last name of the common friends of the users
              with nickname 'nick_CAMERON' and 'nick_ANIS'
              [<a href="#" onclick="showHideSolution('social-network-q3', 'social-network-q3-link', 'See solution', 'Hide solution');return false;"><span id="social-network-q3-link">See solution</span></a>].
              <div id="social-network-q3" style="display:none;" class="reltables">
                <pre>
<code>SELECT u.nickname, u.first_name, u.last_name
FROM UserAccount u,
  ( SELECT nickname_dst as nickname
    FROM Relationship
    WHERE nickname_src='nick_CAMERON' AND type='friendship'
          AND nickname_dst IN
            ( SELECT nickname_dst as nickname
              FROM Relationship
              WHERE nickname_src='nick_ANIS'
                    AND type='friendship')
  ) temp
WHERE u.nickname=temp.nickname</code></pre></div>

<ul class="warning">
    <li class="warning"> <a href="#" onclick="showHideSolution('q3-expected-result', 'q3-expected-result-link', 'Show the expected result', 'Hide the expected result');return false;"><span id="q3-expected-result-link">Show the expected result</span></a>.
</ul>
<div id="q3-expected-result" align="center" style="display:none;">
    <table class="tg">
        <tr>
          <th class="tg-0lax">nick_COEFFARD</th>
          <th class="tg-0lax">Florian</th>
          <th class="tg-0lax">COEFFARD</th>
        </tr>
        <tr>
          <td class="tg-0lax">nick_MORENO</td>
          <td class="tg-0lax">Franco</td>
          <td class="tg-0lax">MORENO</td>
        </tr>
        <tr>
          <td class="tg-0lax">nick_ROUSSIERE</td>
          <td class="tg-0lax">Jacob</td>
          <td class="tg-0lax">ROUSSIERE</td>
        </tr>
      </table>
</div>
            <li class="queryitem"> Rank the users by the number of their followers. The user with the most followers must appear at the top
              of the list
             [<a href="#" onclick="showHideSolution('social-network-q4', 'social-network-q4-link', 'See solution', 'Hide solution');return false;"><span id="social-network-q4-link">See solution</span></a>].
              <div id="social-network-q4" style="display:none;" class="reltables">
                <pre>
<code>SELECT u.nickname, u.first_name, u.last_name, temp.nbFollowers
FROM UserAccount u,
      (SELECT nickname_dst as nickname, count(*) as nbFollowers
      FROM Relationship r
      WHERE r.type='follower'
      GROUP BY r.nickname_dst) temp
WHERE u.nickname = temp.nickname
ORDER BY nbFollowers DESC</code></pre>
              </div>
              <ul class="warning">
                  <li class="warning"> <a href="#" onclick="showHideSolution('q4-expected-result', 'q4-expected-result-link', 'Show the expected result', 'Hide the expected result');return false;"><span id="q4-expected-result-link">Show the expected result</span></a>.
              </ul>
              <div id="q4-expected-result" align="center" style="display:none;">
              
                    <table class="tg">
                      <tr>
                        <th class="tg-0lax">nick_SCHMIDT</th>
                        <th class="tg-0lax">Gerda</th>
                        <th class="tg-0lax">SCHMIDT</th>
                        <th class="tg-0lax">8</th>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_RELION</td>
                        <td class="tg-0lax">Léonie</td>
                        <td class="tg-0lax">RELION</td>
                        <td class="tg-0lax">7</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_SCHEIDER</td>
                        <td class="tg-0lax">Paul</td>
                        <td class="tg-0lax">SCHEIDER</td>
                        <td class="tg-0lax">5</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_REVERDY</td>
                        <td class="tg-0lax">Frantz</td>
                        <td class="tg-0lax">REVERDY</td>
                        <td class="tg-0lax">5</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_BLANCO</td>
                        <td class="tg-0lax">Francisco</td>
                        <td class="tg-0lax">BLANCO</td>
                        <td class="tg-0lax">4</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_CAMERON</td>
                        <td class="tg-0lax">Andrew</td>
                        <td class="tg-0lax">CAMERON</td>
                        <td class="tg-0lax">4</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_WEBER</td>
                        <td class="tg-0lax">Bertha</td>
                        <td class="tg-0lax">WEBER</td>
                        <td class="tg-0lax">4</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_COEFFARD</td>
                        <td class="tg-0lax">Florian</td>
                        <td class="tg-0lax">COEFFARD</td>
                        <td class="tg-0lax">3</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_ROSSI</td>
                        <td class="tg-0lax">Gina</td>
                        <td class="tg-0lax">ROSSI</td>
                        <td class="tg-0lax">3</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_BIANCHI</td>
                        <td class="tg-0lax">Matteo</td>
                        <td class="tg-0lax">BIANCHI</td>
                        <td class="tg-0lax">3</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_GUEFFIER</td>
                        <td class="tg-0lax">Hortense</td>
                        <td class="tg-0lax">GUEFFIER</td>
                        <td class="tg-0lax">3</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_HUGHES</td>
                        <td class="tg-0lax">Lara</td>
                        <td class="tg-0lax">HUGHES</td>
                        <td class="tg-0lax">2</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_ANIS</td>
                        <td class="tg-0lax">Karl</td>
                        <td class="tg-0lax">ANIS</td>
                        <td class="tg-0lax">2</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_SMITH</td>
                        <td class="tg-0lax">John</td>
                        <td class="tg-0lax">SMITH</td>
                        <td class="tg-0lax">2</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_ROUSSIERE</td>
                        <td class="tg-0lax">Jacob</td>
                        <td class="tg-0lax">ROUSSIERE</td>
                        <td class="tg-0lax">2</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_CHOISNE</td>
                        <td class="tg-0lax">Eliane</td>
                        <td class="tg-0lax">CHOISNE</td>
                        <td class="tg-0lax">2</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_FERRON</td>
                        <td class="tg-0lax">Prosper</td>
                        <td class="tg-0lax">FERRON</td>
                        <td class="tg-0lax">1</td>
                      </tr>
                      <tr>
                        <td class="tg-0lax">nick_COUILLAUD</td>
                        <td class="tg-0lax">Timothée</td>
                        <td class="tg-0lax">COUILLAUD</td>
                        <td class="tg-0lax">1</td>
                      </tr>
                    </table>
              </div>
              
          </ol>

</ol>

<h2>Banking System</h2>

<p>
    We intend to create in MySQL a database for the banking system for which we
    designed the logical model in the first lab assignment.
    In order to see the definition of the tables in the database, click on
    <a href="../lab1/lab1-modeling.html#banking-pd" target="_blank">this link</a> and
    click on <b>See solution</b>.
    </p>

  <h3> Questions </h3>

  <ol type="a">
    <li> Create a database named <i>banking</i>
       [<a href="#" onclick="showHideSolution('banking-create-db', 'banking-create-db-link', 'See solution', 'Hide solution');return false;"><span id="banking-create-db-link">See solution</span></a>].

    <div id="banking-create-db" style="display:none;" class="reltables">
  <pre><code>CREATE DATABASE banking</code></pre>
  </div>
  <ul class="warning">
    <li class="warning"> After executing the query, you should see the new database in the
      section SCHEMAS on the left side panel. If this is not the case, click on the refresh button right next
      to the word SCHEMAS.
      <li class="warning"> Do not forget to execute the query USE banking in order to connect to the newly
        created database.
  </ul>

  <li> Create all tables in the new database. For each table, specify the primary and foreign
    keys [<a href="#" onclick="showHideSolution('banking-create-tables', 'banking-create-tables-link', 'See solution', 'Hide solution');return false;"><span id="banking-create-tables-link">See solution</span></a>].
  <div id="banking-create-tables" style="display:none;" class="reltables">
<pre><code>CREATE TABLE Address(postal_code VARCHAR(50) PRIMARY KEY,
  city VARCHAR(50), country VARCHAR(50))

CREATE TABLE Bank(code_bank INT PRIMARY KEY,
  name_bank VARCHAR(50) UNIQUE, street_number INT,
  street_name VARCHAR(100), postal_code VARCHAR(50),
  FOREIGN KEY(postal_code) REFERENCES Address(postal_code))

CREATE TABLE Branch(branch_id INT PRIMARY KEY, street_number INT,
  street_name VARCHAR(50), postal_code VARCHAR(50), code_bank INT,
  FOREIGN KEY(code_bank) REFERENCES Bank(code_bank),
  FOREIGN KEY(postal_code) REFERENCES Address(postal_code))

CREATE TABLE Customer(ssn VARCHAR(50) PRIMARY KEY, first_name VARCHAR(50),
  last_name VARCHAR(50), telephone VARCHAR(50), street_number INT,
  street_name VARCHAR(50), postal_code VARCHAR(50),
  FOREIGN KEY(postal_code) REFERENCES Address(postal_code))

CREATE TABLE Account(acct_nbr INT PRIMARY KEY, acct_type VARCHAR(50),
  balance FLOAT, branch_id INT, ssn VARCHAR(50),
  FOREIGN KEY(branch_id) REFERENCES Branch(branch_id),
  FOREIGN KEY(ssn) REFERENCES Customer(ssn))

CREATE TABLE Loan (loan_nbr INT PRIMARY KEY, loan_type VARCHAR(50), amount FLOAT, branch_id INT, ssn VARCHAR(50),
  FOREIGN KEY(branch_id) REFERENCES Branch(branch_id),
  FOREIGN KEY(ssn) REFERENCES Customer(ssn))</code></pre>
  </div>

  <li> Download the SQL dump of the database at the <a href="./data/banking/dump_banking.sql">following URL</a>.
    <li> Import the database into MySQL.


  <li> Write the following queries in SQL:
      <ol class="queryitem">
        <li class="queryitem"> Get all the data (including the full address) on the customers that have a checking account
          with a negative balance
          [<a href="#" onclick="showHideSolution('banking-system-q1', 'banking-system-q1-link', 'See solution', 'Hide solution');return false;"><span id="banking-system-q1-link">See solution</span></a>].
          <div id="banking-system-q1" style="display:none;">
            <pre>
            <code>
SELECT c.*, addr.city, addr.country
FROM Customer c, Account acc, Address addr
WHERE c.ssn = acc.ssn AND c.postal_code = addr.postal_code
    AND acc.balance < 0 and acc.acct_type='checking'
            </code>
            </pre>
          </div>
          <ul class="warning">
              <li class="warning"> <a href="#" onclick="showHideSolution('q1bank-expected-result', 'q1bank-expected-result-link', 'Show the expected result', 'Hide the expected result');return false;"><span id="q1bank-expected-result-link">Show the expected result</span></a>.
          </ul>
          <div id="q1bank-expected-result" align="center" style="display:none;">
            <table class="tg">
                  <tr>
                    <th class="tg-0lax">172863542</th>
                    <th class="tg-0lax">Fourth</th>
                    <th class="tg-0lax">Member</th>
                    <th class="tg-0lax">109876352</th>
                    <th class="tg-0lax">12</th>
                    <th class="tg-0lax">FC Street</th>
                    <th class="tg-0lax">90871</th>
                    <th class="tg-0lax">fourth_city</th>
                    <th class="tg-0lax">country_5</th>
                  </tr>
                  <tr>
                    <td class="tg-0lax">128765434</td>
                    <td class="tg-0lax">John</td>
                    <td class="tg-0lax">Smith</td>
                    <td class="tg-0lax">98763252</td>
                    <td class="tg-0lax">12</td>
                    <td class="tg-0lax">SEC Street</td>
                    <td class="tg-0lax">1234</td>
                    <td class="tg-0lax">first_city</td>
                    <td class="tg-0lax">country_1</td>
                  </tr>
                </table>
          </div>
        <li class="queryitem"> Get the SSN of all customers that have no loan at the 'First Bank'
          [<a href="#" onclick="showHideSolution('banking-system-q2', 'banking-system-q2-link', 'See solution', 'Hide solution');return false;"><span id="banking-system-q2-link">See solution</span></a>].
          <div id="banking-system-q2" style="display:none;">
            <pre>
            <code>
SELECT ssn
FROM Customer
WHERE ssn NOT IN (
SELECT c.ssn
FROM Customer c, Loan l, Bank ba, Branch br
WHERE c.ssn = l.ssn and l.branch_id=br.branch_id
      and br.code_bank=ba.code_bank and ba.name_bank='First Bank')</code></pre>
          </div>
          <ul class="warning">
              <li class="warning"> <a href="#" onclick="showHideSolution('q2bank-expected-result', 'q2bank-expected-result-link', 'Show the expected result', 'Hide the expected result');return false;"><span id="q2bank-expected-result-link">Show the expected result</span></a>.
          </ul>
          <div id="q2bank-expected-result" align="center" style="display:none;">
          <table class="tg">
                  <tr>
                    <th class="tg-0lax">'128787673'</th>
                  </tr>
                  <tr>
                    <td class="tg-0lax">'128765434'</td>
                  </tr>
                  <tr>
                    <td class="tg-0lax">'219086468'</td>
                  </tr>
                  <tr>
                    <td class="tg-0lax">'129876532'</td>
                  </tr>
                </table>
          </div>

        <li class="queryitem"> Get the name of the bank that has the most branches
         [<a href="#" onclick="showHideSolution('banking-system-q3', 'banking-system-q3-link', 'See solution', 'Hide solution');return false;"><span id="banking-system-q3-link">See solution</span></a>].
          <div id="banking-system-q3" style="display:none;">
            <pre><code class="language-sql">SELECT name_bank
FROM Bank
WHERE code_bank IN
(
SELECT code_bank
FROM Branch
GROUP BY code_bank
HAVING COUNT(*) =
(SELECT MAX(nb_Branches)
FROM (SELECT count(*) as nb_Branches
    FROM Branch
    GROUP BY code_bank) temp
)
)</code></pre></div>

<ul class="warning">
    <li class="warning"> <a href="#" onclick="showHideSolution('q3bank-expected-result', 'q3bank-expected-result-link', 'Show the expected result', 'Hide the expected result');return false;"><span id="q3bank-expected-result-link">Show the expected result</span></a>.
</ul>
<div id="q3bank-expected-result" align="center" style="display:none;">    
      <table class="tg">
        <tr>
          <th class="tg-0lax">First Bank</th>
        </tr>
        <tr>
          <td class="tg-0lax">Third Bank</td>
        </tr>
      </table>
</div>      


        <li class="queryitem"> Get the SSN of all customers having an account in more than one bank
           [<a href="#" onclick="showHideSolution('banking-system-q4', 'banking-system-q4-link', 'See solution', 'Hide solution');return false;"><span id="banking-system-q4-link">See solution</span></a>].
          <div id="banking-system-q4" style="display:none;">
            <pre>
            <code>
  SELECT ssn
  FROM
      (SELECT  distinct a.ssn as ssn, br.code_bank as code_bank
       FROM Account a, Branch br
       WHERE a.branch_id = br.branch_id) temp
  GROUP BY ssn
  HAVING COUNT(*) > 1
            </code>
            </pre>
          </div> 
          <ul class="warning">
              <li class="warning"> <a href="#" onclick="showHideSolution('q4bank-expected-result', 'q4bank-expected-result-link', 'Show the expected result', 'Hide the expected result');return false;"><span id="q4bank-expected-result-link">Show the expected result</span></a>.

          </ul>
          <div id="q4bank-expected-result" align="center" style="display:none;"> 
              <table class="tg">
                  <tr>
                    <th class="tg-0lax">'128765434'</th>
                  </tr>
                  <tr>
                    <td class="tg-0lax">'172863542'</td>
                  </tr>
                </table>
          </div>
      </ol>






</body>

</html>
