<!--
SOFTWARE: MANAGE TWO ROLES: ORGANIZER AND PARTICIPANT (with different login and passwords)
AUTHENTICATION ALSO !

https://github.com/jkordas/client-server-authentication-demo/blob/master/src/database.py

-->

<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>SIP &ndash; Lab Assignment 6</title>
  <link rel="stylesheet" type="text/css" href="./styles/exercises.css">

  <link rel="stylesheet" href="./styles/prism.css">
  <script src="./scripts/prism.js"></script>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

  <script>hljs.initHighlightingOnLoad();</script>
  <script> function
      showHideSolution(elem, elemLink, show, hide) {
      state =
        document.getElementById(elem).style.display; if (state == "none") {
          document.getElementById(elem).style.display = 'block';
          document.getElementById(elemLink).innerHTML = hide
        } else {
        document.getElementById(elem).style.display = 'none';
        document.getElementById(elemLink).innerHTML = show
      }

    } </script>
</head>

<body>

  <h1>Information Systems and Programming</h1>

  <img src="./figs/cs-logo.png" alt="cs-logo" class="logo">

  <h1>Lab Assignment 6</h1>

  <h1>Implementing a Reservation System for Pistus</h1>

  <div align="center"><b>Gianluca Quercini</b></div>
  <div align="center"><b>gianluca.quercini[at]centralesupelec.fr</b></div>

  <h2>Acknowledgements</h2>
  <p>We thank Rémi Garde and Edmond de Roffignac for suggesting the idea of 
      a lab assignment centered around the Pistus event.</p>

 <p>  We thank Geneviève Leclerc for her suggestions and for  collecting all the information about the 
CentraleSupélec associations. </p>

  <h2>Context and Objective</h2>

  <p>"Pistus" (short for "Piston Ski") is an event organised by <a href="http://wacs.fr" target="_blank">WACS (Winter
      Association CentraleSupélec)</a> during
    the winter holidays every year. It's an awesome week-long mountain trip involving many
    activities (including skiing, snowboarding, raclette binges and parties, just
    to name a few).
  </p>

  <p>Since the event cannot accommodate all CentraleSupélec students, the organizers
    must cap the number of participants to the first 300 registered students.
    When a student wants to register for the Pistus, the organizers will write
    the student personal data in a Excel file, as well as the registration date and the amount
    that is due by the student.
    Upon registration, students have the option to pay
    immediately or later; in any case, the student must pay within 5 days of the registration,
    otherwise the registration is cancelled. The organizers will send a reminder by email 2 days before the deadline.
    Once the student pays, the organizers will write to the Excel file the payment date.
  </p>

  <p>The organizers keep two Excel files. One contains
    all the data of each registration, i.e., 
    the student number, first and last name, gender and email addresses 
    of the registered student, as well as the registration and payment dates, the 
    registration fee and the year of the event. [<a href="#"
      onclick="showHideSolution('students-excel','students-excel-link', 'Show the Excel file', 'Hide the Excel file');return false;"><span
        id="students-excel-link">Show the Excel file</span></a>]. <div id="students-excel" style="display:none;"
      class="reltables"><iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQQBZLw7uDt6AzfkqxSbYgR_XBcerpVaCeKaB2_ZBiZ5g81xykIHzPxxNk8dQ-eYSq-42MI96KVWpUJ/pubhtml?gid=0&amp;single=true&amp;widget=true&amp;headers=false" width='100%'
      height='565px'></iframe></div>
    The other Excel file contains the association membership information
    on the students [<a href="#"
      onclick="showHideSolution('asso-excel','asso-excel-link', 'Show the Excel file', 'Hide the Excel file');return false;"><span
        id="asso-excel-link">Show the Excel file</span></a>]. <div id="asso-excel" style="display:none;"
      class="reltables"><iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQBDBCj51Fp7OCGsvAjnVXM19dMUmy9IB5FSDfyyGjosTUEn_pF2vJK-bC1uQ7Bbbs7fZc1acS4SjZk/pubhtml?gid=0&amp;single=true&amp;widget=true&amp;headers=false" width='100%'
        height='565px'></iframe></div>
  </p>

  <ul class="warning">
    <li class="warning"> In these files, only the associations exist in the real world. 
      The names of the students have been randomly generated from 
      a list of french first and last names. These files do not contain any reference to actual students in the school.
  </ul>  

  <p> This organization presents a lot of issues:
    <ol>
      <li> If students participate to several editions of Pistus in different years, their data is replicated
        for each registration. This might lead to <i>redundancies</i>, as well as <i>inconsistent</i> data.
      <li> The organizers must manually check whether a student meets the payment deadline.
      <li> The organizers must manually send email reminders to the students.
    </ol>
    For this reason, we want to develop a software, called
    <TT>PistusResa</TT>, that the organizers can use to manage the registrations in an efficient way.
  </p>

  <div id="container">
    <figure> <img src="./figs/pistus-architecture.png" alt="Pistus architecture" class="body-image" style="width:100%;">
      <figcaption>The architecture of <TT>PistusResa</TT>.</figcaption>
    </figure>
  </div>

  <p> The architecture of <TT>PistusResa</TT> is shown in Figure 1. The software consists of a <b>graphical user interface</b> (GUI)
    that allows an organizer to access all the functionalities. 
    The backend consists of <b>five modules</b>, each dedicated to a specific functionality:
    <ul>
      <li> The <b>Authentication</b> module allows an organizer to get access to the functionalities of <TT>PistusResa</TT>.
      <li> The <b>Registration</b> module allows an organizer to sign up a student for a specific Pistus edition.
      <li> The <b>Payment</b> module allows an organizer to register the payment of a student.
      <li> The <b>Reservation Management</b> module allows an organizer to manage the reservations.
      <li> The <b>Deadline Management</b> module is a background process that checks the payment deadlines, 
        sends email reminders and removes the registrations that do not comply with the 
        payment deadline.
    </ul>
    <TT>PistusResa</TT> uses a relational database to store all the necessary
    data regarding the registrations. 
    An additional module, named <b>ETL</b> (meaning <i>Extract, Transform, Load</i>), is used to import into the database the data on the past Pistus editions that are kept in the two 
    spreadsheets mentioned above.
  </p>

  <h3>Objectives of the Lab Assignment</h3>
  <p>This lab assignment is going to cover the second half of this lab session (1.5 hours) 
    and the next two lab sessions (6 hours), for a total of <b>7.5 hours.</b> </p>
  In all these sessions, we expect <b>all students</b> to complete the following steps:
  <ul>
    <li> Deployment of the database (Section 2).
    <li> The ETL module (Section 3).
    <li> The registration module (Section 4).
    <li> A graphical interface (Section 5) that allows the 
      visualization of the registrations.
  </ul>

  These steps will allow you to see a minimal version of the application. 
  Optionally, depending on your programming skills, you will develop the other modules as well.


  <h3>Conventions Used in This Lab Assignment</h3>

  The following typographical conventions are used in this lab assignment:
  <ul class="warning">
    <li class="warning"> This icon denotes tips or general notes, something to pay attention to.
    <li class="exercise"> This icon denotes an action that you need to take before going further.
    <li class="raise"> This icon denotes a point that you might want to discuss with your lab 
      supervisor.
    <li class="test"> This icon denotes tests that you have to make on your code.
    <li class="rtfm"> This icon denotes a link to documentation that you can use to solve the exercises.
      The documentation must be used to help you understand how to code the exercises.
      You don't actually have to copy and run the examples written in the documentation.
  </ul>
  
  <h3>Project Initialization</h3>

 <ul class="warning">
 <li class="warning"> <b>Please read the instructions in this section carefully</b>
  <li class="warning"> <b>If you use Windows</b>, you should add to the environment variable
    <i>Path</i> two folders of your Anaconda installation [<a href="#"
    onclick="showHideSolution('path-instructions','path-instructions-link','Tell me how', 'Close');return false;"><span
      id="path-instructions-link">Tell me how</span></a>].
  <div id="path-instructions" style="display:none;" class="reltables">
    <p>First of all, you should locate the installation folder of your Anaconda distribution.
    In my computer, for instance, Anaconda is installed in the folder 
    C:\Users\gquer\Ananconda3. Chances are that your installation folder is under
    C:\Users\your_username\Anaconda3, where <i>your_username</i> is the name that identifies you 
    in your computer.</p>
    <p>Once you've located the installation folder of Anaconda (the following instructions are relative
      to Windows 10. If you have another version of Windows, please google how to 
      change environment variables in your windows edition):
      <ul>
        <li> Open the control panel.
        <li> Select <i>System and Security</i>.
        <li> Select <i>System</i>.
        <li> Select <i>Advanced System Settings</i> (on the left menu).
        <li> Click on the button <i>Environment Variables</i>.
        <li> In the <i>System variables</i> window, double-click on <i>Path</i>.
        <li> Select <i>New</i>, specify the value C:\Users\your_username\Anaconda3 and press Enter.
        <li> Select <i>New</i>, specify the value C:\Users\your_username\Anaconda3\Library\bin and press Enter.
        <li> Select <i>New</i>, specify the value C:\Users\your_username\Anaconda3\Scripts and press Enter.
        <li> Close all the windows of the control panel by clicking on OK.
        <li> Restart Visual Studio Code if had you already started it.
      </ul>
    </p>
  </div>
 </ul>

  <p>
    Create a folder called <i>pistus</i> on your computer. 
    Open <b>Visual Studio Code (VSC)</b> and select <b>File</b> &rarr; <b>Open Folder</b>; 
    select the folder <i>pistus</i> and open it.
    A new window should appear that has on the left side a menu called
    <b>Explorer</b> that lets you see the files in your projects.
    You should see a project named PISTUS with no files.
  </p>

  <ul class="warning">
      <li class="warning"> Change the file encoding of your text editor to UTF-8 [<a href="#"
        onclick="showHideSolution('encoding-instructions','encoding-instructions-link','Tell me how', 'Close');return false;"><span
          id="encoding-instructions-link">Tell me how</span></a>].
      <div id="encoding-instructions" style="display:none;" class="reltables">
        <b>If you use Windows or Linux</b>, select <b>File &rarr; Preferences &rarr; Settings</b>;
        <b>If you use MacOS</b>, select <b>Code &rarr; Preferences &rarr; Settings</b>.
        In the panel that appears, type the word "encoding" in the text field "Search settings";
        a setting named "Files:Encoding" should appear. In the drop-down menu, select "utf8".
        
      </div> 

      <li class="warning"> Install the Python extension in VSC if you haven't done it yet [<a href="#"
        onclick="showHideSolution('python-extension-instructions','python-extension-instructions-link','Tell me how', 'Close');return false;"><span
          id="python-extension-instructions-link">Tell me how</span></a>].
      <div id="python-extension-instructions" style="display:none;" class="reltables">
        On the far left side of the VSC window, you should see a list of icons. Click on the icon 
        that looks like four squares (one of which appears to drift away from the others); 
        if you see Python among the enabled extensions, you're all set. 
        Otherwise, type the name Python in the textfield <i>Search Extensions</i>, select it and install it.
      </div> 
      
    </ul>

  <p>
    Since <TT>PistusResa</TT> is a fairly complex software with several components,
    putting all code into a single file would be a bad idea.
    Instead, we will organize the code into several <b>packages</b>,
    which will ease its development and maintenance [<a href="#"
      onclick="showHideSolution('python-package-explanation','python-package-explanation-link','What is a package?', 'Close');return false;"><span
        id="python-package-explanation-link">What is a package?</span></a>].
    <div id="python-package-explanation" style="display:none;" class="reltables">
      A <b>package</b> in Python is a collection of <b>modules</b>, a module is defined
      as a file with extension .py containing Python code.
      In order to create a package, you have to create a folder under your project containing
      a special file named <TT>__init__.py</TT>.
      The purpose of this file is to include optional initialization code.
      For the moment, we will leave that file empty.
    </div>
  </p>

  <p>
    Our first lines of code will create the tables of the
    <TT>PistusResa</TT> database.
    We'll put that code in a module contained in a package named <TT>db</TT>.
  </p>

  <ul class="exercise">
    <li class="exercise"> Create a package named <TT>db</TT> in your project [<a href="#"
      onclick="showHideSolution('create-folder-vsc','create-folder-vsc-link','How do I create a folder in VSC?', 'Close');return false;"><span
        id="create-folder-vsc-link">How do I create a folder in VSC</span></a>].
    <div id="create-folder-vsc" style="display:none;" class="reltables">
      Go to the <b>Explorer</b>, right-click on the name of your project and select 
      <b>New Folder</b>.
    </div>
  </ul>

  
  
  <h2>The Database</h2>

  <p> The database of <TT>PistusResa</TT> is intended to keep data on the students that register
    for the Pistus.
    Students are identified by a student number and have a first and family name, gender
    and email addresses (a student can have more than one). </p>

  <p> A student can belong to one or more associations; each association is
    described by a name (unique) and a textual description of its activities.
    Any student has a specific role in an association (e.g., president, secretary, member).
  </p>

  <p> When a student registers for the Pistus, the year of the event,
    the registration and the payment date are stored, as well as the amount paid.
    The registration date and the payment date might be different.
    Importantly, a student can participate to different Pistus editions in different years, but cannot
    register twice for the same edition.</p>

  <h3>Database Design</h3>

  The ER model of the database of Pistus is shown in Figure 2.

  <figure> <img src="./figs/logical-data-model.png" alt="Pistus db logical data model" class="body-image" style="width:100%;">
    <figcaption>The logical data model of the database of <TT>PistusResa</TT>.</figcaption>
  </figure>
  

  We need to derive the corresponding
  <b>physical data model</b>, that consists of the collection of relational tables
  that are part of the database [<a href="#"
    onclick="showHideSolution('phys-model-explanation','phys-model-explanation-link','How to derive a physical model', 'Close');return false;"><span
      id="phys-model-explanation-link">How to derive a physical model</span></a>].
  <div id="phys-model-explanation" style="display:none;" class="reltables">
    Rules to translate a logical data model into a physical data model:
    <ul>
      <li> For each one-to-many relationship between two entities \(A\) and \(B\).
        Take the set \(K_B\) of attributes composing the primary key of \(B\)
        and add it to the attributes of \(A\).
        The new attributes of \(A\) will be a <b>foreign key</b> referencing the primary
        key of \(B\).

      <li> For each many-to-many relationship R between two entities \(A\) and \(B\).
        Create a new entity whose attributes are: all the attributes of \(R\),
        the set \(K_A\) of attributes composing
        the primary key of \(A\) and the set \(K_B\) of attributes composing the
        primary key of \(B\).
        The primary key of the new entity is composed of all attributes in \(K_A \cup K_B\).
        The attributes in \(K_A\) (respectively, \(K_B\)) will be a foreign key referencing the corresponding
        attributes in \(A\) (respectively, \(B\)).

      <li> For each entity in the ER diagram: create a relational table.
        The attributes of the entity become the columns of the table.
    </ul>
  </div>

  <p>
    <div class="exercisebox"> Translate the ER diagram into a collection of
      relational tables. 
      <ul class="warning">
        <li class="warning"> For each table, specify the primary and foreign keys.
        <li class="warning"> For each column, specify its type.
        <li class="raise"> Ask your lab supervisor to validate the schema.
      </ul>
      </div>
  </p>

  <p>Once the database design is in place, we need to create the actual database
    in a <b>Relational Database Management System</b> (RDBMS).
  </p>

  <h3>Database Creation</h3>

  <ul class="warning">
    <li class="warning"> To create the database, we either use SQLite or MySQL, <b>not both</b>.
    <li class="warning"> <b>We strongly recommend the use of SQLite as the DBMS for <TT>PistusResa</TT> 
    (much easier than MySQL)</b>
  </ul>

  
  <p>
      If you want to use  <b>SQLite</b> (<b>recommended choice</b>)  [<a href="#" onclick="showHideSolution('sqlite-exp', 'sqlite-exp-link',
     'Click here to continue', 'Close');return false;"><span id="sqlite-exp-link">Click here to continue</span></a>].
     <div id="sqlite-exp" style="display:none;" >
       <b>SQLite</b> is a software library written in C that implements a RDBMS. 
       SQLite does not need you to install a server. You just need to import the library into your application
       and call its functions to create tables and insert and query data.  
       The database will be a simple binary file stored in 
       your computer.
  
       <ul class="warning">
          <li class="warning"> In order to make a Python program communicate with a SQLite database, you need to have the
              Python package <TT>sqlite3</TT>. This package should be already included in your Anaconda distribution.
        </ul>  
  
        <ul class="exercise">
            <li class="exercise">Create a new file <TT>create_database.py</TT> under the package <TT>db</TT>.  
        </ul>
        <ul class="rtfm">
          <li class="rtfm">Click <a href="./docs/database-sqlite.html" target="_blank">here</a> to open the documentation 
            of sqlite3. You will need it to do the exercises of this section.
        </ul>
       
        <p><b>Creating a new database.</b> Since SQLite is not a server, you do not need to create any connection. 
          You can directly create a new database.
    
          <div class="exercisebox">In the file <TT>create_database.py</TT>, add the code to create a database
            named <TT>pistus</TT>. Execute the code.
            <ul class="warning">
                <li class="warning"> In order to execute the code, please follow these instructions. Open a terminal by 
                  selecting Terminal&rarr;New Terminal. At the bottom of the window a terminal appears.
                  Change the current directory to <i>db</i> by typing the command <i>cd db</i>. 
                  The type the command: <TT>python create_database.py</TT>.
                </ul>
            <ul class="warning">
              <li class="warning"> The code should create a file named <TT>pistus.db</TT> in the same directory as 
                the file <TT>create_database.py</TT>.
          </div>
        </p>
      
        <p><b>Creating the tables.</b> After the creation of the database, 
          we need to create the tables composing the database itself.
          
          <div class="exercisebox">In the file <TT>create_database.py</TT>, add the code to create all the tables in the database
            <TT>pistus</TT>. For each table, specify the primary and foreign keys. Execute the code.
            <ul class="warning">
              <li class="warning"> If you want to verify that your tables have been successfully created, you can 
                download and install the <a href="https://sqlitebrowser.org/dl/" target="_blank">DB Browser for SQLite</a>. 
                This will provide you a graphical interface to any SQLite database. After the installation, 
                just open the program, click on <b>Open Database</b> and select the file <TT>pistus.db</TT>.
                If everything is OK, you should see the tables that you've just created.
          </div>
        </p>
       
     </div>
   </p>

  <p>
    <b>If you could successfully install MySQL</b> on your computer and you want to use it as  
    the RDBMS of <TT>PistusResa</TT> (<b>not recommended!</b>) [<a href="#" onclick="showHideSolution('mysql-lab-part', 'mysql-lab-part-link',
    'Click here to continue', 'Close');return false;"><span id="mysql-lab-part-link">Click here to continue</span></a>].
    <div id="mysql-lab-part" style="display:none;" >
        <ul class="warning">
            <li class="warning"> In order to make a Python program communicate with a MySQL server, you need to install the
                Python package <TT>mysql-connector</TT> [<a href="#" onclick="showHideSolution('mysql-connector', 'mysql-connector-link',
                'Show me how', 'Close');return false;"><span id="mysql-connector-link">Show me how</span></a>].
                <div id="mysql-connector" style="display:none;" class="reltables">
                  Open a terminal in Visual Studio Code by selecting <b>Terminal</b> &rarr; <b>New Terminal</b>;
                  then type the following command (if you use Linux or MacOS):
                  <pre align="center">pip install mysql-connector</pre>
                  If you use Windows, type the following command:
                  <pre align="center">conda install mysql-connector-python</pre>
                </div>
          </ul>  
          <p>
              By using the MySQL connector, we can write Python code to connect to a MySQL server, create a new database,
              create the tables and insert the data into the tables. 
              <ul class="warning">
                <li class="warning">Make sure that an instance of MySQL server is running on your computer.
              </ul>
            
              <ul class="exercise">
                  <li class="exercise">Create a new file <TT>create_database.py</TT> under the package <TT>db</TT>.  
              </ul>
              <ul class="rtfm">
                <li class="rtfm">Click <a href="./docs/database.html" target="_blank">here</a> to open the documentation 
                  of MySQL Connector/Python. You will need it to do the exercises of this section.
              </ul>
              </p>
            
              <p><b>Connecting to the MySQL server.</b>  The first step consists in connecting your Python program to the 
              instance of the MySQL server running 
              on your computer.
              </p>
              <p>
                <div class="exercisebox">In the file <TT>create_database.py</TT>, write the code to connect to the 
                  instance of the MySQL server running on your computer. 
                </div>
              </p>
            
              <p><b>Creating a new database.</b> Once the connection is established, we need to create the new 
                database for <TT>PistusResa</TT>.
                <div class="exercisebox">In the file <TT>create_database.py</TT>, add the code to create a database
                  named <TT>pistus</TT>. Execute the code.
                  <ul class="warning">
                    <li class="warning"> In order to execute the code, please follow these instructions. Open a terminal by 
                      selecting Terminal&rarr;New Terminal. At the bottom of the window a terminal appears.
                      Change the current directory to <i>db</i> by typing the command <i>cd db</i>. 
                      The type the command: <TT>python create_database.py</TT>.
                    </ul>
                  <ul class="test">
                    <li class="test"> Open the MySQL Workbench and verify that the new database 
                      has actually been created.
                </div>
              </p>
            
              <p><b>Creating the tables.</b> After the creation of the database, 
                we need to create the tables composing the database itself.
                
                <div class="exercisebox">In the file <TT>create_database.py</TT>, add the code to create all the tables in the database
                  <TT>pistus</TT>. For each table, specify the primary and foreign keys. Execute the code.
                  <ul class="test">
                    <li class="test"> Open the MySQL Workbench and verify that the tables have actually been created.
                </div>
              </p>
    </div>  
  </p>
  
  
  <h2>The ETL Module</h2>

  <p>As explained in the introduction, for the past editions of Pistus
    the organizers had kept all the registration data in two spreadsheets;
    we now want to load all these data into the Pistus database.
    The <b>ETL module</b> is responsible for
    <b>extracting</b> the data from the spreadsheets, 
    <b>transforming</b> and <b>loading</b> them into
    the database.</p>

    <p>In order to ease the automatic process of the spreadsheets by a Python program, we 
      converted them into CSV files [<a href="#"
      onclick="showHideSolution('csv-explanation', 'csv-explanation-link', 'What are CSV files?', 'Close');return false;"><span
        id="csv-explanation-link">What are
        CSV files?</span></a>]. <div id="csv-explanation" style="display:none;" class="reltables"> 
            Unlike a spreadsheet, which is a <b>binary file</b> and needs a specific application (Microsoft Excel or equivalent)
            to be read, a <b>CSV file</b> (short for <i>comma-separated values</i>) 
            is simply a <b>plain-text file</b> that can be opened with any text editor.
            <p>Any application that can read a spreadsheet provides a way to save it as a CSV file.
            A CSV file has as many <b>rows</b> as the original spreadsheet; each row is a sequence of <b>values</b>, 
            separated by a special character, called the <b>separator</b>, or <b>delimiter</b> 
            (typically, a <i>comma</i> or 
            a <i>semi-colon</i>), that acts as a column delimiter. 
            </p>
            <p>Since a CSV file is plain-text, reading a CSV file from a Python application 
              is way easier than reading directly a spreadsheet.</p></div>
          <ul class="exercise">
            <li class="exercise"> In your project PISTUS, create a new folder named <b>data</b>.
            <li class="exercise"> Download the file <a href="./data/student_registrations.csv" download><b>student_registrations.csv</b></a>
              and <a href="./data/student_membership.csv" download><b>student_membership.csv</b></a> and move 
              them to the newly created 
              folder <b>data</b> [<a href="#"
              onclick="showHideSolution('download-help', 'download-help-link', 'Need help?', 'Close');return false;"><span
                id="download-help-link">Need help?</span></a>]. <div id="download-help" style="display:none;" class="reltables"> 
                  When you click on the above links, the CSV files will be downloaded to the <b>Downloads</b> folder of 
                  your computer. Simply drag them into the <b>data</b> folder in the <b>Explorer</b> panel of VSC.
                  </div> You can see the content of these files by simply clicking once on them in the 
                  Explorer panel. 
          </ul>
          <ul class="warning">
            <li class="warning"> In both files, the <b>separator</b> is the <b>semi-colon (;)</b>.
            <li class="warning"> The file <b>student_registrations.csv</b> contains the data 
              on the registration to the Pistus in the years 2016, 2017, 2018. 
              The file <b>student_membership.csv</b> contains the data on the affiliation of the students to 
              the different associations.
          </ul>
    </p>
    <p>
      If you fiddle with the files, you will immediately notice that many data are replicated; 
      first and last names and the email addresses of a student, for instance, occur in both files.
      Moreover, these data present some variability that is undesired when we intend to 
      process them through a software application:

      <ul>
          <li> The <b>gender</b> is expressed in different ways (e.g., female are alternatively identified by <i>F</i>, 
            <i>W</i> and <i>fille</i>).
          <li> Different formats are adopted for <b>dates</b> (e.g., DD/MM/YYYY, YYYY/MM/DD).
          <li> Different formats are adopted for expressing <b>registration fees</b> (e.g., 20,5e, 20,5 euros).
            In some cases, the registration fee is a numeric value, in some other cases it might contain some 
            characters from the alphabet. If we try to import these values into a Pyhton program and convert them into 
            a <b>float</b>, we would get errors.
          <li> Some students appear multiple times in both files (e.g., Ericka GUYOMARD in the file <b>student_registrations.csv</b>), 
            because they participate to several Pistus editions or belong to more than one association. 
        </ul>
        All these anomalies in the data are referred to as <b>noise</b>; virtually all 
        datasets present a certain amount of noise, that must be addressed before using the data.
        In other words, we need to <b>clean</b> the data before loading them into the database.
    </p>
    
    <p>We're now going to develop the ETL module step by step.
      <ul class="exercise">
        <li class="exercise"> Create a package named <TT>etl</TT> in your project. Don't forget to 
          create the file <TT>__init__.py</TT> in the package!
      </ul>
    </p>

    The ETL module consists of three submodules:
    <ul>
      <li> The <b>Extraction (E)</b> submodule. It extracts the content of the CSV files and organizes it into 
        several in-memory data structures.
      <li> The <b>Transformation (T)</b> submodule. It makes the data comply with certain requirements, in particular it cleans the 
        data from the noise.
      <li> The <b>Load (L)</b> submodule. It loads the transformed data into the database.
    </ul>

  <h3>The Extraction Submodule</h3>

  <p> If you correctly designed your database, each table should contain data on entities 
    of a specific type (e.g., a student, an association). 
    In the two input files, however, the data on the different entities are all mixed up 
    in the same table.
    For example, in  <b>student_registrations.csv</b>
    the personal data of the students (e.g., their gender) occur in the same table 
    as the data on the Pistus editions (e.g., the registration fee).
  </p>
  <p>The <b>Extraction</b> submodule extracts the content of the input CSV files and 
    organizes the data on the different entities into separate <b>data structures</b>.
    For <b>each table</b> in the database (e.g., the table <TT>Student</TT>), 
    the submodule creates a <b>list</b> where each item is a <b>row</b> of that table, 
    describing one of the entities (e.g., a student) of the table. 
  </p>
  <p>  
    The first choice that we need to make is how to represent a row in the list. 
    In fact, representing a row as a mere string, like in the CSV file, would not allow for an easy access
    to the values of the columns.

    <ul class="exercise">
        <li class="exercise"> Which data structure would you choose to represent a row? [<a href="#"
          onclick="showHideSolution('data-structure-choice', 'data-structure-choice-link', 'Show the answer', 'Close');return false;"><span
            id="data-structure-choice-link">Show the answer</span></a>]. <div id="data-structure-choice" style="display:none;" class="reltables"> 
              Different solutions are possible:
              <ul>
                <li> An <b>object.</b> We can represent the entity described by a row as an <b>instance</b> of a <b>class</b>.
                <li> A <b>list.</b> Each item of the list is a column value in the row.
                <li> A <b>tuple.</b> Same as a list.
                <li> A <b>dictionary.</b> Each item of the dictionary is a key-value pair, where the key is the name of the 
                  column associated to its value.
              </ul>
              Any of these solutions is a viable option. We're going to opt for the first one, which means that 
              we will have to define a <b>class</b> for each type of entity stored in the database (e.g, student, association).
              The reason why we choose the first option is twofold:
              <ul>
                <li> The functions transforming the values in the Transformation submodule will be coded directly in the 
                  classes where the values are.
                <li> You need to practice the object-oriented notions <font color="#0063A6">&#x263B;</font>.
              </ul>
            </div>
      </ul>
  </p>

  <p><b>Definition of the data structures.</b>
    We are now going to define the data structures to represent the data to be transformed and loaded into the 
    database.

    <ul class="exercise">
      <li class="exercise"> Create a file <TT>extraction.py</TT> in the <TT>etl</TT> package.
    </ul>
  
    <ul class="rtfm">
      <li class="rtfm"> Click <a href="./docs/object_oriented.html" target="_blank">here</a> to open 
        the guide to object-oriented programming in Python.
    </ul>

    <p>
        <div class="exercisebox">For each table in your database, create, in file <TT>extraction.py</TT>, 
          a <b>class</b> with the same name as the table. Each class defines the properties of an entity 
          contained in the corresponding table. [<a href="#"
          onclick="showHideSolution('classes-entities', 'classes-entities-link', 'Example', 'Close');return false;"><span
            id="classes-entities-link">Example</span></a>]. 
            <div id="classes-entities" style="display:none;" class="reltables"> 
              If your database defines a table called <TT>Student</TT>, 
              you should create a class named <TT>Student</TT>, whose fields are the columns of the namesake table.
              Each instance of the class <TT>Student</TT> will correspond to a row in the table.
            </div>
         </div>   
      </p>

  <p> <b>Data Extraction.</b>  We are now going to extract the data from the input CSV files 
    and, for each table in the database, create a list that holds the content of the table. 
    An item in any of these lists will be an instance of the class describing a row stored in the 
    corresponding table [<a href="#"
    onclick="showHideSolution('data-extraction', 'data-extraction-link', 'Example', 'Close');return false;"><span
      id="data-extraction-link">Example</span></a>]. 
      <div id="data-extraction" style="display:none;" class="reltables"> 
        If your database defines a table called <TT>Student</TT>, the Extraction submodule needs to create a 
        list, where each item is an instance of the class <TT>Student</TT> describing a row in the namesake table. 
      </div>
    <ul class="rtfm">
      <li class="rtfm"> Click <a href="./docs/csv_files.html" target="_blank">here</a> to open the documentation on CSV files. 
    </ul>
  </p>

  <p>
      <div class="exercisebox">In file <TT>extraction.py</TT>, write a function named <TT>extract</TT> defined by the following
      signature:
      $$
      extract(student\_registrations, student\_membership): (list_1, list_2, \ldots, list_n)
      $$
      Input of the function:
      <ul>
        <li> \(student\_registrations\). The file <TT>student_registrations.csv</TT>.
        <li> \(student\_membership\). The file <TT>student_membership.csv</TT>. 
      </ul>
      Output of the function:
      <ul>
        <li> A tuple \((list_1, list_2, \ldots, list_n)\), where \(n\) is the number of tables in 
          your database, and \(list_i\) is the list containing the rows of the \(i\)-th table.
          A row is represented by an object.
          The order of the tables is purely alphabetical, that is: <TT>Association</TT>,
          <TT>EmailAddress</TT>, <TT>Membership</TT>, <TT>PistusEdition</TT>, 
          <TT>Registration</TT>, <TT>Student</TT>.
      </ul>
      <ul class="warning">
        <li class="warning"> All values extracted from the CSV files will be treated as <b>strings</b>.
        <li class="warning"> In file <TT>student_registrations.csv</TT>, the registration of a student 
          to a specific Pistus edition <b>never</b> occurs more than once. In other words, there will never be two
          rows for the registration of student 8298259 to the Pistus edition 2016.
        <li class="warning"> In file <TT>student_membership.csv</TT>, the membership of a student 
          to a specific association <b>never</b> occurs more than once. 
        <li class="warning"> Data on a specific student, association and Pistus edition are replicated 
          many times in the two CSV files. 
          You should make sure that you don't have duplicates in the lists that hold these data.
          <ul class="raise">
            <li class="raise">Check with your lab supervisor the best strategy to avoid duplicates in 
              a list. 
          </ul>
      </ul>
  </div>
  <ul class="test">
    <li class="test"> You're now going to check whether your function returns the 
      expected result by using a <b>unit test</b>.
      To this extent, create a file named <TT>extraction_test.py</TT> in the package <TT>etl</TT>
      and paste the code below:
<pre><code class="language-python">import unittest
from extraction import extract

class TestExtract(unittest.TestCase):
    def test_Extract(self):
        (associations, email_addresses, memberships, \
            pistus_editions, registrations, students) = extract("../data/student_registrations.csv", "../data/student_membership.csv")
        
        self.assertEqual(len(associations), 11, "The number of associations should be 11")
        self.assertEqual(len(email_addresses), 910, "The number of email addresses should be 910")
        self.assertEqual(len(memberships), 895, "The number of memberships should be 895")
        self.assertEqual(len(pistus_editions), 3, "The number of Pistus editions should be 3")
        self.assertEqual(len(registrations), 900, "The number of registrations should be 900")
        self.assertEqual(len(students), 602, "The number of students should be 602")

if __name__ == '__main__':
    unittest.main()
</code></pre>
<ul class="warning">
  <li class="warning"> VSC might complain that it does not know the module <i>extraction</i>. Simply ignore this error.
</ul>
 Open a terminal, execute the command <TT>cd etl</TT> and run the following command:
<pre align="center">python extraction_test.py

</pre>
<ul class="exercise">
  <li class="exercise"> <b>Check the result of the test and correct your function <TT>extract</TT> if needed.</b>
</ul>
  </ul>
  </p>

  <!--
  <ul class="rtfm">
    <li class="rtfm"> Click <a href="docs/testing.html" target="_blank">here</a> to read how to 
      create a <b>unit test</b>.
  </ul>-->

  <h3>The Transformation Submodule</h3>

  The goal of the transformation submodule is to <i>clean</i> the extracted data
  from the noise.
  Four attributes need to be cleaned: the gender, the registration fee, and the 
  registration and payment dates.
  
  <p><b>Cleaning the values of <TT>gender</TT>.</b><br>
  The attribute <TT>gender</TT> in the input file <TT>student_registrations.csv</TT>
  takes the following values:
  <ul>
    <li> For males: <i>M</i>, <i>H</i> and <i>garçon</i>.
    <li> For females: <i>F</i>, <i>W</i> and <i>fille</i>.
  </ul>
  </p>
   
  <p>
    <div class="exercisebox">Write a function <TT>clean_gender</TT> that changes the value to 
    <i>M</i> or <i>F</i> depending on whether the gender refers to a male or a female.
    <ul class="raise">
        <li class="raise"> Where would you define this function? 
          Think of where you defined the attribute <TT>gender</TT>.
      </ul>
  </div>
  <ul class="test">
      <li class="test"> Create a file <TT>cleaning_test.py</TT> and define a unit test for 
        the function <TT>clean_gender</TT> in the same way as we defined the test <TT>extraction_test.py</TT>.
    </ul>  
  </p>

  <p><b>Cleaning the values of <TT>registration_fee</TT>.</b><br>
  In the file <TT>student_registrations.csv</TT>, a registration fee can be expressed as:
    <ul>
      <li> A <b>numeric</b> value. Only a number is specified. Two cases are possible:
        <ul>
          <li> The decimal separator is a <b>comma</b> (e.g., <b>20,5</b>).
          <li> The decimal separator is a <b>point</b> (e.g., <b>20.5</b>).
        </ul>
      <li> An <b>alphanumeric</b> value, typically a number followed by 
        a <b>textual suffix</b>. Between the number and the suffix 
        there might be a <b>space</b>. The suffix can be one of the following:
        <ul>
          <li> <b>e</b>, such as in  <b>20.5e</b> and <b>20.5 e</b>.
          <li> <b>E</b>, such as in  <b>20.5E</b> and <b>20.5 E</b>.
          <li> <b>euro</b>, such as in  <b>20.5euro</b> and <b>20.5 euro</b>.
          <li> <b>euros</b>, such as in  <b>20.5euros</b> and <b>20.5 euros</b>.  
        </ul>
    </ul>
  </p>
  <p>
    <div class="exercisebox">Write a function <TT>clean_registration_fee</TT> 
      that converts the value of the registration fee to a Python floating number.
      <ul class="raise">
          <li class="raise"> Where would you define this function? 
              Think of where you defined the attribute <TT>registration_fee</TT>.
        </ul>
    </div>
  </p>

  <ul class="test">
      <li class="test"> In the file <TT>cleaning_test.py</TT> define a unit test for 
        the function <TT>clean_registration_fee</TT>.
  </ul>
  
  <p><b>Cleaning the dates.</b><br>
    In the file <TT>student_registrations.csv</TT>, 
    a (registration or payment) date might be expressed in the following formats:
    <ul>
      <li> month (in english) DD, YYYY (e.g., <b>December 20, 2015</b>).
      <li> DD month (in french) YYYY (e.g., <b>20 décembre 2015</b>).
      <li> YYYY/MM/DD (e.g., <b>2015/12/20</b>).
      <li> DD/MM/YYYY (e.g., <b>20/12/2015</b>).
         
    </ul>
  </p>

  <ul class="rtfm">
    <li class="rtfm"> Click <a href="./docs/dates.html" target="_blank">here</a> to read how to handle dates in 
      Python.
  </ul>

  <p>
    <div class="exercisebox">Write a function <TT>clean_date</TT> defined by the following 
      signature:
      $$
      clean\_date(old\_date): new\_date 
      $$
      The input of the function is a date in one of the formats specified above;
      the output of the function is a date in the format YYYY/MM/DD. 
      <ul class="warning">
        <li class="warning"> The input <TT>old_date</TT> is a string value.
        <li class="warning"> The output <TT>new_date</TT> is an instance 
          of the class <TT>datetime.date</TT>.
        <li class="warning"> If the string representing the value of the <TT>old_date</TT> has 
          length 0, then <b>the function must return <TT>None</TT></b>.
      </ul>
      <ul class="raise">
          <li class="raise"> Where would you define the function <TT>clean_date</TT>?
            Think of where the attributes  <TT>registration_date</TT> and <TT>payment_date</TT>
            are defined.
            You should consider using a class method.
        </ul>
    </div>
  </p>

  <ul class="test">
      <li class="test"> In the  file <TT>cleaning_test.py</TT> define a unit test for 
        the function <TT>clean_date</TT>.
  </ul>
  
  <p>
    <div class="exercisebox">Write two functions <TT>clean_registration_date</TT> 
    and <TT>clean_payment_date</TT> that clean the registration and payment dates 
  by using the function <TT>clean_date</TT> defined previously. 
  <ul class="raise">
      <li class="raise"> Where would you define these functions? 
          Think of where you defined the attributes <TT>registration_date</TT> and <TT>payment_date</TT>.
    </ul>
</div>
  </p>

  <h3>Loading Data into the Database</h3>

  It's now time to import the data from the CSV files into the database.
  <ul class="exercise">
    <li class="exercise"> Create a new file named <TT>data_loading.py</TT> in the package 
      <TT>etl</TT>. You'll define the functions demanded by Exercises 8 through 14 in this file.
  </ul>

  <ul class="rtfm">
    <li class="rtfm"> In order to load data into the database, click <a href="./docs/database.html" target="_blank">here</a> to open the documentation 
      of MySQL Connector/Python (if you use MySQL) or <a href="./docs/database-sqlite.html" target="_blank">here</a>
      to open the documentation of how to use SQLite.
   </ul>


  <p>
    <div class="exercisebox"> Write a function
      <TT>import_associations()</TT> defined by the following signature:
      $$
      import\_associations(cursor, list\_associations) 
      $$
      The input of the function is the <TT>cursor</TT> object 
      that you use to connect to the database and 
      the list of associations returned by the function 
      <TT>extract</TT> defined in Exercise 3.
      </div>
  </p>

  <p>
  <div class="exercisebox"> Write a function
      <TT>import_students()</TT> defined by the following signature:
      $$
      import\_students(cursor, list\_students) 
      $$
      The input of the function is the <TT>cursor</TT> object 
      that you use to connect to the database and  the list of students returned by the function 
      <TT>extract</TT> defined in Exercise 3.
      </div>
  </p>

  <p>
  <div class="exercisebox"> Write a function
      <TT>import_email_addresses()</TT> defined by the following signature:
      $$
      import\_email\_addresses(cursor, list\_email\_addresses) 
      $$
      The input of the function is the <TT>cursor</TT> object 
      that you use to connect to the database and  the list of email addresses returned by the function 
      <TT>extract</TT> defined in Exercise 3.
      </div>
  </p>

  <p>
  <div class="exercisebox"> Write a function
      <TT>import_pistus_editions()</TT> defined by the following signature:
      $$
      import\_pistus\_editions(cursor, list\_pistus\_editions) 
      $$
      The input of the function is the <TT>cursor</TT> object 
      that you use to connect to the database and  the list of Pistus editions returned by the function 
      <TT>extract</TT> defined in Exercise 3.
      </div>
  </p>

  <p>
    <div class="exercisebox"> Write a function
        <TT>import_memberships()</TT> defined by the following signature:
        $$
        import\_memberships(cursor, list\_memberships) 
        $$
        The input of the function is the <TT>cursor</TT> object 
      that you use to connect to the database and  the list of memberships returned by the function 
        <TT>extract</TT> defined in Exercise 3.
        </div>
  </p>

  <p>
  <div class="exercisebox"> Write a function
      <TT>import_registrations()</TT> defined by the following signature:
      $$
      import\_registrations(cursor, list\_registrations) 
      $$
      The input of the function is the <TT>cursor</TT> object 
      that you use to connect to the database and  the list of registrations returned by the function 
      <TT>extract</TT> defined in Exercise 3.
      </div>
  </p>

  We now wrap everything up and we write the code to call the functions defined in the Exercises 
  9 through 14 and import the data.
  
  <ul class="exercise">
    <li class="exercise"> At the end of the file <TT>data_loading.py</TT>, write the following code:
<pre><code class="language-python">if __name__ == '__main__':</code></pre>
The Python interpreter will run the code that follows this instruction 
when you execute the script <TT>data_loading.py</TT>.
You'll write the code demanded in Exercise 14 <b>after</b> this instruction.
</ul>

<p>
<div class="exercisebox"> Write the Python code to:
<ul>
  <li> Connect to the Pistus database.
  <li> Call the function <TT>extract</TT> defined in Exercise 3 to extract the data from the 
    input CSV files.
  <li> Clean the data by using the functions defined in Exercises 4, 5 and 7.
  <li> Load the data into the database by using the functions defined in Exercises 8 through 13.
</ul>
</div>
<ul class="test">
    <li class="test"> Verify that the data is correctly loaded into the Pistus database.
  </ul>
  
</p>


<h2>The Registration Module</h2>

  <p>The <b>registration module</b> contains the functions necessary to register 
  a student to a specific Pistus edition.
  If the student hasn't participated in any previous Pistus edition, <TT>PistusResa</TT> 
  will ask her to insert all her personal data, including the names of the associations to which she belongs 
  and her roles in them. 
  If the student has already participated in a previous Pistus edition, her data will already be in the database.
  </p>


  <ul class="exercise">
    <li class="exercise"> In your project, create a package named <TT>registration</TT>. 
    <li class="exercise"> Create a file named <TT>registration_module.py</TT> in the package <TT>registration</TT>.
      This file will contain the definition of all the functions of the registration module. 
  </ul>

  <ul class="rtfm">
      <li class="rtfm"> In the following exercises, you'll need to use <b>parameterized queries </b>. 
        If you use MySQL, check the documentation by following <a href="./docs/database.html#parameterized_queries" target="_blank">this link</a>.
        If you use SQLite, check the documentation by following <a href="./docs/database-sqlite.html#parameterized_queries" target="_blank">this link</a>.
    </ul>
    

  <h3>Adding a Student to the Database</h3>
  We define a function:
<pre><code class="language-python">add_student(stud_number, first_name, last_name, gender, email_addresses, cursor, conn): success</code></pre>
      
  The input is: 
  <ul>
    <li> The student number.
    <li> The student first name.
    <li> The student last name. 
    <li> The student gender.
    <li> The student email addresses (a list).
    <li> The object <TT>cursor</TT> used to execute queries in the database.
    <li> The object <TT>conn</TT> used to connect to the database.
  </ul>
  
  The output is a boolean value (<TT>success</TT>):
  <ul>
    <li> <TT>True</TT>, if the student can be added to the database.
    <li> <TT>False</TT>, if the student cannot be added to the database. 
  </ul>

  <p>
      <div class="exercisebox"> Write the code for the function <TT>add_student()</TT> in the file named 
        <TT>registration_module.py</TT>.
        <ul class="warning">
          <li class="warning"> Remember to catch the exceptions raised in case the SQL query encounters an error.
            If an error occurs, then the function must return <TT>False</TT>.
            <li class="warning"> Remember to commit the modifications to the database.
        </ul>
      </div>

  </p>

  <h3>Adding a Student to Associations</h3>
  We define a function:
<pre><code class="language-python">add_student_to_associations(stud_number, associations, cursor, conn):success</code></pre>
The input is:
<ul>
  <li>  The student number.
  <li>  The list of associations to which the student must be added. Each item of this list is a tuple 
    (<TT>asso_name</TT>, <TT>stud_role</TT>).
  <li> The object <TT>cursor</TT> used to execute queries in the database.
  <li> The object <TT>conn</TT> used to connect to the database.

    The output is a boolean value (<TT>success</TT>):
    <ul>
      <li> <TT>True</TT>, if the student can be added to the associations.
      <li> <TT>False</TT>, if the student cannot be added to the associations. 
    </ul>
  
    <p>
        <div class="exercisebox"> Write the code for the function <TT>add_student_to_associations()</TT> in the file named 
          <TT>registration_module.py</TT>.
          <ul class="warning">
            <li class="warning"> Remember to catch the exceptions raised in case the SQL query encounters an error.
              If an error occurs, then the function must return <TT>False</TT>.
              <li class="warning"> Remember to commit the modifications to the database.
          </ul>
        </div>
  
    </p>
  
  
</ul>

  <h3>Getting a Student from the Database</h3>

  We define a function:
  <pre><code class="language-python">get_student(stud_number, cursor): (stud_number, first_name, last_name, gender, email_addresses)</code></pre>
  
  The input is: 
  <ul>
    <li> The student number.
    <li> The object <TT>cursor</TT> used to execute queries in the database.
  </ul>
  
  <b>If a student with the given number exists</b>, the output is a tuple containing:

  <ul>
    <li> The student number.
    <li> The student first name.
    <li> The student last name. 
    <li> The student gender.
    <li> The student email addresses (a list).
  </ul>

  <b>If a student with the given number does not exist</b>, the output is <TT>None</TT>.
  <p>
      <div class="exercisebox"> Write the code for the function <TT>get_student()</TT> in the file named 
        <TT>registration_module.py</TT>.
      </div>
  </p>

 
  <h3>Getting the Associations of a Student</h3>

  We define a function:
  <pre><code class="language-python">get_student_associations(stud_number, cursor): associations</code></pre>
   
  The input is: 
   <ul>
     <li> The student number.
    <li> The object <TT>cursor</TT> used to execute queries in the database.
   </ul>
   
   The output is a list containing the associations of the student. 
   Each element of this list is a tuple (<TT>asso_name</TT>, <TT>stud_role</TT>), 
   where <TT>asso_name</TT> is the name of an association and 
   <TT>stud_role</TT> is the role of the student in that association.
    If no association can be found the output is <TT>None</TT>.
  
  <p>
      <div class="exercisebox"> Write the code for the function <TT>get_student_associations()</TT> in the file named 
        <TT>registration_module.py</TT>.
      </div>
  </p>

  <h3>Adding a Pistus Edition</h3>
  We define a function:
  <pre><code class="language-python">add_pistus_edition(edition_year, registration_fee, cursor, conn): success</code></pre>
The input is:
<ul>
  <li> The edition year.
  <li> The registration fee.
  <li> The object <TT>cursor</TT> used to execute queries in the database.
  <li> The object <TT>conn</TT> used to connect to the database.
</ul>

The output is a boolean value (<TT>success</TT>):
<ul>
    <li> <TT>True</TT>, if the Pistus edition can be added.
    <li> <TT>False</TT>, if the Pistus edition cannot be added.
</ul>

<p>
    <div class="exercisebox"> Write the code for the function 
      <TT>add_pistus_edition()</TT> in the file named 
      <TT>registration_module.py</TT>.
    </div>
</p>

  <h3>Registering a Student to a Pistus Edition</h3>
  We define a function:
  <pre><code class="language-python">register_student_to_pistus_edition(stud_number, edition_year, registration_date, cursor, conn, payment_date=None): success</code></pre>
The input is:
<ul>
  <li> The student number.
  <li> The Pistus edition year.
  <li> The registration date.
  <li> The object <TT>cursor</TT> used to execute queries in the database.
  <li> The object <TT>conn</TT> used to connect to the database.
  <li> The payment date (the default value is <TT>None</TT>).
</ul>

The output is a boolean value (<TT>success</TT>):
   <ul>
     <li> <TT>True</TT>, if the student can be registered.
     <li> <TT>False</TT>, if the student cannot be registered. 
   </ul>
  
  <p>
      <div class="exercisebox"> Write the code for the function <TT>register_student_to_pistus_edition()</TT> in the file named 
        <TT>registration_module.py</TT>.
      </div>
  </p>

 <h2>The Graphical User Interface</h2>

 <p>We're going to develop the Graphical User Interface (GUI) of  <TT>PistusResa</TT>  shown in Figure 3 by using
 the library <TT>tkinter</TT> included in the Anaconda distribution.
The GUI consists of a main window with a <b>tabbed panel</b>, which <TT>tkinter</TT>
refers to as <b>notebook</b>, containing two tabs:
<ul>
  <li> The tab <TT>Student</TT> (shown in Figure 3), 
    that allows a Pistus organizer to add a new student or get 
    the information of an existing student.
  <li> The tab <TT>Registration</TT> (shown in Figure 4), that allows a Pistus organizer to 
    register a student to a Pistus edition.
</ul>

fill in 
the information after the organizer types the student number.

Otherwise, the organizer has to type all the requested information and then
click 
</p>
<p>
    When a Pistus organizer wants to register a student to a Pistus edition, 
    she first types the student number.
    If the student already exists in the database, the GUI will 
    get from the database all information about the student and fill in all the fields.
    The organizer will then click on the tab "Registration" to register the student 
    to the Pistus edition.
    
</p>
<p>
  If the student does not exist in the database, the organizer has to type all the student 
  information and click on the button "Add student" before clicking on the tab "Registration".
</p>

<figure> <img src="./figs/pistus_gui.png" alt="Pistus GUI overview" class="body-image" style="width:80%;">
  <figcaption>The GUI of <TT>PistusResa</TT>.</figcaption>
</figure>

Here we give you the code of the skeleton of the GUI, which is explained right 
after the code.

<ul class="warning">
  <li class="warning"> Read the code and the explanation carefully in order 
    to understand its structure.
</ul>
<pre class="line-numbers"><code class="language-python">import tkinter as tk
from tkinter import messagebox
from tkinter import ttk
import sqlite3
  
'''
Defines the GUI of the application PistusResa
'''
class PistusResaGUI(tk.Frame):
    def __init__(self, conn, cursor, parent=None):
        super().__init__(parent)
        self.parent = parent
        self.conn = conn
        self.cursor = cursor
        self.rb_gender = tk.StringVar(value="")
        self.stud_number = tk.StringVar(value="")
        self.create_widgets()
        self.pack()

    '''
    Create all the graphical elements (widgets) in the window.
    '''
    def create_widgets(self):
        # Add a title to the main window.
        self.parent.title("PistusResa")
        
        # Create the notebook (tabbed panel) inside the main window.
        self.create_notebook()
              
    '''
    Create the notebook (tabbed pane) inside the main window
    '''
    def create_notebook(self):
        # Create in the main window a notebook (panel with different tabs)
        nb = ttk.Notebook(self.parent)
    
        # Create the student tab.
        self.create_student_tab(nb)

        # The registration tab.
        self.create_registration_tab(nb)    

        nb.pack(expand=1, fill="both")

    '''
    Create the student tab
    '''
    def create_student_tab(self, nb):
        pass

    # Create the registration tab
    def create_registration_tab(self, nb):
        pass

main_window = tk.Tk()
conn = sqlite3.connect('./db/pistus.db')
cursor = conn.cursor()
app = PistusResaGUI(conn, cursor, parent=main_window)
app.mainloop()
cursor.close()
conn.close()</code></pre>

  Here is the explanation of the code:
  <ul>
    <li> <b>Lines 1-4.</b> We import the necessary modules from <TT>tkinter</TT>
      and <TT>sqlite3</TT> because we'll need to plug the GUI to the database.
    <li> <b>Line 55.</b> Entry point of the program, where we create the main window
      of the application.
    <li> <b>Lines 56-57.</b> We open a connection to the database.
    <li> <b>Line 58.</b> We create an instance of the class <TT>PistusResaGUI</TT> (see below).
    <li> <b>Line 59.</b> We execute the GUI. The main window will be displayed. The code will loop on
      this instruction until the main window is closed by the user.
    <li> <b>Lines 60-61.</b> We close the connection to the database. These two lines will be 
      executed only when the main window will be closed by the user.
    <li> <b>Lines 9 to 53.</b> We define the class <TT>PistusResaGUI</TT> that contains the 
      definition of the GUI. The class is defined as the subclass of <TT>tk.Frame</TT>, which essentially
      means that it implements a window that will be rendered on screen.
    <li> <b>Lines 10 to 18</b>. Constructor of the class. It initializes the variables of the class.
    <li> <b>Line 11</b>. We call the constructor of the parent class (<TT>tk.Frame</TT>). 
      As a result, our class <TT>PistusResaGUI</TT> inherits all the methods and properties 
      from the class <TT>tk.Frame</TT>.
    <li> <b>Lines 12-16</b>. Initialization of properties in the class <TT>PistusResaGUI</TT>. 
      All these properties will be accessible by all methods defined in the class.

      <ul>
        <li> <TT>self.parent</TT> refers to the main window of the GUI.
        <li> <TT>self.conn</TT> refers to the connection to the database. 
        <li> <TT>self.cursor</TT> refers to the object used to execute queries on the database.
        <li> <TT>self.rb_gender</TT> refers to a variable that will store the current value of the 
          radio buttons <i>gender</i>.
        <li> <TT>stud_number</TT> refers to a variable that will store the current value of the 
          text field <i>Student number</i>.
      </ul>
      <li> <b>Line 17.</b> We call a function defined at line 23 to create the elements 
        (a.k.a., <b>widgets</b>) of the GUI.
      <li> <b>Line 18.</b> We call the function <TT>pack</TT> (defined in the class <TT>tk.Frame</TT>)
        to arrange the widgets inside the frame.
  </ul>
  The function <TT>create_widgets</TT> (Lines 23 to 28) gives a title to the main window
  and then invokes the function to create the notebook.
  The function <TT>create_notebook</TT> (Lines 33 to 43):
  <ul>
    <li> <b>Line 35.</b> Creates a notebook. The constructor of the 
      class <TT>ttk.Notebook</TT> is called with the parameter <TT>self.parent</TT>. 
      This means that the notebook is added to the main window. 
    <li> <b>Line 38-41</b> We invoke the two functions to create the Student and Registration tabs.
    <li> <b>Line 43.</b> We dispose the notebook inside the main window by specifying that 
      this notebook should cover the whole window, both horizontally and vertically.
  </ul>

  <ul class="warning">
    <li class="warning"> The two functions <TT>create_student_tab</TT> and 
      <TT>create_registration_tab</TT> are not implemented. You'll have to do it. 
  </ul>

  <ul class="exercise">
    <li class="exercise"> Create a package <TT>gui</TT> in your project.
    <li class="exercise"> Create a file <TT>main_window.py</TT> in the package <TT>gui</TT>.
      Copy the code of the skeleton of the GUI into this file.
  </ul>


  <h3>The Tab Student</h3>

  We'll now complete the function <TT>create_student_tab</TT>.
  <ul class="warning">
    <li class="warning"> The statement <TT>pass</TT> that you see in the definition of 
      both <TT>create_student_tab</TT> and <TT>create_registration_tab</TT> means 
      that the methods are not implemented. 
    <li class="warning"> Remember to remove this statement when you implement the functions.
  </ul>

  The function <TT>create_student_tab</TT> takes in the variable <TT>nb</TT> that is the notebook 
  where the student tab must be added.

  <p>
      <div class="exercisebox"> In the function <TT>create_student_tab</TT>, write the code 
        that creates a tab "Student" inside the notebook <TT>nb</TT>.
        <ul class='rtfm'>
          <li class='rtfm'> Check the <a href="./docs/tkinter.html#notebook" target="_blank">Tkinter documentation</a>.
        </ul>
        <ul class="raise">
          <li class="raise"> Execute the code to see the result and, in case of doubts, ask your lab
            supervisor.
        </ul>
      </div>
  </p>

  As we can see in Figure 3, the tab "Student" contains a <b>form</b> that consists of 
  a <b>grid</b> with 10 rows and 3 columns. 
  Each row corresponds to a property;
  in the first column, we find the <b>labels</b> ("Student number *", "First name *",...) 
  that indicate the name of the property. 
  The asterisk at the end of the label text indicates a 
  required field.

  <p>
      <div class="exercisebox"> In the function <TT>create_student_tab</TT>, write the code 
        that creates all the labels inside the tab "Student".
        The labels are disposed in a grid and occupy the first column.
        <ul class='rtfm'>
          <li class='rtfm'> Check the <a href="./docs/tkinter.html#labels" target="_blank">documentation</a>.
        </ul>
        <ul class="raise">
          <li class="raise"> Execute the code to see the result and, in case of doubts, ask your lab
            supervisor.
        </ul>
      </div>
  </p>

  The fields of the form in the tab "Student" are as follows:
  <ul>
    <li> <b>Text fields</b>, in the case of the properties student number, first and last name, email address
      and alternate email address.
    <li> <b>Radio buttons</b>, in the case of the property gender.
    <li> <b>Combo boxes</b>, in the case of the properties first, second and third association.
    <li> <b>Buttons</b>, in the case of the button "Add student".
  </ul>

  <p>
      <div class="exercisebox"> In the function <TT>create_student_tab</TT>, write the code 
        that creates the following <b>text fields</b>:
        <ul>
          <li> <TT>stud_number_entry</TT>. Text field allowing to enter the student number. 
            This appears on the same row as the label "Student number *".
            <li> <TT>first_name_entry</TT>. Text field allowing to enter the student first name. 
              This appears on the same row as the label "First name *".
            <li> <TT>last_name_entry</TT>. Text field allowing to enter the student last name. 
              This appears on the same line as the label "Last name *".
            <li> <TT>email_entry</TT>. Text field allowing to enter the student email address. 
              This appears on the same line as the label "Email address *".
            <li> <TT>alternate_email_entry</TT>. Text field allowing to enter the student alternate email address. 
              This appears on the same line as the label "Alternate email address".
        </ul> 
        All these text fields are in the second column of the grid.
        
        <ul class='rtfm'>
          <li class='rtfm'> Check the <a href="./docs/tkinter.html#textfields" target="_blank">Tkinter documentation</a>.
        </ul>
        <ul class="warning">
            <li class="warning"> The text field corresponding to the label "Student number" 
              must be bound to the variable <TT>self.stud_number</TT>. This way, 
              the value in that text field can be shared with the tab "Registration", as we'll see 
              later.
          </ul>
        <ul class="raise">
          <li class="raise"> Execute the code to see the result and, in case of doubts, ask your lab
            supervisor.
        </ul>
      </div>
  </p>

  <p>
      <div class="exercisebox"> In the function <TT>create_student_tab</TT>, write the code 
        that creates the radio buttons M and F corresponding to the property 
        gender.
        Both radio buttons should occupy the second column in the grid.
        <ul class='rtfm'>
          <li class='rtfm'> Check the <a href="./docs/tkinter.html#radiobuttons" target="_blank">Tkinter documentation</a>.
        </ul>
        <ul class="warning">
            <li class="warning"> Both radio buttons must be bound to the variable 
              <TT>self.rb_gender</TT>. That variable will contain the value of the currently
              selected button. 
          </ul>
        <ul class="raise">
          <li class="raise"> Execute the code to see the result and, in case of doubts, ask your lab
            supervisor.
        </ul>
      </div>
  </p>

  From Figure 3, you can see that there are two combo boxes associated to the label 
  "First association" (the same goes for the labels "Second association" and "Third association").
  The combo box in the second column contains the names of the associations, while the one in the 
  third column contains the possible roles of a student in an association. 
  The names of the association are available in the database in the table <TT>Association</TT>;
  The names of the student roles are available in the database in the table 
  <TT>Membership</TT>. 
  Therefore, the values of these two combo boxes can be loaded from the database.

  <p>
      <div class="exercisebox"> In the function <TT>create_student_tab</TT>, write the code 
        that creates two lists, one called <TT>associations</TT> and the other called 
        <TT>stud_roles</TT> that contain respectively the names of the associations and 
        the student roles obtained from the database.
       <ul class="rtfm">
         <li class="rtfm"> Remember to <a href="./docs/database-sqlite.html" target="_blank">check the documentation</a> to find out 
          how to query a database.
       </ul>
        <ul class="warning">
            <li class="warning"> In order to query the database, remember that you can use the 
              variable <TT>self.cursor</TT>.
        </ul>
        <ul class="warning">
          <li class="warning"> In the code, print the content of the two lists. Execute the 
            code in order to check whether the names of the associations and the student roles 
            are loaded correctly from the database.
        </ul>
      </div>
  </p>

  <p>
      <div class="exercisebox"> In the function <TT>create_student_tab</TT>, write the code 
        that creates the combo boxes containing the names of the associations and 
        the student roles associated to the labels "First association", "Second association" and
        "Third association".
        <ul class='rtfm'>
            <li class='rtfm'> Check the <a href="./docs/tkinter.html#comboboxes" target="_blank">Tkinter documentation</a>.
        </ul>
        <ul class="warning">
          <li class="warning"> The combobox containing the association names should appear in the 
            second column, while the one containing the student roles should appear in the third column.
        </ul>
        <ul class="raise">
          <li class="raise"> Execute the code to see the result and, in case of doubts, ask your lab
              supervisor.
        </ul>
      </div>
  </p>

  The last widget that we need to add is the button "Add student". 

  <p>
      <div class="exercisebox"> In the function <TT>create_student_tab</TT>, write the code 
        that creates button "Add student".
        <ul class='rtfm'>
            <li class='rtfm'> Check the <a href="./docs/tkinter.html#button" target="_blank">documentation</a>.
        </ul>
        <ul class="warning">
          <li class="warning"> The button should be placed in the second column in the last row.
        </ul>
        <ul class="raise">
          <li class="raise"> Execute the code to see the result and, in case of doubts, ask your lab
              supervisor.
        </ul>
      </div>
  </p>

  <h4>Handling events in the GUI</h4> 
  Up to now, the GUI is just a static interface that 
  does not react to the user's actions. 
  We need to <b>code the functions</b> that handle the input <b>events</b>.
  In the tab "Student", there are two types of events that need to be handled:
  <ol>
    <li> <b>First event.</b> The user types a student number and moves the mouse cursor out of the text field <TT>student_number_entry</TT>.
    The response of the GUI is to search in the database a student with the specified 
    number; it the student exists, all information about her are loaded and inserted into the form.
    
    <li> <b>Second event.</b> The user clicks on the button "Add student". The response of the GUI is to 
      execute an INSERT INTO query to add the new student to the database.
  </ol>

<p> <b>The first event.</b> 
We define a function <TT>find_student</TT> that is invoked by the GUI when the mouse cursor moves out 
of the text field <TT>student_number_entry</TT>.
We can define <TT>find_student</TT> <b>directly inside</b> the function <TT>create_student_tab()</TT> 
(Python does allow that).

<ul class="exercise">
  <li class="exercise"> Copy the following code right after the definition of the text field <TT>student_number_entry</TT>.
<pre class="line-numbers"><code class="language-python">def find_student(event):
    print("Here you'll write the code to find the student in the database", event.type)
stud_number_entry.bind('&#60;FocusOut&#62;', find_student)</code></pre>
</ul>
Lines 1-2 define the function <TT>find_student</TT>. 
Line 3 tells the GUI to invoke the function <TT>find_student</TT> when the mouse cursor leaves ("focus out") the text field 
<TT>student_number_entry</TT>.

<ul class="warning">
  <li class="warning"> The function <TT>find_student</TT> accepts a parameter <TT>event</TT> that carries information 
    about the event that triggered the call of the function (e.g., its type).
</ul>

</p>

<p>
    <div class="exercisebox"> Execute <TT>main_window.py</TT>, try to enter something in the text field 
      <TT>student_number_entry</TT> and to move the cursor of the mouse out of the textfield.
      <ul class="warning">
        <li class="warning"> In the terminal you should see the message: 
          "Here you'll write the code to find the student in the database FocusOut"
      </ul>
    </div>
</p>

<p>Now, we're going to write the code in the function <TT>find_student</TT> to retrieve a student from the 
  database and fill in the form fields automatically.</p>

<p>The first thing to do is to reset the form fields, meaning that we want to erase any value previously contained
  in those fields.
</p>

<p>
    <div class="exercisebox"> Write the code to erase the content in all the fields of the form.
        <ul class='rtfm'>
            <li class='rtfm'> Check the <a href="./docs/tkinter.html#erase" target="_blank">Tkinter documentation</a>.
        </ul>
      <ul class="warning">
        <li class="warning"> Execute the file <TT>main_window.py</TT>, write some random values in the 
          fields of the form and then try to trigger the function <TT>find_student</TT> to verify that 
          all values are reset.
      </ul>
    </div>
</p>

<p>Now we intend to write the code to load from the database the student with the student number specified in the 
  text field <TT>student_number_entry</TT>. For now, we just load the first and last name, gender and email addresses 
  (we ignore the associations).
</p>

<p>
    <div class="exercisebox"> Write the code to load the first name, last name, gender and email addresses of the student 
      having the student number specified in the text field <TT>student_number_entry</TT>.
        <ul class='rtfm'>
            <li class='rtfm'> Check the <a href="./docs/tkinter.html#getset" target="_blank">Tkinter documentation</a>.
        </ul>
      <ul class="warning">
        <li class="warning"> Remember to use the function <TT>get_student</TT> that you defined in the registration module.
          To import it into your Python file <TT>main_window.py</TT>, add the following line on top 
          of the file:
<pre align="center">
<code>from registration.registration_module import get_student</code></pre>
  <li class="warning"> Remember that the function <TT>get_student</TT> in the registration module returns <TT>None</TT> if no student 
    is found with the given student number.
      <li class="warning"> Execute the code, type the student number 3528 and verify that 
        the fields corresponding to the first name, last name, gender and email addresses are filled in.
      </ul>
    </div>
</p>

<p> Now we need to get the data on the associations too.</p>
  
<p>
    <div class="exercisebox"> Write the code to load the associations from the database and fill in the corresponding 
      fields.
        <ul class='rtfm'>
            <li class='rtfm'> Check the <a href="./docs/tkinter.html#getset" target="_blank">Tkinter documentation</a>.
        </ul>
      <ul class="warning">
        <li class="warning"> Remember to use the function <TT>get_student_associations</TT> 
          that you defined in the registration module.
          To import it into your Python file <TT>main_window.py</TT>, add the following line on top 
          of the file:
<pre align="center">
<code>from registration.registration_module import get_student_associations</code></pre>
  <li class="warning"> Remember that the function <TT>get_student</TT> in the registration module 
    returns <TT>None</TT> if no association is found for the student.
      <li class="warning"> Execute the code, type the student number 3528 and verify that 
        the fields corresponding to the associations are filled in.
      </ul>
    </div>
</p>

<p> <b>The second event.</b> We now define the function <TT>add_student_db</TT> that will be invoked when the 
  button "Add Student" is clicked. 
<ul class="exercise">
  <li class="exercise"> Since we'll need to display messages to the user, we need to import the 
    widget <TT>messagebox</TT> from the library <TT>tkinter</TT>. At the top of the file 
    <TT>main_window.py</TT>, write the following line:
<pre class="line-numbers"><code class="language-python">from tkinter import messagebox</code></pre>
  <li class="exercise"> Copy the following code right before the definition of the button 
    "Add student":
<pre class="line-numbers"><code class="language-python">def add_student_db():
    if len(stud_number_entry.get()) == 0 or \
        len(first_name_entry.get()) == 0 or \
            len(last_name_entry.get()) == 0 or \
                self.rb_gender.get() == '' or \
                    len(email_entry.get()) == 0: 
        messagebox.showerror('Registration error', 'Fill in all the mandatory fields (*)')
        return False</code></pre>
  and in the definition of the button "Add student" add the following option: <TT>command=add_student_db</TT>, so the 
  definition of the button will look like as follows:
<pre class="line-numbers"><code class="language-python">add_button = ttk.Button(stud_tab, text="Add student", command=add_student_db)</code></pre>
</ul>

In the code of the function <TT>add_student_db</TT>, line 2,3,4,5,6 check that the mandatory fields have been filled in.
If this is not the case, the GUI shows a dialog window with the message "Fill in all the mandatory fields (*)" and returns 
<TT>False</TT>.

<p>
    <div class="exercisebox"> Execute the file <TT>main_window.py</TT> and try to click the button 
      "Add student" without entering any information. You should get the error message defined in the function 
      <TT>add_student_db</TT>.
    </div>
</p>

<p>We now write the code to add a student to the database.
    For now, we just add the student number, first and last name, gender and email addresses 
    and we ignore the associations.</p>

<p>
    <div class="exercisebox"> Write the code to add the student number, first and last name, gender and email addresses.
      <ul class="warning">
        <li class="warning"> Remember to use the function <TT>add_student</TT> that you defined in the 
          registration module.
        <li class="warning"> If the function <TT>add_student</TT> returns <TT>False</TT> (which happens when the student cannot be 
          added to the database), display an error message using the function <TT>messagebox.showerror()</TT> and return <TT>False</TT>.
        <li class="warning"> If the function <TT>add_student</TT> returns <TT>True</TT>, display a message
          through the following instruction <TT>messagebox.showinfo('Registration', 'Student added successfully!')</TT>
        <li class="warning"> Try to add a student with student number 4321 and see if you can add it to the database. 
          You might want to verify that the new student is actually in the database by running a query in 
          DB Browser for SQLite.
      </ul>
    </div>
</p>

<p>We finally write the code to add a student to the associations.</p>

<p>
    <div class="exercisebox"> Write the code to add a student to the associations.
      <ul class="warning">
        <li class="warning"> Remember to use the function <TT>add_student_to_associations</TT> that you defined in the 
          registration module.
        <li class="warning"> If the function <TT>add_student_to_associations</TT> 
          returns <TT>False</TT> (which happens when the student cannot be 
          added to the database), display an error message using the function <TT>messagebox.showerror()</TT> and return <TT>False</TT>.
        <li class="warning"> If the function <TT>add_student_to_associations</TT> returns <TT>True</TT>, display a message
          through the following instruction <TT>messagebox.showinfo('Registration', 'Student added successfully to the associations!')</TT>
        <li class="warning"> Try to add yourself to the database.  
          You might want to verify that the new student is actually in the database by running a query in 
          DB Browser for SQLite.
      </ul>
    </div>
</p>

<h2>The Tab Registration</h2>

The code of the tab "Registration" is provided to you.
Just copy and paste the following code into the definition 
of the function <TT>create_registration_tab</TT>.
<pre><code class="language-python">def create_registration_tab(self, nb):
    reg_tab = ttk.Frame(nb)
    nb.add(reg_tab, text='Registration')
    ttk.Label(reg_tab, text="Pistus Edition *").grid(row=0, padx=10, pady=10, sticky='W')
    pistus_edition_entry = ttk.Entry(reg_tab)
    # Get the Pistus edition from the db corresponding to the specified year.
    def get_edition(event):
        reg_fee_entry.configure(state='normal')
        reg_fee_entry.delete(0, tk.END)
        self.cursor.execute("SELECT registration_fee FROM PistusEdition WHERE year=?", (pistus_edition_entry.get(),))
        row = self.cursor.fetchone()
        if row is not None:
            reg_fee_entry.insert(0, row[0])
            reg_fee_entry.configure(state = 'disabled')
    pistus_edition_entry.bind('<FocusOut>', get_edition)
    pistus_edition_entry.grid(row=0, column=1, padx=10, pady=10, sticky='W')
    
    ttk.Label(reg_tab, text="Registration fee *").grid(row=1, padx=10, pady=10, sticky='W')
    reg_fee_entry = ttk.Entry(reg_tab)
    reg_fee_entry.grid(row=1, column=1, padx=10, pady=10, sticky='W')
    
    ttk.Label(reg_tab, text="Student number *").grid(row=2, padx=10, pady=10, sticky='W')
    stud_number_entry = ttk.Entry(reg_tab, textvariable=self.stud_number, state='disabled')
    stud_number_entry.grid(row=2, column=1, padx=10, pady=10, sticky='W')
    
    ttk.Label(reg_tab, text="Registration date *").grid(row=3, padx=10, pady=10, sticky='W')
    reg_date_entry = ttk.Entry(reg_tab)
    reg_date_entry.grid(row=3, column=1, padx=10, pady=10, sticky='W')
    
    ttk.Label(reg_tab, text="Payment date").grid(row=4, padx=10, pady=10, sticky='W')
    payment_date_entry = ttk.Entry(reg_tab)
    payment_date_entry.grid(row=4, column=1, padx=10, pady=10, sticky='W')
    # Adds a new registration
    def add_registration():
        if len(pistus_edition_entry.get()) == 0 or \
            len(reg_fee_entry.get()) == 0 or \
                len(stud_number_entry.get()) == 0 or \
                    len(reg_date_entry.get()) == 0:
            messagebox.showerror("Registration error", 'Fill in all the mandatory fields (*)')
            return False
        try:
            # Check if the pistus edition already exists.
            self.cursor.execute("SELECT * FROM PistusEdition WHERE year=?", (pistus_edition_entry.get(),))
            row = self.cursor.fetchone()
            # if not, we add it.
            if row is None:
                add_pistus_edition(pistus_edition_entry.get(), reg_fee_entry.get(), self.cursor, self.conn)
            
            reg_date = datetime.datetime.strptime(reg_date_entry.get(), '%Y/%m/%d').date()
            payment_date = None
            if len(payment_date_entry.get()) > 0:
                payment_date = datetime.datetime.strptime(payment_date_entry.get(), '%Y/%m/%d').date()
        
            register_student_to_pistus_edition(stud_number_entry.get(), pistus_edition_entry.get(), \
                    reg_date, self.cursor, self.conn, payment_date)
            
        except sqlite3.Error as error:
            messagebox.showerror('Registration error', error)
            return False
        messagebox.showinfo('Registration', 'Registration added successfully!')
        return True

    ttk.Button(reg_tab, text="Register", command=add_registration).grid(row=5, column=1, padx=10, pady=10)</code></pre>

<h2>The Deadline Management Module</h2>

  <p>The <b>Deadline Management module</b> 
  makes sure that all students pay their dues on time.
  More specifically, this module is executed as soon as the application 
  <TT>PistusResa</TT> is opened and then every 24 hours.
  At each execution, the module operates the three following tasks:

  <ol>
    <li> <b>Data Loading.</b> Loads into two separate lists the registrations of the students who have exceeded the
      deadline payment (the deadline payment is computed as the registration date + 5 days)
      and those who still have &#8804; 2  days left to the deadline.
    <li> <b>Registration removal.</b> Removes the registration of the students that have exceeded the deadline payment.
    <li> <b>Email reminder.</b> Sends an email reminder to the students 
      involved in the registrations loaded in the second list. 
  </ol>
 
 
  We're now going to develop the three tasks separately.</p>

  <ul class="exercise">
    <li class="exercise">Create a Python file
    named <TT>dmm.py</TT> in the package <TT>gui</TT>.</li>

    <li class="exercise"> Copy the following code to the file <TT>dmm.py</TT>.
<pre class="line-numbers"><code class="language-python">class DeadlineManagementModule():
  
  def __init__(self, conn, cursor, app):
      self.cursor = cursor
      self.conn = conn
      self.app = app

  def deadline_management(self):
      print("Printing this every 5 seconds")
      self.app.after(5000, self.deadline_management)</code></pre>
The previous code:
<ul>
  <li> Creates a class <TT>DeadlineManagementModule</TT> with three properties: the object 
    <TT>conn</TT> used to connect to the database, the object <TT>cursor</TT> used to 
    query the database and the main window <TT>app</TT> of <TT>PistusResa</TT>.
  <li> Defines a function <TT>deadline_management()</TT> that calls itself every 5 seconds.
</ul>
<li class="exercise"> Add the following lines to the file <TT>main_window.py</TT> right after the 
  line that reads <TT>app = PistusResaGUI(conn, cursor, parent=main_window)</TT>.
<pre class="line-numbers"><code class="language-python">dmm = DeadlineManagementModule(conn, cursor, app)
app.after(0, dmm.deadline_management)</code></pre>
The previous code:
<ul>
  <li> Creates an object <TT>dmm</TT> of the class <TT>DeadlineManagementModule</TT>.
  <li> Calls the function <TT>dmm.deadline_management</TT> immediately when the main window of the 
    application is started.
</ul>
</ul>

<p>
  <div class="exercisebox">
    Run the file <TT>main_window.py</TT> and checks whether the 
    message "Printing this every 5 seconds" appears on the terminal every five seconds.
    <ul class="warning">
      <li class="warning"> Everything's works? Great! You've just created a module that 
        is activated in the background to do so task.
    </ul>
  </div>
</p>

<ul class="exercise">
  <li class="exercise"> By using the graphical interface of 
    <TT>PistusResa</TT>, register yourself to next year's Pistus edition.
    As a registration date, specify two days ago. 
    This way, you'll have in your database one student (you) that has still two days left to the 
    payment deadline. 
    Remember to specify a date in the format YYYY/MM/DD.
</ul>

  <h3>Data Loading</h3>

  In the class <TT>DeadlineManagementModule</TT> we define 
  a function <TT>load_data()</TT> as follows:
<pre><code class="language-python">load_data(self): (expired_registrations, last_minute_payment)</code></pre>
The output of this function is a tuple <TT>(expired_registrations, reminder_registration)</TT>, where:
<ul>
  <li> <TT>expired_registrations</TT> is the list of all registrations that exceeded the payment deadline.
    Remember that the payment deadline is computed as <TT>registration_date</TT> + 5.
    Each item of this list is an object of the class <TT>Registration</TT>
    that you defined in the file <TT>etl.extraction.py</TT>.
  <li> <TT>reminder_registration</TT> is the list of all registrations whose payment deadline is 
  two days from now</TT> Each item of this list is an object of the class <TT>Registration</TT>
  that you defined in the file <TT>etl.extraction.py</TT>.
</ul>

<p>
    <div class="exercisebox"> Write the code for the function 
      <TT>load_data</TT>. 
    <ul class="warning">
      <li class="warning"> In SQLite, you can calculate the difference between 
        two dates by first converting the dates into the Julian days.
        For instance, the following SQL queries loads the number of 
        days between today's date and the registration date 
        for all the registrations.
<pre><code class="language-sql">SELECT julianday('now') - julianday(registration_date)
FROM registration</code></pre> 
    </ul>
    </div>
  </p>
  <ul class="test">
    <li class="test"> Create a file <TT>dmm_load_test.py</TT> in the package <TT>gui</TT>
      and copy the following code:
<pre><code class="language-python">import unittest
import sqlite3
from gui.dmm import DeadlineManagementModule

class TestDataLoad(unittest.TestCase):
    def test_DataLoad(self):
        conn = sqlite3.connect('./db/pistus.db')
        cursor = conn.cursor()
        dmm = DeadlineManagementModule(conn, cursor, None)
        (expired_registrations, reminder_registrations) = dmm.load_data()
        
        self.assertEqual(len(expired_registrations), 42, "The number of expired registrations should be 42")
        self.assertEqual(len(reminder_registrations), 1, "The number of reminder registrations should be 1")
        cursor.close()
        conn.close()

if __name__ == '__main__':
    unittest.main()</code></pre>
  <ul class="warning">
    <li class="warning"> Run this file to check whether your implementation of the function 
        <TT>load_data()</TT> is correct.
    <li class="warning"> This test will also create in the folder <TT>gui</TT> 
      a file named <TT>expired_registrations </TT> that stores all the 
      expired registrations. You'll need them later to verify that 
      these registrations are successfully removed from the database.
  </ul>
  
    
  </ul>

  <h3>Registration Removal</h3>

In the class <TT>DeadlineManagementModule</TT> we define 
  a function <TT>remove_registrations()</TT> as follows:
<pre><code class="language-python">remove_registrations(self, expired_registrations): Success</code></pre>
The input is:
<ul>
  <li> <TT>expired_registrations</TT>. The list of all registrations that missed the payment 
    deadline. This is the first list returned by the function <TT>load_data()</TT>
</ul>
The output is a boolean value:
<ul>
  <li> <TT>True</TT>. If the registrations could be removed.
  <li> <TT>False</TT>. If the registrations could not be removed.
</ul>

  <p>
    <div class="exercisebox"> Write the code to implement the function 
      <TT>remove_registration()</TT>. 
      <ul class="warning">
        <li class="warning"> Remember to commit the modifications to the database.
      </ul>
    </div>
  </p>

  <h3>Email reminder</h3>

In the class <TT>DeadlineManagementModule</TT> we define 
a function <TT>email_reminder()</TT> as follows:
<pre><code class="language-python">email_reminder(self, reminder_registrations)</code></pre>
The input is:
<ul>
  <li> <TT>reminder_registrations.</TT> The list of all registrations 
    whose payment deadline is &#8804; 2  days away. This is the second list returned 
    by the function <TT>load_data</TT>.
</ul> 
The function does not return any output.

<ul class="warning">
  <li class="warning"> In order to actually send an email through a Python program, you would need to connect to the SMTP 
    server of your email provider. 
    However, this will require you to adjust the security settings of your email account, which would expose 
    it to some security risks.
    A solution that we'll use in this lab is to set up a local SMTP debugging server.
    Open a new terminal and type the following command in the terminal:
<pre><code class="language-python">python -m smtpd -c DebuggingServer -n localhost:1025</code></pre>
The previous command will start a SMTP server on <TT>localhost</TT> (that is, your machine) at port 1025.
After executing the command, the terminal will not show any output, it will just hang waiting for connections.
Do not close the terminal window, otherwise you would stop the server.
When you "send" an email through this port, the content of the email is displayed in the terminal.
No actual email is sent.



</ul>

  <p>
    <div class="exercisebox"> Write the code to implement the function
      <TT>email_reminder()</TT>.
      <ul class='rtfm'>
        <li class='rtfm'> You might want to <a href="./docs/email.html" target="_blank">check the documentation</a>
          to find out how to send an email from your Python program.
      </ul>
    </div>
  </p>


  <h3>Putting All Together</h3>
  We now complete the function <TT>deadline_management()</TT> so as it calls the three
  functions defined above. 
  <p>
    <div class="exercisebox"> Complete the function 
      <TT>deadline_management()</TT> by adding the code that calls the three
      functions <TT>load_data()</TT>, <TT>remove_registrations</TT> and 
      <TT>email_reminder</TT>. 
    </div>
  </p>

  <ul class="test">
      <li class="test"> By using DB Browser for SQLite, run the following query:
<pre><code class="language-sql">SELECT * FROM Registration WHERE payment_date IS NULL</code></pre>
You should see only one registration in the table <TT>Registration</TT> (yours).

<li class="test"> Look in the terminal where you opened the SMTP server. 
  You should see the email reminder that you sent. 
  </ul>
  

  <h2>The Registration Management Module</h2>

  <p>The <b>registration management module</b> allows a Pistus organizer to 
    see the registrations and modify the data associated to them.
  In particular, it provides the following functionalities:

  <ul>
    <li> Get all registrations of a specific student.
    <li> Insert a new email address for a student.
    <li> Modify an email  address of a student.
    <li> Delete an email address of a student.
    <li> Remove a student from an association.
    <li> Add a student to an association.
    <li> Remove a registration.
    <li> Update the payment date of a registration.
  </ul>

</p>

  <ul class="exercise">
    <li class="exercise"> Create a new package named <TT>management</TT> and a new file <TT>registration_management.py</TT> in it.
  </ul>

  <h3>Get all the registrations of a student</h3>
  We define the following function in <TT>registration_management.py</TT>.
<pre><code class="language-python">get_registrations(stud_number, cursor): registrations</code></pre>
The input is:
<ul>
  <li> <TT>stud_number</TT>. The number of the student for which the registrations will be returned.
  <li> <TT>cursor</TT>. The object used to query the database.
</ul>
The output is a list where each item is an object of the class <TT>etl.extraction.Registration</TT>.
The list might be empty.

<p>
  <div class="exercisebox"> Write the code to implement the function <TT>remove_registration()</TT>.
    <ul class="warning">
      <li class="warning"> Remember to commit the modifications to the database.
    </ul>

  </div>
</p>

  <h3>Insert an email address</h3>
  We define the following function in <TT>registration_management.py</TT>.
<pre><code class="language-python">insert_email(email_address, stud_number, cursor, conn): success</code></pre>
The input is:
<ul>
  <li> <TT>email_address</TT>. The email address to insert.
  <li> <TT>stud_number</TT>. The number of the student associated to the new email address.
  <li> <TT>cursor</TT>. The object used to query the database.
  <li> <TT>conn</TT>. The object used to connect to the database.
</ul>
The output is a boolean value <TT>success</TT>:
<ul>
  <li> <TT>True</TT>, if the email address could be successfully created.
  <li> <TT>False</TT>, otherwise.
</ul>

<p>
  <div class="exercisebox"> Write the code to implement the function <TT>insert_email()</TT>.
    <ul class="warning">
      <li class="warning"> Remember to commit the modifications to the database.
    </ul>

  </div>
</p>

<h3>Modify an email address</h3>
  We define the following function in <TT>registration_management.py</TT>.
<pre><code class="language-python">modify_email(current_email_address, new_email_address, cursor, conn): success</code></pre>
The input is:
<ul>
  <li> <TT>current_email_address</TT>. The current email address to modify.
  <li> <TT>new_email_address</TT>. The new email address.
  <li> <TT>cursor</TT>. The object used to query the database.
  <li> <TT>conn</TT>. The object used to connect to the database.
</ul>
The output is a boolean value <TT>success</TT>:
<ul>
  <li> <TT>True</TT>, if the email address could be successfully updated.
  <li> <TT>False</TT>, otherwise.
</ul>

<p>
  <div class="exercisebox"> Write the code to implement the function <TT>modify_email()</TT>.
    <ul class="warning">
      <li class="warning"> Remember to commit the modifications to the database.
    </ul>

  </div>
</p>


<h3>Delete an email address</h3>
  We define the following function in <TT>registration_management.py</TT>.
<pre><code class="language-python">delete_email(email_address, cursor, conn): success</code></pre>
The input is:
<ul>
  <li> <TT>email_address</TT>. The email address to delete.
  <li> <TT>cursor</TT>. The object used to query the database.
  <li> <TT>conn</TT>. The object used to connect to the database.
</ul>
The output is a boolean value <TT>success</TT>:
<ul>
  <li> <TT>True</TT>, if the email address could be successfully deleted.
  <li> <TT>False</TT>, otherwise.
</ul>

<p>
  <div class="exercisebox"> Write the code to implement the function <TT>delete_email()</TT>.
    <ul class="warning">
      <li class="warning"> Remember to commit the modifications to the database.
    </ul>

  </div>
</p>

<h3>Remove a student from an association</h3>
  We define the following function in <TT>registration_management.py</TT>.
<pre><code class="language-python">remove_student_from_association(stud_number, asso_name, cursor, conn): success</code></pre>
The input is:
<ul>
  <li> <TT>stud_number</TT>. The number of the student to remove from the association.
  <li> <TT>asso_name</TT>. The name of the association from which the student has to be removed.
  <li> <TT>cursor</TT>. The object used to query the database.
  <li> <TT>conn</TT>. The object used to connect to the database.
</ul>
The output is a boolean value <TT>success</TT>:
<ul>
  <li> <TT>True</TT>, if the student could be successfully removed from the association.
  <li> <TT>False</TT>, otherwise.
</ul>

<p>
  <div class="exercisebox"> Write the code to implement the function <TT>remove_student_from_association()</TT>.
    <ul class="warning">
      <li class="warning"> Remember to commit the modifications to the database.
    </ul>

  </div>
</p>


<h3>Add a student to an association</h3>
  We define the following function in <TT>registration_management.py</TT>.
<pre><code class="language-python">add_student_to_association(stud_number, asso_name, cursor, conn): success</code></pre>
The input is:
<ul>
  <li> <TT>stud_number</TT>. The number of the student to add to the association.
  <li> <TT>asso_name</TT>. The name of the association to which the student has to be added.
  <li> <TT>cursor</TT>. The object used to query the database.
  <li> <TT>conn</TT>. The object used to connect to the database.
</ul>
The output is a boolean value <TT>success</TT>:
<ul>
  <li> <TT>True</TT>, if the student could be successfully added to the association.
  <li> <TT>False</TT>, otherwise.
</ul>

<p>
  <div class="exercisebox"> Write the code to implement the function <TT>add_student_to_association()</TT>.
    <ul class="warning">
      <li class="warning"> Remember to commit the modifications to the database.
    </ul>

  </div>
</p>


<h3>Add a student to an association</h3>
  We define the following function in <TT>registration_management.py</TT>.
<pre><code class="language-python">add_student_to_association(stud_number, asso_name, cursor, conn): success</code></pre>
The input is:
<ul>
  <li> <TT>stud_number</TT>. The number of the student to add to the association.
  <li> <TT>asso_name</TT>. The name of the association to which the student has to be added.
  <li> <TT>cursor</TT>. The object used to query the database.
  <li> <TT>conn</TT>. The object used to connect to the database.
</ul>
The output is a boolean value <TT>success</TT>:
<ul>
  <li> <TT>True</TT>, if the student could be successfully added to the association.
  <li> <TT>False</TT>, otherwise.
</ul>

<p>
  <div class="exercisebox"> Write the code to implement the function <TT>add_student_to_association()</TT>.
    <ul class="warning">
      <li class="warning"> Remember to commit the modifications to the database.
    </ul>

  </div>
</p>

<h3>Remove a Registration</h3>
  We define the following function in <TT>registration_management.py</TT>.
<pre><code class="language-python">remove_registration(stud_number, edition_year, cursor, conn): success</code></pre>
The input is:
<ul>
  <li> <TT>stud_number</TT>. The number of the student for which the registration has to be removed.
  <li> <TT>edition_year</TT>. The year of the Pistus edition from which the student will be removed.
  <li> <TT>cursor</TT>. The object used to query the database.
  <li> <TT>conn</TT>. The object used to connect to the database.
</ul>
The output is a boolean value <TT>success</TT>:
<ul>
  <li> <TT>True</TT>, if the registration could be successfully removed.
  <li> <TT>False</TT>, otherwise.
</ul>

<p>
  <div class="exercisebox"> Write the code to implement the function <TT>remove_registration()</TT>.
    <ul class="warning">
      <li class="warning"> Remember to commit the modifications to the database.
    </ul>

  </div>
</p>

<h3>Update the payment date of a registration</h3>
  We define the following function in <TT>registration_management.py</TT>.
<pre><code class="language-python">update_payment_date(stud_number, edition_year, payment_date, cursor, conn): success</code></pre>
The input is:
<ul>
  <li> <TT>stud_number</TT>. The number of the student for which the payment date will be updated.
  <li> <TT>edition_year</TT>. The year of the Pistus edition for which the payment date will be updated.
  <li> <TT>payment_date</TT>. The new payment date.
  <li> <TT>cursor</TT>. The object used to query the database.
  <li> <TT>conn</TT>. The object used to connect to the database.
</ul>
The output is a boolean value <TT>success</TT>:
<ul>
  <li> <TT>True</TT>, if the payment date could be succesfully updated/
  <li> <TT>False</TT>, otherwise.
</ul>

<p>
  <div class="exercisebox"> Write the code to implement the function <TT>update_payment_date()</TT>.
    <ul class="warning">
      <li class="warning"> Remember to commit the modifications to the database.
    </ul>

  </div>
</p>

<p>
    <div class="exercisebox"> Complete the GUI with all the elements necessary to manage the registrations.
    
    </div>
  </p>


<h2>The Authentification Module</h2>

<p>The goal of the <b>Authentication Module</b> is to 
grant the access to the functionalities of <TT>PistusResa</TT> only 
to authorized users.</p>

<p>More specifically, the module provides two functionalities:
<ul>
  <li> Account creation. Any account is identified by a <b>username</b> and associated to a <b>password</b>.
  <li> Login procedure. In order to get access to <TT>PistusResa</TT>, any user has to connect by specifying 
    her username and password.
</ul>
When an account is created, the username and the password are stored in the Pistus database.
For security reasons, the password will be stored in <b>hashed form</b>, rather than plain text.
To this extent, we'll be using a <b>hashing algorithm</b> that transforms the password 
into another string that is virtually impossible to transform back to the original string.

<ul class="exercise">
  <li class="exercise"> Add to the Pistus database a new table named <TT>Login</TT> by executing the following SQL query in the 
    DB Browser for SQLite.
<pre><code class="language-sql">CREATE TABLE Login(username VARCHAR(50) PRIMARY KEY, password BINARY(32))</code></pre>
The column <TT>password</TT> will store a binary string, which is the hashed form of a password.
</ul>
</p>

<p>When a user wants to log in, she provides her username and password.
  The provided password is then hashed with the same algorithm used to encode it the first time.
  The hashed form of the provided password will be compared with the hashed form stored in the database.
  If the two passwords match, the user will be granted access to <TT>PistusResa</TT>.
</p>

<ul class="warning">
  <li class="warning"> In order to hash a password, we will be using the Python package <TT>passlib</TT>
    that is not included in the Anaconda distribution. 
    In order to install it, if you're a Linux or MacOS user, type the following command:
<pre><code class="language-python">pip install passlib</code></pre>
If you're a Windows user, type tye following command:
<pre><code class="language-python">conda install passlib</code></pre>
</ul>


<ul class="exercise">
  <li class="exercise"> Create a package <TT>authentication</TT> and a new Python file <TT>authentication_module.py</TT> in it.
</ul>  

<h3>Creating an Account</h3>

We define the following function in the file <TT>authentication_module.py</TT>.

<pre><code class="language-python">create_account(username, plain_password, cursor, conn):success</code></pre>
The input is:
<ul>
  <li> <TT>username</TT>. The username associated to the account to be created.
  <li> <TT>plain_password</TT>. The password in plain text to hash.
  <li> <TT>cursor</TT>. The object used to query the database.
  <li> <TT>conn</TT>. The object used to connect to the database.
</ul>

The function will hash the plain text password and will store it into the Pistus database.
The output is a boolean value:

<ul>
    <li> <TT>True</TT>, if the account could be successfully created.
    <li> <TT>False</TT>, otherwise.
</ul>

<p>
  <div class="exercisebox">Write the code to implement the function <TT>create_account</TT>.
    <ul class="rtfm">
      <li class="rtfm"> You might want to <a href="./docs/hashing.html" target="_blank">check the documentation</a> to learn how to hash a password.
    </ul>
  </div>
</p>

<h3>Login procedure</h3>

We define the following function in the file <TT>authentication_module.py</TT>.

<pre><code class="language-python">login(username, plain_password, cursor):success</code></pre>
The input is:
<ul>
  <li> <TT>username</TT>. The username associated to the account used to log in.
  <li> <TT>plain_password</TT>. The password in plain text provided by the user when logging in.
  <li> <TT>cursor</TT>. The object used to query the database.
</ul>

The function will create the hash of the plain text password provided by the user and will compare it against 
the hash version in the database.

The output is a boolean value:

<ul>
    <li> <TT>True</TT>, if the passwords match.
    <li> <TT>False</TT>, otherwise.
</ul>

<p>
  <div class="exercisebox">Write the code to implement the function <TT>login</TT>.
  </div>
</p>

<p>
    <div class="exercisebox"> Complete the GUI with all the elements necessary to create an account and 
      provide a login mechanism.
    </div>
  </p>

</body>

</html>
