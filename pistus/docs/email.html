<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>SIP &ndash; Sending emails</title>
  <link rel="stylesheet" type="text/css" href="../styles/exercises.css">

  <link rel="stylesheet" href="../styles/prism.css">
  <script src="../scripts/prism.js"></script>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

  <script>hljs.initHighlightingOnLoad();</script>
  <script> function
      showHideSolution(elem, elemLink, show, hide) {
      state =
        document.getElementById(elem).style.display; if (state == "none") {
          document.getElementById(elem).style.display = 'block';
          document.getElementById(elemLink).innerHTML = hide
        } else {
        document.getElementById(elem).style.display = 'none';
        document.getElementById(elemLink).innerHTML = show
      }

    } </script>
</head>

<body>
    <h1>Information Systems and Programming</h1>

    <img src="../figs/cs-logo.png" alt="cs-logo" class="logo">
      
    <h1>Sending Emails in Python</h1>

    <p>In order to send emails from a Python program, you need to use the package <TT>smtplib</TT> that is included 
        in your Python distribution. 
        This package uses the <b>SMTP (Simple Mail Transfer Protocol)</b> to communicate with a SMTP server, whose role is to 
        dispatch emails. </p>

    <p>To send an email, your Python program needs to connect to a SMTP server. One option would be to connect to 
        the SMTP server of your email provider, but you'll need to specify your username and password and, more importantly, 
        you'll need to tweak with the security settings of your email account to let the Python program send emails through it.
        This is not recommended as your account security might be compromised.

    </p>
    <p>
        A workaround would be to set up a development email account that you use only to test and debug your application.
        However, the best and fastest solution consists in starting a local SMTP debugging server by typing the following command 
        in a terminal:
<pre><code class="language-python">python -m smtpd -c DebuggingServer -n localhost:1025</code></pre>
This will start a SMTP server at port 1025 on <TT>localhost</TT> your machine.
When sending an email through this server, the content of the email is displayed 
in the terminal. No actual email is sent.
</p>

The code to send a simple email is as follows:

<pre class="line-numbers"><code class="language-python">import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart

s = smtplib.SMTP('localhost', 1025)

mail_text = '''Dear {}, 
this is just a test. I'm now able to send you an email with Python.
Sincerely, 
Your friend Spam'''

msg = MIMEMultipart()
msg['from'] = 'source@email.me'
msg['to'] = 'destination@email.me'
msg['Subject'] = 'This is a test email'
msg.attach(MIMEText(mail_text.format("Dick"), 'plain'))

s.send_message(msg)

s.quit()
</code></pre>

Here is the explanation of the code:
<ul>
    <li> <b>Lines 1 to 3.</b> Import the necessary libraries. <b>MIME (Multipurpose Internet Mail Extension)</b> is the standard format of an email. 
    <li> <b>Line 5.</b> Connect to the local SMTP server at port 1025. If you had to connect to a "real" SMTP server, you would have to specify your login and password too.
    <li> <b>Line 7 to 10.</b> We define the template of the email. 
    <li> <b>Line 12.</b> We create the MIME multipart message. The message can be composed of multiple parts with different formats (text and html for instance).
    <li> <b>Lines 13 to 16.</b> We specify the sender, the receiver, the subject and we attach the text of the message.
    <li> <b>Line 18.</b> We send the message.
    <li> <b>Line 20.</b> We close the connection to the SMTP server.
</ul>

If you want to find out more on this topic, you can read  <a href="https://realpython.com/python-send-email/" target="_blank">this excellent article</a>.
    
</body>

</html>