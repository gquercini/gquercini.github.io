<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Gianluca Quercini">

  
  
  
    
  
  <meta name="description" content="Exercises on SQL">

  
  <link rel="alternate" hreflang="en-us" href="/courses/gadexed/tutorials/sql/">

  


  
  
  
  <meta name="theme-color" content="rgb(0, 136, 204)">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  


  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu68b06f59cdf252d86e7129a31e131766_426695_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu68b06f59cdf252d86e7129a31e131766_426695_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/courses/gadexed/tutorials/sql/">

  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Gianluca Quercini">
  <meta property="og:url" content="/courses/gadexed/tutorials/sql/">
  <meta property="og:title" content="SQL | Gianluca Quercini">
  <meta property="og:description" content="Exercises on SQL"><meta property="og:image" content="img/map[gravatar:%!s(bool=true) shape:circle]">
  <meta property="twitter:image" content="img/map[gravatar:%!s(bool=true) shape:circle]"><meta property="og:locale" content="en-us">
  
    
    
  

  



  


  


  





  <title>SQL | Gianluca Quercini</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Gianluca Quercini</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Gianluca Quercini</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#experience"><span>Experience</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#teaching"><span>Teaching</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      

      

      

    </ul>

  </div>
</nav>


  

  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      


<script src="/js/toggle-menu.js"></script>







  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">

    <a onclick=open_menu_on_click(this) id="tutorials" class="docs-toc-link" href="/courses/gadexed/tutorials/rel-data-modeling/">Tutorials</a>
    
    <div id="tutorials-ddowncontent" class="tutorials-ddowncontent ddowncontent">
    <ul class="nav docs-sidenav">
      
      
      <li class="tutorials">
        <a href="/courses/gadexed/tutorials/rel-data-modeling/">1. Relational data modeling</a>
      </li>
      
      
      <li class="tutorials">
        <a href="/courses/gadexed/tutorials/normalization/">2. Normalization theory</a>
      </li>
      
      <script>open_menu_on_load("tutorials".concat("-ddowncontent"))</script>
      <li class="active tutorials">
        <a href="/courses/gadexed/tutorials/sql/">3. SQL</a>
      </li>
      
      
      <li class="tutorials">
        <a href="/courses/gadexed/tutorials/data-warehouse/">4. Data warehousing</a>
      </li>
      
      
      <li class="tutorials">
        <a href="/courses/gadexed/tutorials/mongodb-data-modeling/">5. Data modeling in MongoDB</a>
      </li>
      
      
      <li class="tutorials">
        <a href="/courses/gadexed/tutorials/mongodb-queries/">6. Queries in MongoDB</a>
      </li>
      
    </ul>
    </div>
    
    

  </div>
  
  
</nav>

    </div>

    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <div class="heading">Gestion et analyse des données — Tutorial 3</div>
          <h1>SQL</h1>
          <hr>
          <div class="logo">
            <p><img src="/img/cs-logo.png" width="20%" style="display: block; margin: auto;" /></p>
            </div>

          <div class="article-style">
            


<p><link rel="stylesheet" href="/styles/course.css">
<link rel="stylesheet" href="/styles/cloud-computing.css"></p>
<p>In this tutorial you’ll learn:</p>
<ul>
<li>The key integrity constraints in a relational database.</li>
<li>Basic SQL queries.</li>
<li>Advanced SQL queries.</li>
</ul>
<div id="installing-postgresql" class="section level1">
<h1>Installing PostgreSQL</h1>
<p>In this tutorial you’ll be using <strong>PostgreSQL</strong> as a
relational database management system (RDBMS).</p>
<details>
<p><summary>Instructions for Windows users</summary></p>
<p>You can download the latest version of PostgreSQL (14.3)
<a href="https://www.enterprisedb.com/downloads/postgres-postgresql-downloads" target="_blank"><strong>from this page</strong></a>.</p>
<p>The installer contains:</p>
<ul>
<li>The PostgreSQL server.</li>
<li>pgAdmin, a graphical administration tool.</li>
</ul>
<p>You’ll find <strong>detailed installation instructions</strong> <a href="https://www.enterprisedb.com/docs/supported-open-source/postgresql/installer/02_installing_postgresql_with_the_graphical_installation_wizard/01_invoking_the_graphical_installer/" target="_blank"><strong>on this page</strong></a>.</p>
</details>
<details>
<p><summary>Instructions for macOS users</summary></p>
<p>The best way to get PostgreSQL is to download and install <strong>Postgres.app</strong>.
You’ll find more details <a href="https://postgresapp.com/" target="_blank"><strong>on this page</strong></a>.</p>
<p>In addition, you need to <a href="https://www.pgadmin.org/download/" target="blank"><strong>install pgAdmin</strong></a>,
ad administration tool that lets you interact with your database through a
graphical interface.</p>
</details>
</div>
<div id="starting-postgresql-and-pgadmin" class="section level1">
<h1>Starting PostgreSQL and pgAdmin</h1>
<details>
<p><summary>Instructions for Windows users</summary></p>
<p>Once the installation is completed, a PostgreSQL server should be
automatically started.</p>
<p>You’ll open a connection to the server through the following steps:</p>
<ul>
<li><p>Execute pgAdmin.</p></li>
<li><p>On the left-side menu, right-click on <em>Servers</em> and select <em>Create server</em>.</p></li>
<li><p>In the <em>General</em> tab, give the server a name of your choice.</p></li>
<li><p>In the <em>Connection</em> tab, write <em>localhost</em> as <em>host</em>.
Don’t change the values of the other options.</p></li>
</ul>
<details>
<p><summary>What if I get the <em>Unable to connect to server</em> error?</summary></p>
<p>You might want to have a look at the list of the services running on your computer to verify
whether the PostgreSQL server is actually running.</p>
<p><a href="https://www.dell.com/support/kbdoc/it-it/000126393/how-to-use-windows-services-to-start-or-stop-services" target="_blank"><strong>This page</strong></a>
explains you how to open the panel with the list of services.
You should locate PostgreSQL in this panel. If the service is not running, you’ll
need to manually start it.</p>
</details>
</details>
<details>
<p><summary>Instructions for MacOS users</summary></p>
<p>You’ll open a connection to the server through the following steps:</p>
<ul>
<li><p>Execute pgAdmin.</p></li>
<li><p>On the left-side menu, right-click on <em>Servers</em> and select <em>Create server</em>.</p></li>
<li><p>In the <em>General</em> tab, give the server a name of your choice.</p></li>
<li><p>In the <em>Connection</em> tab, write <em>localhost</em> as <em>host</em>.
Don’t change the values of the other options.</p></li>
</ul>
</details>
</div>
<div id="obtain-the-data" class="section level1">
<h1>Obtain the data</h1>
<p>We consider the database of a DVD rental store chain containing data on films, actors,
customers and the transactions of the store.</p>
<p>This database goes by the name <strong>Sakila</strong><br />
and was developed by Mike Hillyer, a former member of the MySQL team.</p>
<div class="figure" style="text-align: center"><span id="fig:cnm"></span>
<img src="/courses/databases/tutorial-4/sakila-3nf.png" alt="The conceptual schema of the Sakila database" width="100%" />
<p class="caption">
Figure 1: The conceptual schema of the Sakila database
</p>
</div>
<p>The tables of the database are <a href="https://dev.mysql.com/doc/sakila/en/sakila-structure-tables.html" target="_blank"><strong>documented on this page</strong></a></p>
<p>Sakila has been ported from MySQL to PostgreSQL under the name <strong>pagila</strong>.</p>
<p>In order to import the data into PostgreSQL, follow the steps below:</p>
<ul>
<li><p>From the pgAdmin interface, create a new database (right-click on <em>Databases</em>, select <em>Create database</em>).
You can call the new database <strong>pagila</strong> (or any name you want).</p></li>
<li><p>Download the <a href="/courses/databases/tutorial-4/pagila-insert-data.sql"><strong>dump file pagila-insert-data.sql</strong></a>
This file contains all the SQL statements necessary to create the tables of the database
and populate them with some data.</p></li>
<li><p>Right-click on the new database, select <em>Query tool</em>.</p></li>
<li><p>Click on the second (from the left) small icon on the top menu of the query tool to open a new file.</p></li>
<li><p>Through the interface, locate <em>pagila-schema.sql</em> and open it.</p></li>
<li><p>Hit on the F5 button or click on the <em>play</em> icon on the top menu of the query tool to execute the script.</p></li>
</ul>
<p>The previous steps should have created the schema of the database<br />
and inserted the data.</p>
<p>You can see the list of tables
by selecting (on the left menu) <em>Schemas</em>, <em>public</em>, <em>Tables</em> (15 tables should appear).</p>
<p><strong>Open a new query tool</strong> to do the exercises.</p>
</div>
<div id="integrity-constraints" class="section level1">
<h1>Integrity constraints</h1>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-1" class="exercise"><strong>Exercise 1  </strong></span>
Execute the following statement:</p>
<pre>
insert into film_actor values(1, 25)
</pre>
<p>What is this statement supposed to do?
What is the reaction of the DBMS?</p>
</div>
</div>
<details>
<p><summary>Solution</summary></p>
<div class="infobox exosolution">
<p>This statement should insert a new row in table <TT>film_actor</TT>,
where the value of <TT>actor_id</TT> is 1 and the value of
<TT>film_id</TT> is 25.</p>
<p>The DBMS returns an error because there is already a row
with these values and the two columns
<TT>film_actor</TT>, <TT>film_id</TT> form the primary key.</p>
</div>
</details>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-2" class="exercise"><strong>Exercise 2  </strong></span>
Write the statement to delete the film with
<em>film_id</em>=1 from
the table <TT>Film</TT>.</p>
<p>Execute the command. What happens?</p>
</div>
</div>
<details>
<p><summary>Solution</summary></p>
<div class="infobox exosolution">
<PRE>
delete from film where film_id=1
</PRE>
<p>The statement is rejected because there are rows in other tables
that reference the row that we intend to delete.
This is the effect of the foreign key constraint.</p>
</div>
</details>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-3" class="exercise"><strong>Exercise 3  </strong></span>
Look at the definition of the foreign key constraints
in table <TT>film_actor</TT> (right-click on the table,
select <em>Constraints</em>, <em>foreign key</em>).</p>
<p>Is the definition of the foreign key constraint
to table <TT>film</TT> coherent with the behavior observed
in the previous exercise?</p>
<p><strong>NB</strong> In order to see the options of a foreign key, click on the
edit button on the left of the constraint. Then look at the
tab <em>Action</em>.</p>
</div>
</div>
<details>
<p><summary>Solution</summary></p>
<div class="infobox exosolution">
<p>The foreign key linking table <TT>film_actor</TT> to table
<TT>film</TT> is defined with the option RESTRICT on delete.
This is coherent with the behavior that we observed
in the previous exercise. Referenced rows cannot be deleted if
there are still referencing rows.</p>
</div>
</details>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-4" class="exercise"><strong>Exercise 4  </strong></span>
Execute the following query:</p>
<pre>
SELECT f.film_id as film_id_in_table_film, 
       fa.film_id AS film_id_in_table_film_actor, 
       fa.actor_id as actor_id, f.title as title
FROM film f JOIN film_actor fa ON f.film_id = fa.film_id
WHERE  f.title='ACE GOLDFINGER'
</pre>
<p>What does the query? Note down the identifier of the film in both tables
<TT>film</TT> and <TT>film_actor</TT>.
(columns <TT>film_id_in_table_film</TT> and <TT>film_id_in_table_film_actor</TT>).</p>
</div>
</div>
<details>
<p><summary>Solution</summary></p>
<div class="infobox exosolution">
<p>The query returns the list of all actors in the film titled Ace Goldfinger.
We note that the identifier of the film in both tables is identical (2), as it should
because the query joins the two tables on the equality of these two values.</p>
</div>
</details>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-5" class="exercise"><strong>Exercise 5  </strong></span>
Write and execute a statement to set the value 10000 to the identifier of the
film ACE GOLDFINGER in table <TT>Film</TT>.</p>
<p>After the modification, execute the query of the previous exercise.
What changed? Explain in details what happened.</p>
</div>
</div>
<details>
<p><summary>Solution</summary></p>
<div class="infobox exosolution">
<p>The statement to modify the <TT>film_id</TT> of the given film is as follows:</p>
<p><TT>
UPDATE film
SET film_id=10000
WHERE title=‘ACE GOLDFINGER’
</TT></p>
<p>After executing the same query as the previous exercise, we see that
the identifier of the film has changed in the table <TT>film_actor</TT> too.
This is expected, because the foreign key constraint between the
colum <TT>film_id</TT> in table <TT>film_actor</TT> and the column
<TT>film_id</TT> in table <TT>film</TT> has the option ON UPDATE CASCADE.
This means that if we modify the identifier of the film in table
<TT>film</TT>, the modification is propagated to all the referencing columns.</p>
</div>
</details>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-6" class="exercise"><strong>Exercise 6  </strong></span>
Execute the following statement:</p>
<pre>
UPDATE film_actor
SET film_id=2
WHERE film_id=10000
</pre>
<p>What does? What happens? Explain.</p>
</div>
</div>
<details>
<p><summary>Solution</summary></p>
<div class="infobox exosolution">
<p>The statement intends to set the identifier of the film
titled Ace Goldfinger (in the previous exercise we gave it the identifier 10000)
back to its original value.
However, we execute the statement on the table <TT>film_actor</TT>.
The action is not allowed, as the identifier 2 does not correspond to
any film in table <TT>film</TT>.</p>
<p>The foreign key enforces the referential integrity constraint.
A row cannot refer to a non-existing entity in the referenced table.</p>
</div>
</details>
</div>
<div id="basic-queries" class="section level1">
<h1>Basic queries</h1>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-7" class="exercise"><strong>Exercise 7  </strong></span>
Write the following SQL queries:</p>
<ol style="list-style-type: decimal">
<li><p>Return all the information on all customers.</p></li>
<li><p>Return the first and last name of all customers.</p></li>
<li>Return the first and last name of all customers of the store with identifier 1.</li>
</ol>
</div>
</div>
<details>
<p><summary>Solution</summary></p>
<div class="infobox exosolution">
<ol style="list-style-type: decimal">
<li><pre>
select * 
from customer
</pre></li>
<li><pre>
select first_name, last_name 
from customer
</pre></li>
<li><pre>
select first_name, last_name 
from customer
where store_id=1
</pre></li>
</ol>
</div>
</details>
</div>
<div id="sorting-and-paginating" class="section level1">
<h1>Sorting and paginating</h1>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-8" class="exercise"><strong>Exercise 8  </strong></span>
Write the following SQL queries:</p>
<ol style="list-style-type: decimal">
<li><p>Return the last and first name of all customers. Sort by last name in ascending order.</p></li>
<li><p>Same as in 1., but only return the first 100 customers.</p></li>
<li>Return the last and first name of all customers of the store with identifier 1.
Sort by last name in ascending order and by first name in descending order.</li>
</ol>
</div>
</div>
<details>
<p><summary>Solution</summary></p>
<div class="infobox exosolution">
<ol style="list-style-type: decimal">
<li><pre>
select last_name, first_name 
from customer
order by last_name asc
</pre></li>
<li><pre>
select last_name, first_name 
from customer
order by last_name asc
limit 100
</pre></li>
<li><pre>
select first_name, last_name 
from customer
where store_id=1
</pre></li>
</ol>
</div>
</details>
</div>
<div id="aggregating-queries" class="section level1">
<h1>Aggregating queries</h1>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-9" class="exercise"><strong>Exercise 9  </strong></span>
Write the following SQL queries:</p>
<ol style="list-style-type: decimal">
<li><p>Count the number of films in the database (expected result: 1000).</p></li>
<li><p>How many distinct actor last names are there?</p></li>
<li><p>Compute the total amount of payments across all rentals (expected result: 67416.51).</p></li>
<li><p>Compute the average, minimum and maximum duration of rental across all films
(expected result: 4.9850000000000000, 3, 7).</p></li>
<li><p>Return the number of actors for each film.</p></li>
<li><p>Return the number of copies of each film in each store (table <TT>inventory</TT>).</p></li>
<li><p>Same as 6., but only returns the pairs (film, store) if the number of copies is
greater than or equal to 3.</p></li>
</ol>
</div>
</div>
<details>
<p><summary>Solution</summary></p>
<div class="infobox exosolution">
<ol style="list-style-type: decimal">
<li><pre>
select count(*) 
from film
</pre></li>
<li><pre>
select  count (distinct last_name) 
from actor
</pre></li>
<li><pre>
select sum(amount) 
from payment
</pre></li>
<li><pre>
select avg(rental_duration), min(rental_duration), max(rental_duration) 
from film
</pre></li>
<li><pre>
select film_id, count(*) as nb_actors
from film_actor
group by film_id
</pre></li>
<li><pre>
select film_id, store_id, count(*) as nb_films
from inventory
group by film_id, store_id
</pre></li>
<li><pre>
select film_id, store_id, count(*) as nb_films
from inventory
group by film_id, store_id
having count(*) >=3
</pre></li>
</ol>
</div>
</details>
</div>
<div id="join-queries" class="section level1">
<h1>Join queries</h1>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-10" class="exercise"><strong>Exercise 10  </strong></span>
Write the following SQL queries:</p>
<ol style="list-style-type: decimal">
<li><p>Return the first and last name of the manager of the store with identifier 1 (expected result: Mike Hillyer).</p></li>
<li><p>Return the first and last name of the actors in the film ACE GOLDFINGER.</p></li>
<li><p>Return first and last name of each actor and the number of films in which they played a role.</p></li>
<li><p>Same as in 3., but order by number of films in descending order.</p></li>
<li><p>Same as in 4., but only return actors who played a role in at least 10 films.</p></li>
<li>Return the identifier, the first and family name of the customers who have rented between 10 and 20
movies in the category <em>Family</em>.</li>
</ol>
</div>
</div>
<details>
<p><summary>Solution</summary></p>
<div class="infobox exosolution">
<ol style="list-style-type: decimal">
<li><pre>
select first_name, last_name
from staff join store using(store_id)
where store_id=1
</pre></li>
<li><pre>
select first_name, last_name
from film join film_actor using(film_id) join actor using(actor_id)
where title='ACE GOLDFINGER'
</pre></li>
<li><pre>
select first_name, last_name, count(*) as nb_films
from actor join film_actor using(actor_id)
group by actor_id
</pre></li>
<li><pre>
select first_name, last_name, count(*) as nb_films
from actor join film_actor using(actor_id)
group by actor_id
order by nb_films desc
</pre></li>
<li><pre>
select first_name, last_name, count(*) as nb_films
from actor join film_actor using(actor_id)
group by actor_id
having count(*) >= 10
order by nb_films desc
</pre></li>
<li><pre>
select cust.customer_id, first_name, last_name, count(*) as nb_films
from customer cust join rental using(customer_id) 
  join inventory using(inventory_id)
    join film_category using(film_id)
    join category cat using(category_id)
where cat.name='Family'
group by customer_id
having count(*) between 5 and 10
</pre></li>
</ol>
</div>
</details>
</div>
<div id="miscellaneous-queries" class="section level1">
<h1>Miscellaneous queries</h1>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-11" class="exercise"><strong>Exercise 11  </strong></span>
Write the following SQL queries:</p>
<ol style="list-style-type: decimal">
<li><p>Which last names are <strong>not</strong> repeated in table <em>actor</em>?</p></li>
<li><p>Is a copy of the movie ACADEMY DINOSAUR available for rent from store 1?</p></li>
<li><p>Return the title and the release year of all films in one of the following categories:
<em>Family</em>, <em>Animation</em>, <em>Documentary</em>.</p></li>
</ol>
<details>
<summary>Tip</summary>
You can use the <a href="https://www.w3schools.com/sql/sql_in.asp" target="_blank">operator IN</a>
</details>
<ol start="4" style="list-style-type: decimal">
<li>Find all customers (id, last name, first name) whose last name starts with the letter L.
<details>
<summary>Tip</summary>
You can use the <a href="https://www.w3schools.com/sql/sql_like.asp" target="_blank">operator LIKE</a>
</details></li>
<li>Return the total paid by each customer. For each customer, display a single
column containing first and last name and another column with the total amount paid.
Order the result alphabetically by last name</li>
</ol>
<details>
<summary>Tip</summary>
You can use the <a href="https://www.w3schools.com/sql/func_sqlserver_concat.asp" target="_blank">operator CONCAT</a>
</details>
<ol start="6" style="list-style-type: decimal">
<li><p>Return the total revenue from the rentals across the stores in each country.
Order by descending revenue.</p></li>
<li>The first and last name of the actor that played in the most films.
If two or more actors are tied, the query must return the names of all of them.</li>
</ol>
</div>
</div>
<details>
<p><summary>Solution</summary></p>
<div class="infobox exosolution">
<ol style="list-style-type: decimal">
<li><pre>
select last_name
from actor
group by last_name
having count(*) = 1
</pre></li>
<li><pre>
select distinct i.inventory_id
from film f join inventory i using(film_id)
join rental r using(inventory_id)
where f.title='ACADEMY DINOSAUR' 
    and i.store_id=1 
    and r.return_date is not null  
</pre></li>
<li><pre>
select  distinct f.title, f.release_year
from film f join film_category using(film_id)
join category cat using(category_id)
where cat.name in ('Family', 'Animation', 'Documentary')
</pre></li>
<li><pre>
select customer_id, first_name, last_name
from customer
where last_name LIKE 'L%'
</pre></li>
<li><pre>
select concat(first_name, ' ', last_name), sum(amount)
from customer join payment using (customer_id)
group by customer_id
order by last_name asc
</pre></li>
<li><pre>
select country, sum(amount) as revenue
from payment join rental using (rental_id)
  join inventory using (inventory_id)
  join store using (store_id)
  join address using (address_id)
  join city using (city_id)
  join country using (country_id)
group by country_id
order by revenue desc
</pre></li>
<li>select actor_id, first_name, last_name, count(<em>)
from film_actor join actor using(actor_id)
group by actor_id
having count(</em>) =
(select max(nb_films)
from (select count(*) as nb_films
from film_actor
group by actor_id) t)</li>
</ol>
</div>
</details>
</div>

          </div>

          



          
        </div>

        
      </article>

      

    </main>
  </div>
</div>


      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    <script src="/js/academic.min.6f7ce8be710290b8c431bbc97f405d15.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
