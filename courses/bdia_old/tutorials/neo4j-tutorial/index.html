<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Gianluca Quercini">

  
  
  
    
  
  <meta name="description" content="Description of the Neo4j tutorial.">

  
  <link rel="alternate" hreflang="en-us" href="/courses/bdia_old/tutorials/neo4j-tutorial/">

  


  
  
  
  <meta name="theme-color" content="rgb(0, 136, 204)">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  


  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu68b06f59cdf252d86e7129a31e131766_426695_32x32_fill_lanczos_center_3.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu68b06f59cdf252d86e7129a31e131766_426695_192x192_fill_lanczos_center_3.png">

  <link rel="canonical" href="/courses/bdia_old/tutorials/neo4j-tutorial/">

  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Gianluca Quercini">
  <meta property="og:url" content="/courses/bdia_old/tutorials/neo4j-tutorial/">
  <meta property="og:title" content="Neo4j | Gianluca Quercini">
  <meta property="og:description" content="Description of the Neo4j tutorial."><meta property="og:image" content="img/map[gravatar:%!s(bool=true) shape:circle]">
  <meta property="twitter:image" content="img/map[gravatar:%!s(bool=true) shape:circle]"><meta property="og:locale" content="en-us">
  
    
    
  

  



  


  


  





  <title>Neo4j | Gianluca Quercini</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Gianluca Quercini</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Gianluca Quercini</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#experience"><span>Experience</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#teaching"><span>Teaching</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      

      

      

    </ul>

  </div>
</nav>


  

  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      


<script src="/js/toggle-menu.js"></script>







  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">

    <a onclick=open_menu_on_click(this) id="overview" class="docs-toc-link" href="/courses/bdia_old/overview/">Overview</a>
    
    <div id="overview-ddowncontent" class="overview-ddowncontent ddowncontent">
    <ul class="nav docs-sidenav">
      
      
      <li class="overview">
        <a href="/courses/bdia_old/overview/">Big data algorithms, techniques and platforms</a>
      </li>
      
      
      <li class="overview">
        <a href="/courses/bdia_old/overview/installation-mongodb/">Installing MongoDB</a>
      </li>
      
      
      <li class="overview">
        <a href="/courses/bdia_old/overview/cluster-connection/">Connecting to the cluster</a>
      </li>
      
    </ul>
    </div>
    
    

  </div>
  
  <div class="docs-toc-item">

    <a onclick=open_menu_on_click(this) id="lectures" class="docs-toc-link" href="/courses/bdia_old/lectures/lectures/">Lectures</a>
    
    <div id="lectures-ddowncontent" class="lectures-ddowncontent ddowncontent">
    <ul class="nav docs-sidenav">
      
      
      <li class="lectures">
        <a href="/courses/bdia_old/lectures/lectures/">Overview</a>
      </li>
      
    </ul>
    </div>
    
    

  </div>
  
  <div class="docs-toc-item">

    <a onclick=open_menu_on_click(this) id="tutorials" class="docs-toc-link" href="/courses/bdia_old/tutorials/cc-tutorials/">Tutorials and labs</a>
    
    <div id="tutorials-ddowncontent" class="tutorials-ddowncontent ddowncontent">
    <ul class="nav docs-sidenav">
      
      
      <li class="tutorials">
        <a href="/courses/bdia_old/tutorials/cc-tutorials/">Overview</a>
      </li>
      
      
      <li class="tutorials">
        <a href="/courses/bdia_old/tutorials/map-reduce/">MapReduce</a>
      </li>
      
      
      <li class="tutorials">
        <a href="/courses/bdia_old/tutorials/spark-programming-dce/">Introduction to Spark programming</a>
      </li>
      
      <script>open_menu_on_load("tutorials".concat("-ddowncontent"))</script>
      <li class="active tutorials">
        <a href="/courses/bdia_old/tutorials/neo4j-tutorial/">Neo4j</a>
      </li>
      
      
      <li class="tutorials">
        <a href="/courses/bdia_old/tutorials/spark-lab-assignment/">Lab 1. Advanced Spark programming</a>
      </li>
      
      
      <li class="tutorials">
        <a href="/courses/bdia_old/tutorials/mongodb-tutorial/">Lab2. MongoDB Query Language</a>
      </li>
      
      
      <li class="tutorials">
        <a href="/courses/bdia_old/tutorials/structured-streaming-lab/">Lab 3. Spark structured streaming</a>
      </li>
      
    </ul>
    </div>
    
    

  </div>
  
  <div class="docs-toc-item">

    <a onclick=open_menu_on_click(this) id="references" class="docs-toc-link" href="/courses/bdia_old/references/cc-references/">References</a>
    
    <div id="references-ddowncontent" class="references-ddowncontent ddowncontent">
    <ul class="nav docs-sidenav">
      
      
      <li class="references">
        <a href="/courses/bdia_old/references/cc-references/">Bibliography</a>
      </li>
      
    </ul>
    </div>
    
    

  </div>
  
  
</nav>

    </div>

    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <div class="heading">Big data algorithms, techniques and platforms - Tutorial 5</div>
          <h1>Neo4j</h1>
          <hr>
          <div class="logo">
            
            </div>

          <div class="article-style">
            


<p><link rel="stylesheet" href="/styles/course.css">
<link rel="stylesheet" href="/styles/cloud-computing.css"></p>
<!--

# Setting up the work environment.

* Download [Neo4j Desktop](https://neo4j.com/download/){target="_blank"} 
and install it on your computer.

* Create a new project by clicking on the button "New" 
that you'll find on the top left side of the window.

* Click on "Add Database", then "Create a Local Database".

* Give the database a name (e.g., *MovieLens*) and set 
a password that you can easily remember; then click on "Create".
Choose version 4.1.1 for the database.



* Click on "Start" and wait for the database to become active.

* Click on the button "Open". The *Neo4j Browser* will pop up.

In the next section, you'll have to type a sequence of commands to 
import the data. 
You'll write the commands in the text field on top of the 
*Neo4j Browser* (where you find the prompt *neo4j\$*).

## Import the data.

The dataset consists of 
data obtained from *MovieLens*, 
a recommender system 
whose users give movies a rate 
between 1 and 5, 
based on whether they dislike or love them. 
MovieLens uses the rates to recommend 
movies that its users might like. 
The dataset is modeled as a **directed graph** and 
consists of 100,004 rates on 9,125 movies 
across 671 users between January 9th, 1995 and October 16, 2016. 
The dataset also contains the names of 
the directors and the actors of each movie.

1. Import the **nodes** corresponding to the 
**movies** (label **Movie**) by 
using the following command (it took 31 seconds on my computer):

<pre>
:auto USING PERIODIC COMMIT 1000
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/movies.csv' as row
MERGE (m:Movie {movie_id: toInteger(row.movie_id), title_en:row.movie_title_en, title_fr:row.movie_title_fr, year: toInteger(row.movie_year)})
RETURN count(m)
</pre>

2. Create an **index** on the property *movie_id* of 
the nodes with label **Movie** with the following command:

<pre>
create index movie_idx for (m:Movie) on (m.movie_id)
</pre>

3. Import the **nodes** corresponding to the 
**actors** (label **Actor**) by 
using the following command (it took 62 seconds on my computer):

<pre>
:auto USING PERIODIC COMMIT 1000
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/actors.csv' as row
MERGE (a:Actor {actor_id: toInteger(row.actor_id), name:row.actor_name})
RETURN count(a)
</pre>

4. Create an **index** on the property *actor_id* of 
the nodes with label **Actor** with the following command:

<pre>
create index actor_idx for (a:Actor) on (a.actor_id)
</pre>

5. Import the **nodes** corresponding to the 
**directors** (label **Director**) by 
using the following command (it took 4 seconds on my computer):

<pre>
:auto USING PERIODIC COMMIT 1000
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/directors.csv' as row
MERGE (d:Director {director_id: toInteger(row.director_id), name:row.director_name})
RETURN count(d)
</pre>

6. Create an **index** on the property *director_id* of 
the nodes with label **Director** with the following command:

<pre>
create index director_idx for (d:Director) on (d.director_id)
</pre>


7. Import the **nodes** corresponding to the 
**genres** (label **Genre**) by 
using the following command (it took 197 ms on my computer):

<pre>
:auto USING PERIODIC COMMIT 1000
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/genres.csv' as row
MERGE (g:Genre {genre_id: toInteger(row.genre_id), name:row.genre_name})
RETURN count(g)
</pre>

8. Create an **index** on the property *genre_id* of 
the nodes with label **Genre** with the following command:

<pre>
create index genre_idx for (g:Genre) on (g.genre_id)
</pre>


9. Import the **nodes** corresponding to the 
**users** (label **User**) by 
using the following command (it took 347 seconds on my computer):

<pre>
:auto USING PERIODIC COMMIT 1000
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/users.csv' as row
MERGE (u:User {user_id: toInteger(row.user_id), name:row.user_nickname})
RETURN count(u)
</pre>

10. Create an **index** on the property *user_id* of 
the nodes with label **User** with the following command:

<pre>
create index user_idx for (u:User) on (u.user_id)
</pre>

11. Import the links of type **ACTED_IN** 
between actors and movies with the following 
command (it took 2.5 seconds on my computer):

<pre>
:auto USING PERIODIC COMMIT 1000
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/movies_actors.csv' as row
MATCH (m:Movie {movie_id: toInteger(row.movie_id)})
MATCH (a:Actor {actor_id: toInteger(row.actor_id)})
MERGE (a)-[r:ACTED_IN]->(m)
RETURN count(r)
</pre>

12. Import the links of type **DIRECTED** 
between directors and movies with the following 
command (it took 688 ms on my computer):

<pre>
:auto USING PERIODIC COMMIT 1000
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/movies_directors.csv' as row
MATCH (m:Movie {movie_id: toInteger(row.movie_id)})
MATCH (d:Director {director_id: toInteger(row.director_id)})
MERGE (d)-[r:DIRECTED]->(m)
RETURN count(r)
</pre>

13. Import the links of type **HAS_GENRE** 
between movies and genres with the following 
command (it took 1 second on my computer):

<pre>
:auto USING PERIODIC COMMIT 1000
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/movies_genres.csv' as row
MATCH (m:Movie {movie_id: toInteger(row.movie_id)})
MATCH (g:Genre {genre_id: toInteger(row.genre_id)})
MERGE (m)-[r:HAS_GENRE]->(g)
RETURN count(r)
</pre>

14. Import the links of type **RATED** 
between users and movies with the following 
command (it took 5.9 seconds on my computer):

<pre>
:auto USING PERIODIC COMMIT 1000
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/user_rates.csv' as row
MATCH (m:Movie {movie_id: toInteger(row.movie_id)})
MATCH (u:User {user_id: toInteger(row.user_id)})
MERGE (u)-[r:RATED {rate:toFloat(row.rate)}]->(m)
RETURN count(r)
</pre>

# Exploratory queries

If you looked at the commands used to import the data, 
you might already have an idea as to the structure of 
the graph. 
You can get a glimpse on the node labels, 
the relationship types and the property keys by clicking on the 
button circled in the following figure:

<img src="/courses/plp/tutorials/neo4j/neo4j-db-button.png" width="100%" style="display: block; margin: auto;" />

::: {.infobox .exercisebox data-latex="{exercisebox}"}
**Exercise**
\BeginKnitrBlock{exercise}<div class="exercise"><span class="exercise" id="exr:unnamed-chunk-1"><strong>(\#exr:unnamed-chunk-1) </strong></span>
Write and execute the following query:

<pre>
MATCH (m:Movie {title_en:"Toy Story"}) 
RETURN m;
</pre>

What do you obtain? What are the properties associated 
to a node with label *Movie*? 
Click once on the node to display its properties.
</div>\EndKnitrBlock{exercise}

:::



::: {.infobox .exercisebox data-latex="{exercisebox}"}
**Exercise**
\BeginKnitrBlock{exercise}<div class="exercise"><span class="exercise" id="exr:unnamed-chunk-2"><strong>(\#exr:unnamed-chunk-2) </strong></span>
Double-click on the node displayed as the result of the previous query.
Analyze the neighbouring nodes (their labels and properties) 
and  the incident links (direction, type and properties).
You can move around the node by dragging it in the window.
</div>\EndKnitrBlock{exercise}

:::



# Queries

::: {.infobox .exercisebox data-latex="{exercisebox}"}
**Exercise**
\BeginKnitrBlock{exercise}<div class="exercise"><span class="exercise" id="exr:unnamed-chunk-3"><strong>(\#exr:unnamed-chunk-3) </strong></span>
Write and execute the following queries:

Q1. The genres of the movies in the database.

Q2. The number of movies in the database.

Q3. The title of the movies released in 2015.

Q4. The number of directors by movie. Sort in decreasing order.

Q5. The names of the directors and the title of the movies that they 
directed and in which they also played.

Q6. The genres of the movies in which Tom Hanks played.

Q7. The title and the rate of all the movies that 
the user with identifier 3 rated.
Sort by rate in decreasing order.</div>\EndKnitrBlock{exercise}

:::



## Query chaining

Cypher allows the specification of 
complex queries composed of 
several queries that are concatenated 
with the clause **WITH**. 
We are now going to see an example to 
obtain the titles of the movies 
that have been rated by at least 100 users.

At a first glance, the following query looks like a good solution:

<pre>
MATCH (n:Movie)<-[:RATED]-(u:User) WHERE count(u) >= 100
RETURN n.title_en
LIMIT 5;
</pre>

However, executing this query returns the following error:

<pre>
Invalid use of aggregating function count(...) in this context (line 1, column 42 (offset: 41))
"MATCH (n:Movie)<-[:RATED]-(u:User) WHERE count(u) >= 100"
</pre>

Similarly to SQL, we cannot use aggregating functions in the clause WHERE.

A correct formulation of the query requires the use of the clause WITH
to concatenate two queries: the first will count the number of rates
for each movie:

<pre>
MATCH (n:Movie)<-[:RATED]-(u:User) 
RETURN n, count(u) as nb_rates
</pre>

The second will take in the output of the first and will
filter all the movies where nb_rates < 100. 
In order to chain the two queries, we'll replace the 
RETURN clause in the first query with a WITH clause, as follows:

<pre>
MATCH (n:Movie)<-[:RATED]-(u:User) 
WITH n, count(u) as nb_rates
WHERE nb_rates >= 100
RETURN n.title_en
</pre>

::: {.infobox .exercisebox data-latex="{exercisebox}"}
**Exercise**
\BeginKnitrBlock{exercise}<div class="exercise"><span class="exercise" id="exr:unnamed-chunk-4"><strong>(\#exr:unnamed-chunk-4) </strong></span>
Write and execute a query to obtain  the five movies 
that obtained the best average rate among the movies 
that have been rated by at least 100 users.
</div>\EndKnitrBlock{exercise}

:::



# Movie recommendation

We are now going to see how Neo4j 
can be effectively used in a real application 
by implementing queries that form the basis of a 
simple **movie recommendation system**. 
This system is based on the notion of **collaborative filtering**. 

This consists in recommending a user $u$ some films 
that s/he hasn’t rated yet and other 
users with similar preferences have loved. 
In our context, we say that a user loves 
a movie if s/he rated the movie at least 3.

This concept is explained in the following figure.

<img src="/courses/plp/tutorials/neo4j/collaborative-filtering.png" width="100%" style="display: block; margin: auto;" />

The user $u$ loves 6 movies, 
3 of which are also loved by the user $v$ (the black nodes); 
it is reasonable to think that $u$ 
may also love the two movies that $v$ loved and $u$ hasn’t rated yet.

The principle of collaborative filtering is 
based on the computation of a **similarity score** 
between two users. 
Several similarity scores are possible in this context; 
here, we are going to use the **Jaccard coefficient**. 
Let $L(u)$ and $L(v)$ be the 
sets of movies that $u$ and $v$ love
respectively; 
the similarity score $J(u,v)$ between $u$ and $v$ is given by:

$$
J(u, v) = \frac{|L(u) \cap L(v)|}{|L(u) \cup L(v)|}
$$

In order to recommend movies to 
a target user $v$, 
the recommender system computes the 
similarity score between $v$ and all 
the other users of the system and 
proposes to $v$ the movies 
that s/he hasn’t rated yet and that the $k$ most similar users loved.

We are now going to incrementally write a query to recommend some movies to the target user 3.
The first step consists in determining the value $|L(v)|$.

::: {.infobox .exercisebox data-latex="{exercisebox}"}
**Exercise**
\BeginKnitrBlock{exercise}<div class="exercise"><span class="exercise" id="exr:unnamed-chunk-5"><strong>(\#exr:unnamed-chunk-5) </strong></span>
Write and execute the query to obtain 
the number of movies that the user 3 loved. 
This query must return the target user 
and the number of movies that s/he loves.
</div>\EndKnitrBlock{exercise}

:::




Next, we are going to determine the value $|L(u)|$, 
for all users $u$ except $v$.

::: {.infobox .exercisebox data-latex="{exercisebox}"}
**Exercise**
\BeginKnitrBlock{exercise}<div class="exercise"><span class="exercise" id="exr:unnamed-chunk-6"><strong>(\#exr:unnamed-chunk-6) </strong></span>
Write and execute the query 
to obtain the number of movies that each user $u$ loves, 
except the target user 3.
This query must return each user $u$ and the number 
of movies that s/he loves.
</div>\EndKnitrBlock{exercise}

:::



We put the two queries together with the clause WITH.

::: {.infobox .exercisebox data-latex="{exercisebox}"}
**Exercise**
\BeginKnitrBlock{exercise}<div class="exercise"><span class="exercise" id="exr:unnamed-chunk-7"><strong>(\#exr:unnamed-chunk-7) </strong></span>
Compose the two previous queries with the clause WITH.
This query must return 
the target user 3, 
the number of movies that s/he loves, 
the other users $u$ and the number of movies 
that they love.
</div>\EndKnitrBlock{exercise}

:::



Now, we need to 
determine the value $L(u)\cup L(v)$, 
for each user $u$, and compute the similarity score with the 
Jaccard coefficient. 

::: {.infobox .exercisebox data-latex="{exercisebox}"}
**Exercise**
\BeginKnitrBlock{exercise}<div class="exercise"><span class="exercise" id="exr:unnamed-chunk-8"><strong>(\#exr:unnamed-chunk-8) </strong></span>
Append (by using WITH) 
to the query written in the previous exercise 
a query that obtains 
the number of movies 
that any user $u$ loved 
and that the target user 3 loved too, 
and computes the similarity score
between the target user 3 and $u$. 
This query must return the five most similar 
users to the target user and the similarity scores.

<details>
<summary>Hint</summary>
Multiply the numerator of the equation 
by 1.0, otherwise Cypher will compute an integer division.
</details>

</div>\EndKnitrBlock{exercise}

:::



The last step consists in recommending some movies to the target user.
From the previous query, 
take the identifier of the user $w$ with 
the highest similarity to the target user. 
You are going to use this identifier directly in the new query.

::: {.infobox .exercisebox data-latex="{exercisebox}"}
**Exercise**
\BeginKnitrBlock{exercise}<div class="exercise"><span class="exercise" id="exr:unnamed-chunk-9"><strong>(\#exr:unnamed-chunk-9) </strong></span>
Write and execute 
the query to obtain the list of 
the movies that the user $w$ loved 
and that the target user hasn't rated yet. Sort this list by decreasing rate.

<details>
<summary>Hint</summary>

*  First, write a query 
to obtain the list of the movies 
that the target user rated. 
In the MATCH clause, 
use the variable $m$ to indicate a movie that the target user rated. 
Conclude the query with:

<pre>
RETURN collect(m.title_en) AS movies
</pre>

The function *collect* creates a list called *movies*.

* Replace RETURN with WITH in the previous query and add a 
second query to select the titles of the movies 
$m$ that the user $w$ loved and the target user 
did not rate. 
In order to exclude the films that the target user 
did not rate, use the following predicate:

<pre>
none(x in movies where x=m.title_en)
</pre>

in the WHERE clause.

</details>
</div>\EndKnitrBlock{exercise}

:::



-->

          </div>

          



          
        </div>

        
      </article>

      

    </main>
  </div>
</div>


      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    <script src="/js/academic.min.8741d44cdc5fc49466a5835d1bbea364.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
