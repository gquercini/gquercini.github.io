<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Gianluca Quercini">

  
  
  
    
  
  <meta name="description" content="Text of the lab assignment on Docker &#43; Kubernetes">

  
  <link rel="alternate" hreflang="en-us" href="/courses/cloud-computing/labs/kube-lab/">

  


  
  
  
  <meta name="theme-color" content="rgb(0, 136, 204)">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  


  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu68b06f59cdf252d86e7129a31e131766_426695_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu68b06f59cdf252d86e7129a31e131766_426695_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/courses/cloud-computing/labs/kube-lab/">

  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Gianluca Quercini">
  <meta property="og:url" content="/courses/cloud-computing/labs/kube-lab/">
  <meta property="og:title" content="Multi-service applications in the Cloud | Gianluca Quercini">
  <meta property="og:description" content="Text of the lab assignment on Docker &#43; Kubernetes"><meta property="og:image" content="img/map[gravatar:%!s(bool=true) shape:circle]">
  <meta property="twitter:image" content="img/map[gravatar:%!s(bool=true) shape:circle]"><meta property="og:locale" content="en-us">
  
    
    
  

  



  


  


  





  <title>Multi-service applications in the Cloud | Gianluca Quercini</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Gianluca Quercini</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Gianluca Quercini</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#experience"><span>Experience</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#teaching"><span>Teaching</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      

      

      

    </ul>

  </div>
</nav>


  

  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      


<script src="/js/toggle-menu.js"></script>







  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">

    <a onclick=open_menu_on_click(this) id="overview" class="docs-toc-link" href="/courses/cloud-computing/overview/">Overview</a>
    
    <div id="overview-ddowncontent" class="overview-ddowncontent ddowncontent">
    <ul class="nav docs-sidenav">
      
      
      <li class="overview">
        <a href="/courses/cloud-computing/overview/">Cloud Computing</a>
      </li>
      
      
      <li class="overview">
        <a href="/courses/cloud-computing/overview/installing-docker/">Installing Docker</a>
      </li>
      
    </ul>
    </div>
    
    

  </div>
  
  <div class="docs-toc-item">

    <a onclick=open_menu_on_click(this) id="lectures" class="docs-toc-link" href="/courses/cloud-computing/lectures/lectures/">Lectures</a>
    
    <div id="lectures-ddowncontent" class="lectures-ddowncontent ddowncontent">
    <ul class="nav docs-sidenav">
      
      
      <li class="lectures">
        <a href="/courses/cloud-computing/lectures/lectures/">Overview</a>
      </li>
      
    </ul>
    </div>
    
    

  </div>
  
  <div class="docs-toc-item">

    <a onclick=open_menu_on_click(this) id="tutorials" class="docs-toc-link" href="/courses/cloud-computing/tutorials/cc-tutorials/">Tutorials</a>
    
    <div id="tutorials-ddowncontent" class="tutorials-ddowncontent ddowncontent">
    <ul class="nav docs-sidenav">
      
      
      <li class="tutorials">
        <a href="/courses/cloud-computing/tutorials/cc-tutorials/">Overview</a>
      </li>
      
      
      <li class="tutorials">
        <a href="/courses/cloud-computing/tutorials/tutorial-docker/">1. Getting started with Docker</a>
      </li>
      
      
      <li class="tutorials">
        <a href="/courses/cloud-computing/tutorials/tutorial-kube/">2. Multi-service applications</a>
      </li>
      
    </ul>
    </div>
    
    

  </div>
  
  <div class="docs-toc-item">

    <a onclick=open_menu_on_click(this) id="labs" class="docs-toc-link" href="/courses/cloud-computing/labs/cc-labs/">Lab assignments</a>
    
    <div id="labs-ddowncontent" class="labs-ddowncontent ddowncontent">
    <ul class="nav docs-sidenav">
      
      
      <li class="labs">
        <a href="/courses/cloud-computing/labs/cc-labs/">Overview</a>
      </li>
      
      <script>open_menu_on_load("labs".concat("-ddowncontent"))</script>
      <li class="active labs">
        <a href="/courses/cloud-computing/labs/kube-lab/">1. Docker &amp; Kubernetes</a>
      </li>
      
    </ul>
    </div>
    
    

  </div>
  
  <div class="docs-toc-item">

    <a onclick=open_menu_on_click(this) id="exam" class="docs-toc-link" >Exam</a>
    

  </div>
  
  <div class="docs-toc-item">

    <a onclick=open_menu_on_click(this) id="resources" class="docs-toc-link" href="/courses/cloud-computing/references/cc-references/">Resources</a>
    
    <div id="resources-ddowncontent" class="resources-ddowncontent ddowncontent">
    <ul class="nav docs-sidenav">
      
      
      <li class="resources">
        <a href="/courses/cloud-computing/references/cc-references/">References</a>
      </li>
      
      
      <li class="resources">
        <a href="/courses/cloud-computing/references/docker-primer/">Docker primer</a>
      </li>
      
      
      <li class="resources">
        <a href="/courses/cloud-computing/references/docker-cheat-sheet/">Docker Cheat sheet</a>
      </li>
      
      
      <li class="resources">
        <a href="/courses/cloud-computing/references/linux-introduction/">Introduction to Linux</a>
      </li>
      
    </ul>
    </div>
    
    

  </div>
  
  
</nav>

    </div>

    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <div class="heading">Cloud computing — Lab assignment 1</div>
          <h1>Multi-service applications in the Cloud</h1>
          <hr>
          <div class="logo">
            <p><img src="/img/cs-logo.png" width="20%" style="display: block; margin: auto;" /></p>
            </div>

          <div class="article-style">
            


<p><link rel="stylesheet" href="/styles/course.css">
<link rel="stylesheet" href="/styles/cloud-computing.css"></p>
<div id="objectives" class="section level1 unnumbered">
<h1>Objectives</h1>
<p>In this lab assignment you will:</p>
<ul>
<li><p>Gain a deeper understanding of the <strong>Docker networking model</strong>.</p></li>
<li><p>Build and deploy a multi-service application with <strong>Docker Compose</strong>.</p></li>
<li><p>Deploy a multi-service application on a <strong>local Kubernetes cluster</strong>.</p></li>
<li><p>Deploy a multi-service application on a <strong>Kubernetes cluster</strong> in <strong>Microsoft Azure</strong>.</p></li>
</ul>
</div>
<div id="submission" class="section level1 unnumbered">
<h1>Submission</h1>
<ul>
<li><p>Each submission must be <strong>individual</strong>.</p></li>
<li><p>In order to submit your work, you need to answer all the questions
that you <strong><a href="https://centralesupelec.edunao.com/mod/quiz/view.php?id=51255" target="_blank">find here</a></strong>.
Each question corresponds to an exercise that you find in this page.</p></li>
<li><p>You can answer either <strong>in French</strong> or <strong>in English</strong>. Your pick!</p></li>
<li><p><strong>Deadline: 24 May 2021, 23h59</strong></p></li>
</ul>
<div class="infobox warning">
<p><strong>Warning</strong></p>
<p>This lab assignment is <strong>evaluated</strong>.
You won’t have access to the solutions.
You <strong>can ask questions anytime</strong> (even after the Friday 7 May lab session),
should you run into problems
with the implementation of the assignment.</p>
</div>
</div>
<div id="docker-networking-model" class="section level1">
<h1><span class="header-section-number">1</span> Docker networking model</h1>
<p>We developed a simple chat room in Python that you can download
<a href="/courses/cloud-computing/kube-lab/chat-room.zip">here</a>.
The code has been adapted from <a href="https://github.com/pricheal/python-client-server/" target="_blank">this GitHub project</a>.</p>
<p>Participants use a <em>client</em> program to connect to the chat room;
the chat room is managed by a <em>server</em> application that receives the
client connections and forwards the messages between the users.
The archive contains the following files:</p>
<ul>
<li><em>client.py</em>. Implementation of the chat room client.</li>
<li><em>server.py</em>. Implementation of the chat room server.</li>
<li><em>utils.py</em>. Library with utility functions used in both <em>client.py</em> and <em>server.py</em>.</li>
</ul>
<div class="infobox warning">
<p><strong>Warning</strong></p>
<p>Only one instance of the server is running.
Several instances of the client can run at the same time.
Client instances might not be running on the same host.</p>
<p>In order to execute the server, we need to specify the port number as a parameter.</p>
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:client-server-methodology" class="exercise"><strong>Exercise 1.1  </strong></span>Explain the methodology that you’re going to follow to containerize the client and
the server by using Docker. In particular explain:</p>
<ol style="list-style-type: decimal">
<li><p>How many images you’re creating and why.</p></li>
<li><p>What you need to build the images in Docker.</p></li>
<li><p>Which command are you using to build the images.</p></li>
</ol>
</div>
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-1" class="exercise"><strong>Exercise 1.2  </strong></span>Containerize the application by following the methodology that you outlined in Exercise <a href="#exr:client-server-methodology">1.1</a>.</p>
<strong>Upload the Dockerfiles in the corresponding question on Edunao.</strong>
</div>
<div class="infobox warning">
<p><strong>Warning</strong></p>
<p>The size of the images should be kept as small as possible.
Remember to include in the images only what you need to build and run the application.</p>
</div>
</div>
<div class="infobox curiosity">
<p><strong>Good to know</strong></p>
<p>If you need to inspect the file system of an
image that you create (e.g., to verify that the files that you
copied are actually there), you can open a terminal
in the image by using the following command:</p>
<p><code>docker run -it --entrypoint sh IMAGE_NAME</code></p>
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-2" class="exercise"><strong>Exercise 1.3  </strong></span>
If you built more than one image:</p>
<ol style="list-style-type: decimal">
<li><p>Do they have some common layers?</p></li>
<li>If so, is it something that has an impact on the build time and how?</li>
</ol>
</div>
</div>
<div id="client-and-server-on-the-same-network" class="section level2">
<h2><span class="header-section-number">1.1</span> Client and server on the same network</h2>
<p>We want to execute:</p>
<ul>
<li><p>One instance of the server.</p></li>
<li><p>Two instances of the client.</p></li>
</ul>
<p>The server, as well as the clients, will
<strong>run in Docker containers attached to the same network</strong>.</p>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-3" class="exercise"><strong>Exercise 1.4  </strong></span>
We want to make sure that:</p>
<ol style="list-style-type: decimal">
<li><p>The server and the clients can communicate with each other.</p></li>
<li><p>Other Docker containers <strong>cannot</strong> communicate neither with the server nor with the clients.</p></li>
</ol>
<p>How can you satisfy both requirements in Docker? Explain your solution
and justify it.</p>
</div>
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:client-server-single-network" class="exercise"><strong>Exercise 1.5  </strong></span>
Execute the server and the two clients by using the network configuration that you
explained in the previous exercise.</p>
<ul>
<li><p>The server writes messages on the terminal. Remember to launch the container with the appropriate
options in order to actually see those messages.</p></li>
<li><p>Users need to interact with the client, that is: read and write messages.
Remember to launch the container with the appropriate options in order to actually see those messages.</p></li>
</ul>
<p>Write the <strong>exact commands</strong> that you typed for both configuring the network and
launching the server and the clients. <strong>Explain these commands.</strong></p>
</div>
</div>
<div class="infobox warning">
<p><strong>Shut down the application!</strong></p>
<p>Shut down both the clients and the server before you move on.</p>
<ul>
<li><p>On the client-side, type <code>#quit</code> at any moment to exit the chat room.</p></li>
<li><p>Type Ctrl-C to stop the server.</p></li>
</ul>
</div>
</div>
<div id="client-and-server-on-different-networks" class="section level2">
<h2><span class="header-section-number">1.2</span> Client and server on different networks</h2>
<p>We want to execute:</p>
<ul>
<li><p>One instance of the server.</p></li>
<li><p>Two instances of the client.</p></li>
</ul>
<p>However, <strong>neither client</strong> is connected to the same network as the server.</p>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-4" class="exercise"><strong>Exercise 1.6  </strong></span>
Why can’t you launch the containers with the same settings as
in Exercise <a href="#exr:client-server-single-network">1.5</a>?</p>
<p>What do you propose as a solution instead?</p>
<p><strong>HINT.</strong> You might want to look at <a href="https://centralesupelec.edunao.com/pluginfile.php/135595/mod_resource/content/2/cm2-slides.pdf" target="_blank">slide 77 of the second lecture</a>.</p>
</div>
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-5" class="exercise"><strong>Exercise 1.7  </strong></span>
Execute the server and the two clients by making sure that neither client is connected to the
same network as the server.</p>
<p>Write the <strong>exact commands</strong> that you typed
for both configuring the network and launching the server and the clients.
<strong>Explain these commands.</strong></p>
</div>
</div>
<div class="infobox warning">
<p><strong>Shut down the application!</strong></p>
<p>Shut down both the clients and the server before you move on.</p>
<ul>
<li><p>On the client-side, type <code>#quit</code> at any moment to exit the chat room.</p></li>
<li><p>Type Ctrl-C to stop the server.</p></li>
</ul>
</div>
<!-- docker run -it --entrypoint sh quercinigia/webmeal this is to look into an image -->
<!-- exercise on docker-compose. Look at what Clara Gross did last year -->
</div>
</div>
<div id="multi-service-application-docker-compose" class="section level1">
<h1><span class="header-section-number">2</span> Multi-service application: Docker Compose</h1>
<p>We intend to build and deploy the application <em>TripMeal</em>
by using <strong>Docker Compose</strong>.
You can download the application
<a href="/courses/cloud-computing/kube-lab/tripmeal.zip">here</a>.
The source code has been readapted from
<a href="https://github.com/DanielAndreasen/TripMeal" target="_blank">this GitHub repository</a>.</p>
<p>The downloaded file is an archive.
Extracting the archive will create a folder named
<code>tripmeal_sujet</code>.</p>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-6" class="exercise"><strong>Exercise 2.1  </strong></span>
Explain the structure of the content of the folder <code>tripmeal_sujet</code>.</p>
</div>
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-7" class="exercise"><strong>Exercise 2.2  </strong></span>
How many services has the application?
Specify the technologies (a.k.a., programming languages) used to implement each service.</p>
</div>
</div>
<p>The <code>Dockerfile</code> in the directory <code>db</code> is already implemented.</p>
<div class="infobox warning">
<p><strong>In case you get Exec format error</strong></p>
<p>In order to avoid an <code>Exec format error</code> when you launch the application,
you’ll need to add to your Dockerfile an instruction:</p>
<p><code>RUN chmod -x path_to_file_app</code></p>
<p>where <code>path_to_file_app</code> is the path to the file <code>app.py</code>
<strong>inside the image</strong>.</p>
<!-- https://stackoverflow.com/questions/55271912/flask-cli-throws-oserror-errno-8-exec-format-error-when-run-through-docker-->
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-8" class="exercise"><strong>Exercise 2.3  </strong></span>
Write the <code>Dockerfile</code> in the directory <code>web</code>.
<strong>You need a Python 3.7 environment to run the application.</strong></p>
<p><strong>Upload the Dockerfile to Edunao</strong>.</p>
</div>
</div>
<p>In the folder <code>tripmeal_sujet</code>, you’ll find a file named <code>tripmeal.env</code>.
It contains the definition of <strong>environment variables</strong> that
are used in the application.</p>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-9" class="exercise"><strong>Exercise 2.4  </strong></span>
By reading the values of the environment variables, you can already
know the values to assign to some of the keys in <code>docker-compose.yml</code>.
Can you tell which ones?</p>
</div>
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-10" class="exercise"><strong>Exercise 2.5  </strong></span>
What do you need to define in file <code>docker-compose.yml</code>
to enable the communication between the different services?</p>
</div>
</div>
<p>The database management system used by the application is MySQL.
You can see it by reading the <code>Dockerfile</code> in the directory <code>tripmeal_sujet/db</code>.</p>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-11" class="exercise"><strong>Exercise 2.6  </strong></span>
Which base image is used to build a container for the database?
Where is this base image stored?
Can you find the documentation of this image in the Internet?
Write down the link to the documentation page in the answer.</p>
</div>
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-12" class="exercise"><strong>Exercise 2.7  </strong></span>
By looking at the documentation of the database image,
what do you need to define in <code>docker-compose.yml</code>
to make sure that the data is not deleted once the application is taken down?</p>
</div>
</div>
<p>You’re finally ready to complete the file <code>docker-compose.yml</code>.</p>
<div class="infobox warning">
<p><strong>Warning</strong></p>
<p>Remember that you need to pass the <strong>environment variables</strong>
to your application.</p>
<p>As a documentation of Docker Compose you can use:</p>
<ul>
<li><p>The <a href="/courses/cloud-computing/tutorials/tutorial-kube" target="_blank">examples that we’ve seen together</a>.</p></li>
<li><p>The overview presented on the <a href="https://docs.docker.com/compose/" target="_blank">official Docker website</a>.</p></li>
<li><p>You can also find the full specification of Compose <a href="https://github.com/compose-spec/compose-spec/blob/master/spec.md" target="_blank">here</a>.</p></li>
</ul>
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-13" class="exercise"><strong>Exercise 2.8  </strong></span>
Write the file <code>docker-compose.yml</code>.
Build, deploy and test your application.</p>
<p><strong>Upload the file <code>docker-compose.yml</code> to Edunao.</strong></p>
</div>
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-14" class="exercise"><strong>Exercise 2.9  </strong></span>
Push all the images that you built in this section to
your DockerHub registry.</p>
<p><strong>In the answer to this exercise write the complete names of these images.</strong></p>
</div>
</div>
<div class="infobox warning">
<p><strong>Shut down the application!</strong></p>
<p>Shut down both the application before you move on.</p>
</div>
</div>
<div id="local-kubernetes-cluster" class="section level1">
<h1><span class="header-section-number">3</span> Local Kubernetes cluster</h1>
<p>We intend to deploy the application <em>TripMeal</em> on
a <strong>local Kubernetes cluster</strong> (either Docker Desktop or Minikube).</p>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-15" class="exercise"><strong>Exercise 3.1  </strong></span>
For each service of the application <em>TripMeal</em>, specify which are <strong>stateless</strong>
and which are <strong>stateful</strong>. Justify your answer.</p>
</div>
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-16" class="exercise"><strong>Exercise 3.2  </strong></span>
For each service of the application <em>TripMeal</em>, specify
which Kubernetes objects you need to create and their types.
Justify your answers.</p>
</div>
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-17" class="exercise"><strong>Exercise 3.3  </strong></span>
For each Kubernetes object:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Configure.</strong> Write a Yaml configuration file. Remember that you need to pass the application the environment variables.</p></li>
<li><p><strong>Create.</strong> Create the object in Kubernetes. Which command are you using?</p></li>
<li><p><strong>Analyze.</strong> Execute the command <code>kubectl get all</code> and explain in detail which objects appear in the output as the result of step 2.</p></li>
</ol>
</div>
</div>
<div class="infobox activitybox">
<p><strong>Activity</strong></p>
<p>Play with the application in order to verify that everything works as expected.</p>
</div>
<div class="infobox warning">
<p><strong>Shut down the application!</strong></p>
<p>Shut down the application by removing all the Kubernetes objects.</p>
</div>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-18" class="exercise"><strong>Exercise 3.4  </strong></span>
Create a new file called <code>tripmeal.yml</code> that contains the
definition of all the Kubernetes objects of the application, as we have seen
in the <a href="/courses/cloud-computing/tutorials/tutorial-kube#conclusion" target="_blank">conclusion of the tutorial 2</a>.</p>
<p><strong>Upload this file to Edunao.</strong></p>
</div>
</div>
</div>
<div id="kubernetes-cluster-on-microsoft-azure" class="section level1">
<h1><span class="header-section-number">4</span> Kubernetes cluster on Microsoft Azure</h1>
<p>You’re now going to create a Kubernetes cluster on <strong>Microsoft Azure</strong>
and deploy <em>TripMeal</em> on that cluster.</p>
<div class="infobox warning">
<p><strong>Warning</strong></p>
<p>In order to perform this activity, you need a <strong>student subscription</strong> on Microsoft Azure.
If you haven’t activated it yet:</p>
<ul>
<li><p>Connect to <a href="https://azure.microsoft.com/en-us/free/students/" target="_blank">this webpage</a>.</p></li>
<li><p>Click on <code>Start free</code>.</p></li>
<li><p>Sign in by using your CentraleSupélec credentials.</p></li>
<li><p>Follow the instructions.</p></li>
</ul>
</div>
<p>During this activity, you’ll need to answer some questions that encourage you to
gain a deeper knowledge of the Azure platform and better understand the commands that you type.
<strong>Feel free to read the documentation on the Azure platform in order to answer the questions.</strong></p>
<div id="installing-the-azure-cli" class="section level2">
<h2><span class="header-section-number">4.1</span> Installing the Azure CLI</h2>
<p>In order to create the Kubernetes cluster and deploy the application,
you need to install the <strong>Azure Command Line Interface (CLI)</strong>.
It’s a terminal where you’ll type the commands to create the resources
on Azure.</p>
<details>
<summary>Windows users</summary>
Follow the instructions at <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-windows?tabs=azure-cli" target="_blank">this Web page</a>.
</details>
<details>
<summary>macOS users</summary>
Follow the instructions at <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-macos" target="_blank">this Web page</a>.
</details>
<details>
<p><summary>VM Linux users</summary>
Open a terminal and type the following command:</p>
<p><code>curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash</code></p>
<p>When prompted for a password, just type ENTER and wait for the installation to finish.</p>
</details>
</div>
<div id="login-to-azure-through-cli" class="section level2">
<h2><span class="header-section-number">4.2</span> Login to Azure through CLI</h2>
<p>Whether you’re on Windows, macOS or Linux, you need to <strong>open a terminal</strong>.</p>
<p>In order to log in to your Azure account, type the following command:</p>
<pre class="bash"><code>az login</code></pre>
<p>A Web page will open in your default Web browser, where you can type your username and
password (your CentraleSupélec credentials).
After authenticating your Azure account, you can go back to the terminal, where you should see
some information about your account, such as:</p>
<pre><code>[
  {
    &quot;cloudName&quot;: &quot;AzureCloud&quot;,
    &quot;homeTenantId&quot;: &quot;&lt;id&gt;&quot;,
    &quot;id&quot;: &quot;&lt;id&gt;&quot;,
    &quot;isDefault&quot;: true,
    &quot;managedByTenants&quot;: [],
    &quot;name&quot;: &quot;Azure for Students&quot;,
    &quot;state&quot;: &quot;Enabled&quot;,
    &quot;tenantId&quot;: &quot;&lt;id&gt;&quot;,
    &quot;user&quot;: {
      &quot;name&quot;: &quot;&lt;email-address&gt;&quot;,
      &quot;type&quot;: &quot;user&quot;
    }
  }
]</code></pre>
</div>
<div id="deploy-and-use-azure-container-registry" class="section level2">
<h2><span class="header-section-number">4.3</span> Deploy and use Azure Container Registry</h2>
<p>When we run TripMeal on a local Kubernetes cluster, we assumed that our computer
could have a direct access to the Internet and, therefore, to the DockerHub registry, where we
could pull the images of the TripMeal services.
When we run a containerized application in production, we cannot make this assumption
as the production servers have often no direct access to the Internet.</p>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-20" class="exercise"><strong>Exercise 4.1  </strong></span>
In your view, why isn’t it a good idea to have production servers directly
connected to the Internet?</p>
</div>
</div>
<p>We need to place the images in a container registry that is in the same context
as our production servers.
Since we’re going to run the application on Azure, we can use the
<strong>Azure Container Registry (ACR)</strong>.</p>
<div id="registry-creation" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Registry creation</h3>
<p>First, we need to create a <strong>resource group</strong>.</p>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-21" class="exercise"><strong>Exercise 4.2  </strong></span>
What is a <strong>resource group</strong> in Azure and how is it useful?</p>
</div>
</div>
<p>The command to create a new resource group is the following
(replace RES_GRP_NAME with a name of your choice).</p>
<pre class="bash"><code>az group create --name  RES_GRP_NAME --location eastus</code></pre>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-23" class="exercise"><strong>Exercise 4.3  </strong></span>
In the previous command, what does the <code>location</code> refer to?
Briefly describe this notion (presented in <a href="https://centralesupelec.edunao.com/pluginfile.php/135424/mod_resource/content/5/cm1-slides.pdf" target="_blank">Lecture 1</a>).</p>
</div>
</div>
<p>Next, we need to create a <strong>container registry</strong> with the following command
(replace RES_GRP_NAME with the name of your resource group and REG_NAME with a name of your choice for the registry).</p>
<pre class="bash"><code>az acr create --resource-group RES_GRP_NAME --name REG_NAME --sku Basic</code></pre>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-25" class="exercise"><strong>Exercise 4.4  </strong></span>
In the previous command, what does the <code>sku</code> refer to?
Feel free to look up on the Azure website to find the answer.</p>
</div>
</div>
</div>
<div id="registry-login" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Registry login</h3>
<p>After creating the registry, we can log into it with the following command:</p>
<pre class="bash"><code>az acr login --name REG_NAME</code></pre>
</div>
<div id="image-tagging" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Image tagging</h3>
<p>We’re almost ready to push the images that compose the application <em>TripMeal</em> to the registry.
In order to do that, we need to <strong>tag</strong> (i.e., rename) our images so that their names are
preceded by the <strong>login server name</strong> of the registry.</p>
<p>In order to get the name of the <strong>login server name</strong>
(that we denote here as <code>acrloginserver</code>) of your registry, you can type
the following command:</p>
<pre class="bash"><code>az acr list --resource-group RES_GRP_NAME --query &quot;[].{acrLoginServer:loginServer}&quot; --output table</code></pre>
<p>Your <code>acrloginserver</code> will be something like <code>xxx.azurecr.io</code>.</p>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-28" class="exercise"><strong>Exercise 4.5  </strong></span>
Tag the images that correspond to the services of the application <em>TripMeal</em> so that
their name is similar to: <code>acrloginserver/nameofimage:latest</code></p>
<p>Write the <strong>exact Docker command</strong> that you use to tag the images.</p>
</div>
</div>
</div>
<div id="pushing-the-images" class="section level3">
<h3><span class="header-section-number">4.3.4</span> Pushing the images</h3>
<p>We can push the images with the following command (use your image name
instead of <code>xxx.azurecr.io/imagename:latest</code>).</p>
<pre class="bash"><code>docker push xxx.azurecr.io/imagename:latest</code></pre>
<p>Make sure to <strong>type this command for each image</strong> that you want to push.</p>
<div class="infobox warning">
<p><strong>Warning</strong></p>
<p>It might take few minutes before the images are completely pushed to the registry.</p>
</div>
<p>Finally, verify that the images are actually in the registry with the following command:</p>
<pre class="bash"><code>az acr repository list --name REG_NAME --output table</code></pre>
</div>
</div>
<div id="deploy-a-kubernetes-cluster" class="section level2">
<h2><span class="header-section-number">4.4</span> Deploy a Kubernetes cluster</h2>
<p>We now deploy a <strong>Kubernetes cluster on Azure</strong>.</p>
<div id="cluster-creation" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Cluster creation</h3>
<p>We create the cluster with the following command (replace CLUSTER_NAME
with a name of your choice. As before, RES_GRP_NAME is the name of your resource group
and REG_NAME is the name of the container registry).</p>
<pre class="bash"><code>az aks create \
    --resource-group RES_GRP_NAME \
    --name CLUSTER_NAME \
    --node-count 2 \
    --generate-ssh-keys \
    --attach-acr REG_NAME</code></pre>
<p>The cluster will take a while to start. Time for a coffee!
But before, answer the following question!</p>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-32" class="exercise"><strong>Exercise 4.6  </strong></span>
Can you tell the meaning of the options in the previous command?</p>
</div>
</div>
</div>
<div id="connect-to-the-cluster" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Connect to the cluster</h3>
<p>We can configure <code>kubectl</code> to connect to the newly created cluster.
You need to type the following command:</p>
<pre class="bash"><code>az aks get-credentials --resource-group RES_GRP_NAME --name CLUSTER_NAME</code></pre>
<p>Now, your Kubernetes cluster should be visible locally.
To verify it, type the following command:</p>
<pre class="bash"><code>kubectl config get-contexts</code></pre>
<p>Here <em>context</em> refers to the Kubernetes clusters that <em>kubectl</em> has access to.
The Kubernetes cluster that you created on Azure should be visible in the output; an asterisk
should appear in front of its name, indicating that it is the <em>current context</em>
(that is the Kubernetes cluster being currently referenced by <code>kubectl</code>).</p>
<p>Type the following command:</p>
<pre class="bash"><code>kubectl get nodes</code></pre>
<p>You should see that the Kubernetes cluster has <strong>two nodes</strong>.</p>
</div>
</div>
<div id="deploy-the-application" class="section level2">
<h2><span class="header-section-number">4.5</span> Deploy the application</h2>
<p>We’re almost done! The images are in the registry, the Kubernetes cluster is up and running.
The only missing piece of the puzzle is our application <em>TripMeal</em>.</p>
<p>First thing to do is to slightly modify the file <code>tripmeal.yml</code> that you created at the end
of the previous section.</p>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-36" class="exercise"><strong>Exercise 4.7  </strong></span>
Look at the names of the images of each service in that file. How must these names change?
Modify the file accordingly (<strong>no need to upload it on Edunao</strong>).</p>
</div>
</div>
<p>It is the moment of truth!
Deploy your application by typing the following command:</p>
<pre class="bash"><code>kubectl apply -f tripmeal.yml</code></pre>
<p>Look at Kubernetes objects created after this command:</p>
<pre class="bash"><code>kubectl get all</code></pre>
<p>Get the external IP address of the web service and try to connect to the application,
in the same way you did in the previous section.</p>
<p>If you can play with the application like you did in your local deployment it means that you reached
the conclusion of this assignment! Bravo!</p>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-39" class="exercise"><strong>Exercise 4.8  </strong></span>
Submit a <strong>video</strong> like that the one that <a href="https://webtv.centralesupelec.fr/permalink/v1261a00b74dbbzwk2vr/" target="_blank"><strong>you can see here</strong></a>.</p>
<p>The video must <strong>clearly</strong> show that:</p>
<ul>
<li><p>You’re connected to <strong>your Azure portal</strong> (Email address on the top right corner of the portal).</p></li>
<li><p>All the passages that you see in the sample video: you need to show the <strong>public IP address</strong>
of the application that you deployed, use that address to connect to your application and play
with the application to show that it works correctly.</p></li>
</ul>
</div>
</div>
<p>The next exercise is <strong>optional</strong>.
Before you leave, <strong>make sure to read the conclusion of this document!!</strong>.</p>
<div class="infobox exercisebox">
<p><strong>Exercise</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-40" class="exercise"><strong>Exercise 4.9  </strong></span>
The title of this exercise is <em>Cerise sur le gâteau</em> (aka, this is <strong>optional</strong>!).</p>
<p>At this point, you can connect to <em>TripMeal</em> by using an IP address.
It would be nice if you could use a URL, like in the real websites.
Can you find a way to assign a URL to your web service? <strong>Describe your procedure.</strong></p>
<p>You need a bit of Googling here….</p>
</div>
</div>
</div>
</div>
<div id="conclusion" class="section level1 unnumbered">
<h1>Conclusion</h1>
<p>Make sure you follow these instructions:</p>
<ul>
<li><p>Take down your application in Kubernetes by using the <code>kubectl delete</code> command on each
object that you created.</p></li>
<li><p>Change the context of the <code>kubectl</code> command so that it points back
to a local Kubernetes cluster.</p></li>
</ul>
<p>If your local Kubernetes cluster is <code>docker-desktop</code> type the following command:</p>
<pre class="bash"><code>kubectl config use-context docker-desktop</code></pre>
<p>If your local Kubernetes cluster is <code>minikube</code> type the following command:</p>
<pre class="bash"><code>kubectl config use-context minikube</code></pre>
<ul>
<li><p>On your Azure portal <strong>destroy all the resources</strong> linked to the application
<em>TripMeal</em>, otherwise you’ll get billed even if you don’t use them!</p></li>
<li><p>You can check the balance of your Azure credit <a href="https://www.microsoftazuresponsorships.com/Balance" target="_blank">here</a>.</p></li>
<li><p>You can stop Docker and Kubernetes if you don’t need it anymore.</p></li>
</ul>
</div>

          </div>

          



          
        </div>

        
      </article>

      

    </main>
  </div>
</div>


      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    <script src="/js/academic.min.6f7ce8be710290b8c431bbc97f405d15.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
