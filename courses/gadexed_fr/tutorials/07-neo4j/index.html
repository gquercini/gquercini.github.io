<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Gianluca Quercini">

  
  
  
    
  
  <meta name="description" content="Requêtes Neo4j">

  
  <link rel="alternate" hreflang="en-us" href="/courses/gadexed_fr/tutorials/07-neo4j/">

  


  
  
  
  <meta name="theme-color" content="rgb(0, 136, 204)">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  


  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu68b06f59cdf252d86e7129a31e131766_426695_32x32_fill_lanczos_center_3.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu68b06f59cdf252d86e7129a31e131766_426695_192x192_fill_lanczos_center_3.png">

  <link rel="canonical" href="/courses/gadexed_fr/tutorials/07-neo4j/">

  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Gianluca Quercini">
  <meta property="og:url" content="/courses/gadexed_fr/tutorials/07-neo4j/">
  <meta property="og:title" content="Requêtes Neo4j : le langage Cypher | Gianluca Quercini">
  <meta property="og:description" content="Requêtes Neo4j"><meta property="og:image" content="img/map[gravatar:%!s(bool=true) shape:circle]">
  <meta property="twitter:image" content="img/map[gravatar:%!s(bool=true) shape:circle]"><meta property="og:locale" content="en-us">
  
    
    
  

  



  


  


  





  <title>Requêtes Neo4j : le langage Cypher | Gianluca Quercini</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Gianluca Quercini</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Gianluca Quercini</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#experience"><span>Experience</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#teaching"><span>Teaching</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      

      

      

    </ul>

  </div>
</nav>


  

  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      


<script src="/js/toggle-menu.js"></script>







  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">

    <a onclick=open_menu_on_click(this) id="tutoriels" class="docs-toc-link" href="/courses/gadexed_fr/tutorials/01-rel-data-modeling/">Tutoriels</a>
    
    <div id="tutoriels-ddowncontent" class="tutoriels-ddowncontent ddowncontent">
    <ul class="nav docs-sidenav">
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/01-rel-data-modeling/">1. Modélisation des données relationnelles</a>
      </li>
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/02-sql/">2. SQL</a>
      </li>
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/03-multidimension-modeling/">3. Modélisation multidimensionnelle</a>
      </li>
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/04-mongodb-modeling/">4. Modélisation de données dans MongoDB</a>
      </li>
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/05-mongodb-queries/">5. Requêtes MongoDB</a>
      </li>
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/06-cassandra/">6. Cassandra</a>
      </li>
      
      <script>open_menu_on_load("tutoriels".concat("-ddowncontent"))</script>
      <li class="active tutoriels">
        <a href="/courses/gadexed_fr/tutorials/07-neo4j/">7. Requêtes Neo4j</a>
      </li>
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/08-elastic-search/">8. Elastic Search</a>
      </li>
      
    </ul>
    </div>
    
    

  </div>
  
  
</nav>

    </div>

    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <div class="heading">Gestion et analyse des données — Tutorial 7</div>
          <h1>Requêtes Neo4j : le langage Cypher</h1>
          <hr>
          <div class="logo">
            
            </div>

          <div class="article-style">
            
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p><link rel="stylesheet" href="/styles/course.css">
<link rel="stylesheet" href="/styles/cloud-computing.css"></p>
<!-- # Setting up the work environment.

* Download [Neo4j Desktop](https://neo4j.com/download/){target="_blank"} 
and install it on your computer.

* Create a new instance. Start the new instance. 

* Create a new database MovieLens. (the password can be set to "neo4jneo4j").

* Open the Neo4j Browser in the browser : localhost:7474.


## Import the data.


1. Import the **nodes** corresponding to the 
**movies** (label **Movie**) by 
using the following command (it took 31 seconds on my computer):

<pre>
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/movies.csv' as row
MERGE (m:Movie {movie_id: toInteger(row.movie_id), title_en:row.movie_title_en, title_fr:row.movie_title_fr, year: toInteger(row.movie_year)})
RETURN count(m)
</pre>

1. Create an **index** on the property *movie_id* of 
the nodes with label **Movie** with the following command:

<pre>
create index movie_idx for (m:Movie) on (m.movie_id)
</pre>

3. Import the **nodes** corresponding to the 
**actors** (label **Actor**) by 
using the following command (it took 62 seconds on my computer):

<pre>
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/actors.csv' as row
MERGE (a:Actor {actor_id: toInteger(row.actor_id), name:row.actor_name})
RETURN count(a)
</pre>

1. Create an **index** on the property *actor_id* of 
the nodes with label **Actor** with the following command:

<pre>
create index actor_idx for (a:Actor) on (a.actor_id)
</pre>

5. Import the **nodes** corresponding to the 
**directors** (label **Director**) by 
using the following command (it took 4 seconds on my computer):

<pre>
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/directors.csv' as row
MERGE (d:Director {director_id: toInteger(row.director_id), name:row.director_name})
RETURN count(d)
</pre>

1. Create an **index** on the property *director_id* of 
the nodes with label **Director** with the following command:

<pre>
create index director_idx for (d:Director) on (d.director_id)
</pre>


7. Import the **nodes** corresponding to the 
**genres** (label **Genre**) by 
using the following command (it took 197 ms on my computer):

<pre>
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/genres.csv' as row
MERGE (g:Genre {genre_id: toInteger(row.genre_id), name:row.genre_name})
RETURN count(g)
</pre>

1. Create an **index** on the property *genre_id* of 
the nodes with label **Genre** with the following command:

<pre>
create index genre_idx for (g:Genre) on (g.genre_id)
</pre>


9. Import the **nodes** corresponding to the 
**users** (label **User**) by 
using the following command (it took 347 seconds on my computer):

<pre>
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/users.csv' as row
MERGE (u:User {user_id: toInteger(row.user_id), name:row.user_nickname})
RETURN count(u)
</pre>

1.  Create an **index** on the property *user_id* of 
the nodes with label **User** with the following command:

<pre>
create index user_idx for (u:User) on (u.user_id)
</pre>

11. Import the links of type **ACTED_IN** 
between actors and movies with the following 
command (it took 2.5 seconds on my computer):

<pre>
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/movies_actors.csv' as row
MATCH (m:Movie {movie_id: toInteger(row.movie_id)})
MATCH (a:Actor {actor_id: toInteger(row.actor_id)})
MERGE (a)-[r:ACTED_IN]->(m)
RETURN count(r)
</pre>

1.  Import the links of type **DIRECTED** 
between directors and movies with the following 
command (it took 688 ms on my computer):

<pre>
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/movies_directors.csv' as row
MATCH (m:Movie {movie_id: toInteger(row.movie_id)})
MATCH (d:Director {director_id: toInteger(row.director_id)})
MERGE (d)-[r:DIRECTED]->(m)
RETURN count(r)
</pre>

1.  Import the links of type **HAS_GENRE** 
between movies and genres with the following 
command (it took 1 second on my computer):

<pre>
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/movies_genres.csv' as row
MATCH (m:Movie {movie_id: toInteger(row.movie_id)})
MATCH (g:Genre {genre_id: toInteger(row.genre_id)})
MERGE (m)-[r:HAS_GENRE]->(g)
RETURN count(r)
</pre>

1.  Import the links of type **RATED** 
between users and movies with the following 
command (it took 5.9 seconds on my computer):

<pre>
LOAD CSV WITH HEADERS FROM 'https://gquercini.github.io/courses/plp/tutorials/neo4j/user_rates.csv' as row
MATCH (m:Movie {movie_id: toInteger(row.movie_id)})
MATCH (u:User {user_id: toInteger(row.user_id)})
MERGE (u)-[r:RATED {rate:toFloat(row.rate)}]->(m)
RETURN count(r)
</pre> -->
<div id="préparation-de-lenvironnement-de-travail" class="section level1">
<h1>Préparation de l’environnement de travail</h1>
<ul>
<li><p>Cliquez sur l’icône Neo4j Desktop (sur le bureau) pour ouvrir l’application.</p></li>
<li><p>Assurez-vous que l’instance <em>Local Neo4j server</em> est en cours d’exécution. Si ce n’est pas le cas, cliquez sur le bouton <em>Start instance</em>.</p></li>
<li><p>Cliquez sur le bouton <em>Connect</em> et sélectionnez <em>Query</em>, pour ouvrir le <em>Neo4j Browser</em>.</p></li>
<li><p>Sur la barre supérieure, sélectionnez la base de données <em>movielens</em>.</p></li>
</ul>
</div>
<div id="la-base-de-données" class="section level1">
<h1>La base de données</h1>
<p>La base de données est constituée de
données obtenues à partir de MovieLens,
un système de recommandation
dont les utilisateurs attribuent aux films une note
comprise entre 1 et 5,
selon qu’ils les apprécient peu ou beaucoup.</p>
<p>MovieLens utilise ces notes pour recommander
des films susceptibles de plaire à ses utilisateurs.
Le jeu de données est modélisé comme un <strong>graphe orienté</strong> et
comprend 100 004 notes sur 9 125 films
attribuées par 671 utilisateurs, entre le 9 janvier 1995 et le 16 octobre 2016.
Le jeu de données contient également les noms
des réalisateurs et des acteurs de chaque film.</p>
</div>
<div id="requêtes-exploratoires" class="section level1">
<h1>Requêtes exploratoires</h1>
<p>Dans le navigateur Neo4j, vous pouvez déjà voir un aperçu du modèle de données, à savoir, les types de nœuds et de relations qui composent la base de données.
Dans le champs de texte en haut au centre, vous pouvez écrire des requêtes en langage Cypher pour interroger la base de données.
Nous allons maintenant écrire quelques requêtes simples pour explorer la base de données.</p>
<div class="infobox exercisebox">
<strong>Exercice</strong>

<div class="exercise">
<p><span id="exr:unnamed-chunk-1" class="exercise"><strong>Exercise 1  </strong></span>
Écrivez et exécutez la requête suivante :</p>
<pre>
MATCH (m:Movie {title_en:"Toy Story"}) 
RETURN m;
</pre>
<p>Que obtenez-vous ? Quelles sont les propriétés associées
à un nœud avec le label <em>Movie</em> ?
Cliquez une fois sur le nœud pour afficher ses propriétés.</p>
</div>
</div>
<div class="infobox exercisebox">
<strong>Exercice</strong>

<div class="exercise">
<p><span id="exr:unnamed-chunk-2" class="exercise"><strong>Exercise 2  </strong></span></p>
<p>Faites un double clic sur le nœud affiché comme résultat de la requête précédente.
Analysez les nœuds voisins (leurs labels et propriétés)
et les liens incidents (type et propriétés).</p>
</div>
</div>
</div>
<div id="requêtes-de-base" class="section level1">
<h1>Requêtes de base</h1>
<div class="infobox exercisebox">
<strong>Exercice</strong>

<div class="exercise">
<p><span id="exr:unnamed-chunk-3" class="exercise"><strong>Exercise 3  </strong></span>
Ecrivez et exécutez les requêtes suivantes en Cypher :</p>
<p>Q1. Renvoyez les genres des films de la base de données.</p>
<p>Q2. Renvoyez le nombre de films de la base de données.</p>
<p>Q3. Renvoyez les titres des films sortis en 2015.</p>
<p>Q4. Renvoyez le titre des films et le nombre de réalisateurs par film. Triez par ordre décroissant.</p>
<p>Q5. Renvoyez les noms des réalisateurs et le titre des films qu’ils ont réalisés et dans lesquels ils ont également joué.</p>
<p>Q6. Renvoyez les genres des films dans lesquels Tom Hanks a joué.</p>
<p>Q7. Renvoyez le titre et la note de tous les films que l’utilisateur 3 a notés.
Triez par note décroissante.</p>
</div>
</div>
<div id="chaînes-de-requêtes-avec-with" class="section level2">
<h2>Chaînes de requêtes avec WITH</h2>
<p>Cypher permet la spécification de
requêtes complexes composées de
plusieurs requêtes qui sont concaténées
avec la clause <strong>WITH</strong>.
Nous allons maintenant voir un exemple pour
obtenir les titres des films
qui ont été notés par au moins 100 utilisateurs.</p>
<p>Une première tentative pourrait être la suivante :</p>
<pre>
MATCH (n:Movie)<-[:RATED]-(u:User) WHERE count(u) >= 100
RETURN n.title_en
LIMIT 5;
</pre>
<p>Cependant, cette requête génère une erreur :</p>
<pre>
Invalid use of aggregating function count(...) in this context (line 1, column 42 (offset: 41))
"MATCH (n:Movie)<-[:RATED]-(u:User) WHERE count(u) >= 100"
</pre>
<p>De la même manière qu’en SQL, nous ne pouvons pas utiliser de fonctions d’agrégation dans la clause WHERE.</p>
<p>Une formulation correcte de la requête nécessite l’utilisation de la clause WITH
pour enchaîner deux requêtes. La première comptera le nombre de notes
pour chaque film :</p>
<pre>
MATCH (n:Movie)<-[:RATED]-(u:User) 
RETURN n, count(u) as nb_rates
</pre>
<p>La seconde prendra en entrée le résultat de la première et filtrera tous les films pour lesquels nb_rates &lt; 100.
Afin d’enchaîner les deux requêtes, nous remplacerons la clause RETURN de la première requête par une clause WITH, comme suit :</p>
<pre>
MATCH (n:Movie)<-[:RATED]-(u:User) 
WITH n, count(u) as nb_rates
WHERE nb_rates >= 100
RETURN n.title_en
</pre>
<div class="infobox exercisebox">
<strong>Exercise</strong>

<div class="exercise">
<p><span id="exr:unnamed-chunk-4" class="exercise"><strong>Exercise 4  </strong></span>
Écrivez et exécutez la requête pour obtenir
le titre des cinq films
ayant obtenu la meilleure note moyenne parmi les films
ayant été notés par au moins 100 utilisateurs.</p>
</div>
</div>
</div>
</div>
<div id="système-de-recommandation-de-films" class="section level1">
<h1>Système de recommandation de films</h1>
<p>Nous allons maintenant voir comment Neo4j
peut être utilisé efficacement dans une application réelle
en implémentant des requêtes qui forment la base d’un
simple <strong>système de recommandation de films</strong>.
Ce système est basé sur la notion de <strong>filtrage collaboratif</strong>.</p>
<p>Cette approche consiste à recommander à un utilisateur <span class="math inline">\(u\)</span>
des films qu’il n’a pas encore notés
et que d’autres utilisateurs ayant des préférences similaires ont adorés.
Dans notre contexte, on dit qu’un utilisateur adore
un film s’il l’a noté au moins 3.</p>
<p>Le schéma ci-dessous illustre le principe du filtrage collaboratif.</p>
<p><img src="/courses/plp/tutorials/neo4j/collaborative-filtering.png" width="100%" style="display: block; margin: auto;" /></p>
<p>L’utilisateur <span class="math inline">\(u\)</span> adore 6 films,
dont 3 sont également adorés par l’utilisateur <span class="math inline">\(v\)</span> (les nœuds noirs) ;
il est raisonnable de penser que <span class="math inline">\(u\)</span>
pourrait également adorer les deux films que <span class="math inline">\(v\)</span> a adorés et que <span class="math inline">\(u\)</span> n’a pas encore notés.</p>
<p>Le filtrage collaboratif repose sur le calcul
d’un <strong>score de similarité</strong> entre deux utilisateurs.
Plusieurs scores de similarité sont possibles dans ce contexte ;
ici, nous allons utiliser le <strong>coefficient de Jaccard</strong>.
Soient <span class="math inline">\(L(u)\)</span> et <span class="math inline">\(L(v)\)</span> les
ensembles des films que <span class="math inline">\(u\)</span> et <span class="math inline">\(v\)</span> adorent
respectivement ;
le score de similarité <span class="math inline">\(J(u,v)\)</span> entre <span class="math inline">\(u\)</span> et <span class="math inline">\(v\)</span> est donné par :</p>
<p><span class="math display">\[
J(u, v) = \frac{|L(u) \cap L(v)|}{|L(u) \cup L(v)|}
\]</span></p>
<p>Afin de recommander des films à un utilisateur cible <span class="math inline">\(v\)</span>,
le système de recommandation calcule le
score de similarité entre <span class="math inline">\(v\)</span> et tous
les autres utilisateurs du système et
propose à <span class="math inline">\(v\)</span> les films
qu’il n’a pas encore notés et que les <span class="math inline">\(k\)</span> utilisateurs les plus similaires ont adorés.</p>
<p>Nous allons maintenant écrire une requête Cypher
pour recommander des films à l’utilisateur cible <span class="math inline">\(v\)</span>,
dont l’identifiant est 3.</p>
<p>La première étape consiste à déterminer la valeur <span class="math inline">\(|L(v)|\)</span>.</p>
<div class="infobox exercisebox">
<strong>Exercice</strong>

<div class="exercise">
<p><span id="exr:unnamed-chunk-5" class="exercise"><strong>Exercise 5  </strong></span>
Écrivez et exécutez la requête pour obtenir
le nombre de films que l’utilisateur 3 a adorés.
Cette requête doit renvoyer l’utilisateur cible
et le nombre de films qu’il adore.</p>
</div>
</div>
<p>Après, nous allons déterminer la valeur <span class="math inline">\(|L(u)|\)</span>,
pour tous les utilisateurs <span class="math inline">\(u\)</span> sauf <span class="math inline">\(v\)</span>.</p>
<div class="infobox exercisebox">
<strong>Exercice</strong>

<div class="exercise">
<p><span id="exr:unnamed-chunk-6" class="exercise"><strong>Exercise 6  </strong></span>
Écrivez et exécutez la requête
pour obtenir le nombre de films que chaque utilisateur <span class="math inline">\(u\)</span> adore,
sauf l’utilisateur cible 3.
Cette requête doit renvoyer chaque utilisateur <span class="math inline">\(u\)</span> et le nombre
de films qu’il adore.</p>
</div>
</div>
<p>On met ensuite les deux requêtes ensemble avec la clause WITH.</p>
<div class="infobox exercisebox">
<strong>Exercice</strong>

<div class="exercise">
<p><span id="exr:unnamed-chunk-7" class="exercise"><strong>Exercise 7  </strong></span>
Composez les deux requêtes précédentes avec la clause WITH.
Cette requête doit renvoyer
l’utilisateur cible 3,
le nombre de films qu’il adore,
les autres utilisateurs <span class="math inline">\(u\)</span> et le nombre de films
qu’ils adorent.</p>
</div>
</div>
<p>Maintenant, nous devons
déterminer la valeur <span class="math inline">\(|L(u)\cup L(v)|\)</span>,
pour chaque utilisateur <span class="math inline">\(u\)</span>, et calculer le score de similarité via le
coefficient de Jaccard.</p>
<div class="infobox exercisebox">
<strong>Exercice</strong>

<div class="exercise">
<p><span id="exr:unnamed-chunk-8" class="exercise"><strong>Exercise 8  </strong></span>
Concatenez (en utilisant WITH)
à la requête écrite dans l’exercice précédent
une requête qui obtient
le nombre de films
que tout utilisateur <span class="math inline">\(u\)</span> a adorés
et que l’utilisateur cible 3 a également adorés,
et calcule le score de similarité
entre l’utilisateur cible 3 et <span class="math inline">\(u\)</span>.
Cette requête doit renvoyer les cinq utilisateurs les plus similaires
à l’utilisateur cible et les scores de similarité.</p>
<details>
<summary>
Coup de pouce
</summary>
Il faut multiplier le numérateur de l’équation
par 1.0, sinon Cypher effectuera une division entière.
</details>
</div>
</div>
<p>La dernière étape consiste à recommander
des films à l’utilisateur cible.
À partir de la requête précédente,
prenez l’identifiant de l’utilisateur <span class="math inline">\(w\)</span> avec
la similarité la plus élevée avec l’utilisateur cible.
Vous allez utiliser cet identifiant directement dans la nouvelle requête.</p>
<div class="infobox exercisebox">
<strong>Exercice</strong>

<div class="exercise">
<p><span id="exr:unnamed-chunk-9" class="exercise"><strong>Exercise 9  </strong></span>
Éxecutez la requête suivante pour obtenir
la liste des films que l’utilisateur <span class="math inline">\(w\)</span> a adorés
et que l’utilisateur cible n’a pas encore notés.
Triez cette liste par note décroissante.</p>
<details>
<summary>
Coup de pouce
</summary>
<ul>
<li>D’abord, écrivez une requête
pour obtenir la liste des films
que l’utilisateur cible a notés.
Dans la clause MATCH,
utilisez la variable <span class="math inline">\(m\)</span> pour indiquer un film
que l’utilisateur cible a noté.
Concluez la requête avec :</li>
</ul>
<pre>
RETURN collect(m.title_en) AS movies
</pre>
<p>La fonction <em>collect</em> crée une liste appelée <em>movies</em>.</p>
<ul>
<li>Remplacez RETURN par WITH dans la requête précédente et ajoutez une
deuxième requête pour sélectionner les titres des films
<span class="math inline">\(m\)</span> que l’utilisateur <span class="math inline">\(w\)</span> a adorés et que l’utilisateur cible
n’a pas notés.
Afin d’exclure les films que l’utilisateur cible n’a pas notés,
utilisez le prédicat suivant :</li>
</ul>
<pre>
none(x in movies where x=m.title_en)
</pre>
<p>dans la clause WHERE.</p>
</details>
</div>
</div>
</div>

          </div>

          



          
        </div>

        
      </article>

      

    </main>
  </div>
</div>


      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    <script src="/js/academic.min.3da86581634ab22d5bb3fc4505df30a5.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
