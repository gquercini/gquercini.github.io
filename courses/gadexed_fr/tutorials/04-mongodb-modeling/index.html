<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Gianluca Quercini">

  
  
  
    
  
  <meta name="description" content="MongoDB data modeling exercises">

  
  <link rel="alternate" hreflang="en-us" href="/courses/gadexed_fr/tutorials/04-mongodb-modeling/">

  


  
  
  
  <meta name="theme-color" content="rgb(0, 136, 204)">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  


  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu68b06f59cdf252d86e7129a31e131766_426695_32x32_fill_lanczos_center_3.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu68b06f59cdf252d86e7129a31e131766_426695_192x192_fill_lanczos_center_3.png">

  <link rel="canonical" href="/courses/gadexed_fr/tutorials/04-mongodb-modeling/">

  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Gianluca Quercini">
  <meta property="og:url" content="/courses/gadexed_fr/tutorials/04-mongodb-modeling/">
  <meta property="og:title" content="Modélisation de données dans MongoDB | Gianluca Quercini">
  <meta property="og:description" content="MongoDB data modeling exercises"><meta property="og:image" content="img/map[gravatar:%!s(bool=true) shape:circle]">
  <meta property="twitter:image" content="img/map[gravatar:%!s(bool=true) shape:circle]"><meta property="og:locale" content="en-us">
  
    
    
  

  



  


  


  





  <title>Modélisation de données dans MongoDB | Gianluca Quercini</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Gianluca Quercini</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Gianluca Quercini</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#experience"><span>Experience</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#teaching"><span>Teaching</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      

      

      

    </ul>

  </div>
</nav>


  

  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      


<script src="/js/toggle-menu.js"></script>







  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">

    <a onclick=open_menu_on_click(this) id="tutoriels" class="docs-toc-link" href="/courses/gadexed_fr/tutorials/01-rel-data-modeling/">Tutoriels</a>
    
    <div id="tutoriels-ddowncontent" class="tutoriels-ddowncontent ddowncontent">
    <ul class="nav docs-sidenav">
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/01-rel-data-modeling/">1. Modélisation des données relationnelles</a>
      </li>
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/02-sql/">2. SQL</a>
      </li>
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/03-multidimension-modeling/">3. Modélisation multidimensionnelle</a>
      </li>
      
      <script>open_menu_on_load("tutoriels".concat("-ddowncontent"))</script>
      <li class="active tutoriels">
        <a href="/courses/gadexed_fr/tutorials/04-mongodb-modeling/">4. Modélisation de données dans MongoDB</a>
      </li>
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/05-mongodb-queries/">5. Requêtes MongoDB</a>
      </li>
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/06-cassandra/">6. Cassandra</a>
      </li>
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/07-neo4j/">7. Requêtes Neo4j</a>
      </li>
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/08-elastic-search/">8. Elasticsearch</a>
      </li>
      
      
      <li class="tutoriels">
        <a href="/courses/gadexed_fr/tutorials/09-spark-streaming/">9. Spark Streaming</a>
      </li>
      
    </ul>
    </div>
    
    

  </div>
  
  
</nav>

    </div>

    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <div class="heading">Gestion et analyse des données — Tutoriel 4</div>
          <h1>Modélisation de données dans MongoDB</h1>
          <hr>
          <div class="logo">
            
            </div>

          <div class="article-style">
            
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p><link rel="stylesheet" href="/styles/course.css">
<link rel="stylesheet" href="/styles/cloud-computing.css"></p>
<div id="scénario-applicatif" class="section level1">
<h1>Scénario applicatif</h1>
<p>La base de données Sakila est soumise à un nombre croissant de requêtes
de la part du personnel et des clients à travers le monde.
Une base de données centralisée n’est plus suffisante pour servir toutes
les requêtes et la société envisage de distribuer la base de données sur
plusieurs serveurs (scalabilité horizontale).
Cependant, une base de données relationnelle ne gère pas très bien la scalabilité
horizontale, en raison du fait que les données sont dispersées dans de nombreuses
tables, résultat du processus de normalisation.
Ainsi, l’équipe Sakila se tourne vers vous pour l’aider à migrer la base
de données de PostgreSQL vers MongoDB.</p>
<p>Pour que la migration ait lieu, il est nécessaire de concevoir un modèle de données
approprié.
Dès les premières discussions avec la direction de Sakila,
vous comprenez rapidement qu’une des principales utilisations de la base de données est de
gérer (ajouter, mettre à jour et lire) les informations de location.</p>
<div class="figure" style="text-align: center"><span id="fig:cnm"></span>
<img src="/courses/databases/gadexed/tutorial-3/sakila-db.png" alt="Modèle physique de la base de données Sakila" width="100%" />
<p class="caption">
Figure 1: Modèle physique de la base de données Sakila
</p>
</div>
</div>
<div id="analysis-of-the-existing-model" class="section level1">
<h1>Analysis of the existing model</h1>
<p>Le modèle physique de la base de données Sakila est illustré dans la figure 1.</p>
<div class="infobox exercisebox">
<p><strong>Exercice</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-1" class="exercise"><strong>Exercise 1  </strong></span>
Determinez la cardinalité (un-à-un, un-à-plusieurs, plusieurs-à-plusieurs)
de chacune des associations
dans lesquelles la table <TT>Rental</TT> est impliquée.</p>
</div>
</div>
<details>
<summary>
Solution
</summary>
<div class="infobox exosolution">
<p>L’entité <TT>Rental</TT> est associée aux tables suivantes :</p>
<ul>
<li><p><TT>Inventory</TT>. Une location porte sur un seul support (par ex., un DVD).
Un support peut être loué plusieurs fois. Il s’agit d’une <strong>association un-à-plusieurs</strong>.</p></li>
<li><p><TT>Staff</TT>. Une location est prise en charge par un seul membre du personnel.
Un membre du personnel peut prendre en charge plusieurs locations. Il s’agit d’une <strong>association un-à-plusieurs</strong>.</p></li>
<li><p><TT>Customer</TT>. Une location est effectuée par un seul client. Un client peut effectuer
plusieurs locations. Il s’agit d’une <strong>association un-à-plusieurs</strong>.</p></li>
<li><p><TT>Payment</TT>. Un paiement est associé à une seule location. Une location peut avoir un seul
paiement. Il s’agit d’une <strong>association un-à-un</strong>.</p></li>
</ul>
</div>
</details>
<div class="infobox exercisebox">
<p><strong>Exercice</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-2" class="exercise"><strong>Exercise 2  </strong></span>
Regardez la définition des tables <TT>Rental</TT> et <TT>Customer</TT> en Figure 1.</p>
<p><strong>Estimez la taille d’une ligne en octets dans les deux tables.</strong></p>
<p>Les informations suivantes vous aideront dans la tâche :</p>
<ul>
<li><p>La taille de stockage d’un type de données numériques est clairement indiquée dans <a href="https://www.postgresql.org/docs/8.1/datatype.html#DATATYPE-NUMERIC" target="_blank"><strong>la documentation PostgreSQL</strong></a>.</p></li>
<li><p>La taille de stockage des types de date/heure est clairement indiquée dans <a href="https://www.postgresql.org/docs/8.1/datatype-datetime.html" target="_blank"><strong>la documentation PostgreSQL</strong></a>.</p></li>
<li><p>Les colonnes de type <TT>text</TT> contiennent des caractères UTF-8. Nous supposons que chaque caractère occupe 1 octet (bien que certains caractères puissent nécessiter plus d’un octet).</p></li>
<li><p>Les colonnes de type <T>boolean</T> nécessitent 1 octet de stockage.</p></li>
<li><p>Nous supposons qu’une adresse e-mail fait en moyenne 25 caractères.</p></li>
<li><p>Nous supposont qu’un nom de famille fait en moyenne 7 caractères.</p></li>
<li><p>Nous supposont qu’un prénom fait en moyenne 6 caractères.</p></li>
<li><p>Nous ignorons les colonnes <TT>last_update</TT> et <TT>create_date</TT> dans les deux tables.</p></li>
<li><p>Dans la table <TT>Customer</TT>, nous ignorons la colonne <TT>active</TT>.</p></li>
</ul>
</div>
</div>
<details>
<summary>
Solution
</summary>
<div class="infobox exosolution">
<p>Pour la table <TT>Rental</TT> nous avons :</p>
<ul>
<li><p><TT>rental_id</TT>, <TT>integer</TT>, <strong>4 octets</strong>.</p></li>
<li><p><TT>rental_date</TT>, <TT>timestamp with time zone</TT>, <strong>8 octets</strong>.</p></li>
<li><p><TT>inventory_id</TT>, <TT>integer</TT>, <strong>4 octets</strong>.</p></li>
<li><p><TT>customer_id</TT>, <TT>smallint</TT>, <strong>2 octets</strong>.</p></li>
<li><p><TT>return_date</TT>, <TT>timestamp with time zone</TT>, <strong>8 octets</strong>.</p></li>
<li><p><TT>staff_id</TT>, <TT>smallint</TT>, <strong>2 octets</strong>.</p></li>
</ul>
<p>En total, une ligne dans la table <TT>Rental</TT> nécessite <strong>28 octets</strong> de stockage.</p>
<p>Pour la table <TT>Customer</TT> nous avons :</p>
<ul>
<li><p><TT>customer_id</TT>, <TT>integer</TT>, <strong>4 octets</strong>.</p></li>
<li><p><TT>store_id</TT>, <TT>smallint</TT>, <strong>2 octets</strong>.</p></li>
<li><p><TT>first_name</TT>, <TT>text</TT>, <strong>6 octets</strong> (average).</p></li>
<li><p><TT>last_name</TT>, <TT>text</TT>, <strong>7 octets</strong> (average).</p></li>
<li><p><TT>email</TT>, <TT>text</TT>, <strong>25 octets</strong> (average).</p></li>
<li><p><TT>address_id</TT>, <TT>smallint</TT>, <strong>2 octets</strong>.</p></li>
<li><p><TT>activebool</TT>, <TT>boolean</TT>, <strong>1 octets</strong>.</p></li>
</ul>
<p>En total, une ligne dans la table <TT>Customer</TT> nécessite <strong>47 octets</strong> de stockage.</p>
</div>
</details>
</div>
<div id="considérations-pour-le-modèle-mongodb" class="section level1">
<h1>Considérations pour le modèle MongoDB</h1>
<p>Nous devons maintenant réfléchir à la manière de modéliser les données
dans MongoDB. Les considérations faites à la section précédente seront
utiles pour cette tâche.</p>
<div class="infobox exercisebox">
<p><strong>Exercice</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-3" class="exercise"><strong>Exercise 3  </strong></span>
Comment modéliseriez-vous dans MongoDB les entités <TT>Rental</TT>
et <TT>Payment</TT>, compte tenu des cardinalités que vous avez identifiées dans la section précédente?</p>
</div>
</div>
<details>
<summary>
Solution
</summary>
<div class="infobox exosolution">
<p>L’association entre les deux entités est <B>un-à-un</B>.
Par conséquent, nous pouvons utiliser un schéma dénormalisé dans MongoDB.</p>
<p>C’est-à-dire que nous pouvons créer une seule collection pour stocker les informations sur les deux entités.</p>
<p>Nous avons deux options :</p>
<ul>
<li><p>Nous créons une collection <TT>Payment</TT>, où chaque document contient
les attributs d’un paiement et un document intégré avec les détails de la location
relative au paiement.</p></li>
<li><p>Nous créons une collection <TT>Rental</TT>, où chaque document contient
les attributs d’une location et un document intégré avec les détails du paiement
relatif à la location.</p></li>
</ul>
<p>Bien que les deux options soient parfaitement valables, nous préférons la deuxième, car
les locations sont les acteurs principaux dans notre base de données.</p>
<p>Nous pouvons aussi considérer les attributs d’un paiement comme des attributs
d’une location, sans créer de document intégré pour le paiement.</p>
</div>
</details>
<div class="infobox exercisebox">
<p><strong>Exercice</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-4" class="exercise"><strong>Exercise 4  </strong></span>
Supposons que nous créons une collection <TT>Customer</TT>
et que nous intégrons dans chaque document décrivant un client la liste des locations
effectuées par ce client.</p>
<p>Combien de locations pouvons-nous stocker au maximum pour un client donné, sachant
que la taille d’un document ne peut pas dépasser 16 Mo?</p>
</div>
</div>
<details>
<summary>
Solution
</summary>
<div class="infobox exosolution">
<p>Nous avons vu précédemment que chaque document de location nécessite 28 octets.
Pour faciliter le calcul, nous arrondissons cette taille à 32 octets (une puissance de deux).
Sachant que 16 Mo = <span class="math inline">\(16 \times 2^{20}\)</span>, le nombre maximum de locations que nous pouvons stocker
pour un client donné est donné par :</p>
<p><span class="math display">\[
\frac{16 \times 2^{20}}{32} = 2^{-1} \times 2^{20} = 2^{19}
\]</span></p>
<p>Ceci fait environ 524 288 locations.</p>
</div>
</details>
<div class="infobox exercisebox">
<p><strong>Exercice</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-5" class="exercise"><strong>Exercise 5  </strong></span>
Dans notre bases PostgreSQL nous avons :</p>
<ul>
<li><p>599 clients.</p></li>
<li><p>16044 locations.</p></li>
<li><p>En moyenne chaque client a environ 27 locations.</p></li>
</ul>
<p>Calculez la taille en octets des deux collections suivantes :</p>
<ol style="list-style-type: decimal">
<li><p>La collection <TT>Customer</TT>, où chaque document contient les
informations sur un client et une liste intégrée avec les informations
sur toutes les locations effectuées par le client.</p></li>
<li><p>La collection <TT>Rental</TT>, où chaque document contient les
informations sur une location et un document intégré avec les informations
sur le client qui a effectué la location.</p></li>
</ol>
</div>
</div>
<details>
<summary>
Solution
</summary>
<div class="infobox exosolution">
<p>Nous avons vu précédemment que pour chaque client nous avons besoin de 47 octets
et pour chaque location nous avons besoin de 28 octets.</p>
<p>Un document qui contient les informations sur un client et la liste de toutes les
locations du client nécessitera <span class="math inline">\(47 + 27 \times 28 = 830\)</span> octets.</p>
<p>Donc, la taille totale de la collection <TT>Customer</TT> est de
<span class="math inline">\(803 \times 599 = 480977\)</span> octets, soit 469 Ko.</p>
<p>Un document qui contient les informations sur une location et
le client qui a effectué la location nécessitera <span class="math inline">\(28 + 47 = 75\)</span> octets.</p>
<p>Donc, la taille totale de la collection <TT>Rental</TT> est de
<span class="math inline">\(75 \times 16044 = 1203300\)</span> octets, soit 1,1 Mo.</p>
</div>
</details>
<div class="infobox exercisebox">
<p><strong>Exercice</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-6" class="exercise"><strong>Exercise 6  </strong></span>
Discurez des avantages et des inconvénients des deux options présentées à la question précédente.</p>
</div>
</div>
<details>
<summary>
Solution
</summary>
<div class="infobox exosolution">
<p>Avantages of solution 1. :</p>
<ul>
<li><p>Il n’y a pas de redondance. En fait, une location est relative à au plus un client, donc
les données sur une location ne sont pas dupliquées dans différents documents.</p></li>
<li><p>Par conséquent, la taille de la collection est plus petite que la collection de la solution 2.</p></li>
<li><p>Pour chaque client, nous avons toutes les informations sur ses locations avec une seule opération de lecture.</p></li>
</ul>
<p>Désavantages de la solution 1. :</p>
<ul>
<li><p>Il y a une limite (quoique acceptable) sur le nombre de locations que nous pouvons stocker
pour chaque client.</p></li>
<li><p>Nous perdons une vue <em>centrée sur la location</em> de nos données.
Par conséquent, si nous voulons agréger des informations sur les locations, nous devons parcourir
la liste des locations de chaque client.</p></li>
</ul>
<p>Avantages de la solution 2. :</p>
<ul>
<li><p>Une vision centrée sur la location de nos données.</p></li>
<li><p>La taille de chaque document est petite et ne dépassera jamais la limite de 16 Mo.</p></li>
<li><p>Lire un document de la collection prend moins de temps et de mémoire que
de lire un document de la collection de la solution 1.</p></li>
</ul>
<p>Désavantages de la solution 2. :</p>
<ul>
<li><p>Il y a une redondance importante. En fait, les informations sur un client sont dupliquées
à chaque fois que le client effectue une location.</p></li>
<li><p>Par conséquent, la taille de la collection est plus grande que dans la solution 1.</p></li>
</ul>
</div>
</details>
<p>Il semblerait qu’une des deux solutions ait des exigences de stockage
plus élevées que l’autre, et donc les chances semblent être empilées contre cette solution</p>
<p>Il semble que l’une des deux solutions nécessite plus d’espace de stockage que l’autre, et que les chances soient donc défavorables à cette solution.</p>
<p><strong>Par contre</strong>, nous n’avons pas encore pris en compte deux autres entités qui sont
liées aux locations : le personnel et l’inventaire.</p>
<div class="infobox exercisebox">
<p><strong>Exercice</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-7" class="exercise"><strong>Exercise 7  </strong></span>
Discutez comment vous pouvez intégrer le personnel et l’inventaire dans chacune des solutions
présentées dans l’exercice précédent.
Discutez des avantages et des inconvénients de chaque option que vous présentez.</p>
</div>
</div>
<details>
<summary>
Solution
</summary>
<div class="infobox exosolution">
<p><strong>Solution 1</strong></p>
<p>Nous avons besoin de lier le personnel et l’inventaire à une location.</p>
<p>Trois options sont possibles :</p>
<ul>
<li><p>Nous intégrons les informations du personnel et de l’inventaire dans chaque document de location,
qui, rappelons-le, est déjà intégré dans un tableau.
Cela crée de la redondance, car un membre du personnel ou un élément de l’inventaire peut apparaître dans plusieurs locations.</p></li>
<li><p>Nous créons trois collections séparées (<TT>Customer</TT>, <TT>Staff</TT> et <TT>Inventory</TT>)
et dans chacune d’elles, nous intégrons un tableau avec la liste des locations relatives.
Le problème est que les données sur les locations sont maintenant répliquées trois fois.
Cette solution est particulièrement mauvaise, car les locations sont fréquemment modifiées.
Lorsque nous créons une location, nous devons modifier trois documents ; lorsqu’un client
rend un article, nous devons mettre à jour la date de retour dans trois documents.</p></li>
<li><p>Nous créons quatre collections (<TT>Customer</TT>, <TT>Staff</TT>, <TT>Inventory</TT> et
<TT>Rentals</TT>) ; pour chaque client, membre du personnel et inventaire, nous conservons une liste des locations,
chaque élément étant l’identifiant qui fait référence à la location appropriée.
Nous revenons au schéma normalisé de la base de données PostgreSQL.
Il n’est pas clair comment ce schéma normalisé aidera à faire évoluer horizontalement la base de données.</p></li>
</ul>
<p><strong>Solution 2</strong></p>
<p>Nous avons une seule collection <TT>Rental</TT> ; dans chaque document, nous avons un attribut customer,
dont la valeur est un document intégré avec toutes les informations sur un client,
un attribut staff, dont la valeur est un document intégré avec toutes les informations sur un membre du personnel,
et un attribut inventory, dont la valeur est un document intégré avec toutes les informations sur un élément d’inventaire.</p>
<p>Cette solution a des exigences de stockage plus élevées que les options présentées dans la solution 1,
mais elle a l’avantage clair d’être un schéma dénormalisé,
où nous contrôlons chaque facette d’une location (client, personnel, inventaire).
De plus, lorsque nous créons une location, nous n’écrivons qu’un seul document ; lorsque nous
mettons à jour la date de retour d’une location, nous ne mettons à jour qu’un seul document.</p>
</div>
</details>
<p>Sur la base des discussions précédentes, il semble que la solution 2
soit la meilleure option pour modéliser les données de la base de données Sakila dans
MongoDB.
Nous allons regarder de plus près les exigences de stockage de la solution adoptée.
Considérons que :</p>
<ul>
<li><p>La taille en octets d’un document stockant les informations sur un membre du personnel est de 84000 octets
(nous stockons également une photo de profil).</p></li>
<li><p>La taille en octets d’un document stockant les informations sur un élément d’inventaire est de 16 octets.</p></li>
</ul>
<div class="infobox exercisebox">
<p><strong>Exercice</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-8" class="exercise"><strong>Exercise 8  </strong></span>
Si on note par <span class="math inline">\(N_{rentals}\)</span> le nombre de locations, quelle est la taille en octets
de la base de données entière pour la solution adoptée?</p>
</div>
</div>
<details>
<summary>
Solution
</summary>
<div class="infobox exosolution">
<p>Rappellons que la taille en octets d’un document stockant les informations sur un client est de 47 octets.</p>
<p>La taille en octets d’un document de la collection <TT>Rental</TT> est donc donnée par :</p>
<p><span class="math display">\[
N_{rentals} \times (47 + 84000 + 16) = N_{rentals} \times 84063
\]</span></p>
<p>Avec 10,000 locations, la taille de la base de données sera 800 Mo.
Avec 100,000 locations, la taille de la base de données sera 7 Go.
Avec 1,000,000 locations, la taille de la base de données sera 78 Go.</p>
</div>
</details>
<p>Bien que la taille que nous avons déterminée dans l’exercice précédent, puisse ne pas sembler
impressionnante, nous devons encore stocker d’autres informations
(films, acteurs….).
Il serait donc souhaitable de réduire la taille de la base de données.</p>
<div class="infobox exercisebox">
<p><strong>Exercice</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-9" class="exercise"><strong>Exercise 9  </strong></span>
Comment pourriez-vous économiser de l’espace dans la solution adoptée?</p>
</div>
</div>
<details>
<summary>
Solution
</summary>
<div class="infobox exosolution">
<p>Lors de la modélisation des données pour une base de données MongoDB, le choix
entre un schéma normalisé et un schéma dénormalisé
n’a pas besoin d’être une décision binaire.</p>
<p>Nous pouvons avoir un schéma dénormalisé, où nous intégrons dans les mêmes documents
les informations qui sont interrogées ensemble, tout en stockant dans une collection séparée
les informations qui sont rarement interrogées.</p>
<p>Par exemple, la photo de profil d’un membre du personnel peut ne pas être
une information importante lorsque nous essayons de déterminer
qui est le plus productif.</p>
<p>Donc, nous pourrions ajouter une autre collection <TT>Staff</TT> où chaque
document ne contient que les attributs qui ne sont pas dans les documents intégrés dans la collection
<TT>Rental</TT>.</p>
</div>
</details>
<div class="infobox exercisebox">
<p><strong>Exercice</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-10" class="exercise"><strong>Exercise 10  </strong></span>
Proposez une solution pour toutes les entités impliquées et
estimez l’économie en termes d’exigences de stockage.</p>
</div>
</div>
<details>
<summary>
Solution
</summary>
<div class="infobox exosolution">
<p>Ici nous avons une solution avec trois collections différentes.
Les informations sur l’inventaire sont complètement dénormalisées dans la
collection <TT>Rental</TT>. Pour les clients et les membres du personnel, nous ne
conservons que les informations nécessaires et nous normalisons les informations qui sont moins
susceptibles d’être interrogées lors de l’analyse des locations.</p>
<p><img src="/courses/databases/tutorial-5/mongodb-sakila-first-solution.png" alt="First schema MongoDB"></p>
<p>Maintenant nous pouvons estimer les économies en termes de stockage.</p>
<p>Dans un document de la collection <TT>Rental</TT>, nous avons les attributs suivants :</p>
<ul>
<li><p>rental_id: 4 octets.</p></li>
<li><p>rental_date + return_date: 16 octets.</p></li>
<li><p>inventory_id: 4 octets</p></li>
<li><p>film_id + store_id: 4 octets</p></li>
<li><p>customer_id: 4 octets</p></li>
<li><p>customer first + last names: 13 octets.</p></li>
<li><p>country: 9 octets (en moyenne le nom d’un pays consiste en 9 caractères).</p></li>
<li><p>staff_id: 4 octets.</p></li>
<li><p>staff first + last name: 13 octets.</p></li>
</ul>
<p>En total, un document de notre collection <TT>Rental</TT> aura 71 octets
(une énorme amélioration par rapport aux 84000 octets de notre première solution).</p>
<p>Bien sûr, la taille d’un document dans la collection <TT>Staff</TT> sera d’environ
84000 octets (nous stockons toujours la photo de profil).
Mais le nombre de membres du personnel <span class="math inline">\(N_{staff}\)</span> est bien inférieur
au nombre de locations <span class="math inline">\(N_{rentals}\)</span>.</p>
<p>Il est facile de vérifier que la taille d’un document de la collection <TT>Customer</TT>
est de 34 octets (mêmes informations que précédemment sauf le prénom et le nom de famille).
Encore une fois, le nombre de clients <span class="math inline">\(N_{customers}\)</span> est bien inférieur à
<span class="math inline">\(N_{rentals}\)</span>.</p>
<p>Si nous supposons que chaque client a en moyenne 30 locations et pour 100 clients nous
avons 1 membre du personnel, nous avons que :</p>
<ul>
<li><p>$N_{customer} = N_{rental}/30 $</p></li>
<li><p>$N_{staff} = N_{customer}/100 = N_{rental}/3000 $</p></li>
</ul>
<p>La taille totale de la base de données est donc donnée par :</p>
<p><span class="math display">\[
71\times N_{rentals} + 84000 \times N_{rentals}/3000 + 34 \times N_{rentals}/30 = 100 \times N_{rental}
\]</span></p>
<p>Cela nous permet de comparer l’espace de stockage requis par cette solution par rapport à la solution précédente :</p>
<ul>
<li><p>Avec 10,000 locations, la taille de la base de données est de 976 Ko (au lieu de 800 Mo).</p></li>
<li><p>Avec 100,000 locations, la taille de la base de données est de 9,5 Mo (au lieu de 7 Go).</p></li>
<li><p>Avec 1,000,000 locations, la taille de la base de données est de 95 M0 (au lieu de 78 Go).</p></li>
</ul>
<p>Cela est une amélioration considérable ! En plus, nous avons un schéma dénormalisé qui
nous permet de tirer parti de la scalabilité horizontale de MongoDB.</p>
</div>
</details>
</div>
<div id="le-modèle-complet" class="section level1">
<h1>Le modèle complet</h1>
<p>Nous pouvons finaliser notre modèle de données en examinant les autres entités
de la base de données Sakila.</p>
<div class="infobox exercisebox">
<p><strong>Exercice</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-11" class="exercise"><strong>Exercise 11  </strong></span>
Considérez le modèle que nous avons obtenu à la fin de la section précédente.
Quelles données pouvez-vous encore dénormaliser?</p>
</div>
</div>
<details>
<summary>
Solution
</summary>
<div class="infobox exosolution">
<p><strong>Collection <TT>Staff</TT></strong></p>
<ul>
<li><p>L’attribute <TT>address_id</TT> réfère à une adresse complète. Nous pouvons complètement
dénormaliser cette information dans les documents de la collection.</p></li>
<li><p>L’attribut <TT>store_id</TT> réfère au magasin où travaille une membre du personnel.
La table <TT>Store</TT> dans la base de données PostgreSQL originale n’a pas
trop de colonnes. Par conséquent, il pourrait être raisonnable de dénormaliser complètement ces données.
Cependant, les informations sur les magasins sont également liées aux clients et aux articles d’inventaire.
Si nous devons mettre à jour, disons, le gestionnaire d’un magasin, nous devrons mettre à jour
trois documents différents.
Par conséquent, nous préférons créer une collection <TT>Store</TT> et ne garder dans les documents de la
collection <TT>Staff</TT> que l’identifiant.</p></li>
</ul>
<p>En général, nous pouvons proposer le modèle de données illustré dans la figure suivante.</p>
<p><img src="/courses/databases/tutorial-5/mongodb-sakila-first-model-further-denormalized.png" alt="Sakila MongoDB data model further normalized"></p>
</div>
</details>
<div class="infobox exercisebox">
<p><strong>Exercice</strong></p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-12" class="exercise"><strong>Exercise 12  </strong></span>
Completez le diagramme obtenu dans l’exercice précédent de manière à obtenir
un modèle de données complet pour la base de données Sakila.</p>
</div>
</div>
<details>
<summary>
Solution
</summary>
<div class="infobox exosolution">
<p><img src="/courses/databases/tutorial-5/mongodb-sakila-complete.png" alt="Sakila MongoDB full data model"></p>
</div>
</details>
</div>

          </div>

          



          
        </div>

        
      </article>

      

    </main>
  </div>
</div>


      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    <script src="/js/academic.min.3da86581634ab22d5bb3fc4505df30a5.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
